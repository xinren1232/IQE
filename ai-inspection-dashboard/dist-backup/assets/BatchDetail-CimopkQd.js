import{_ as ke,b as he,c as Ce,e as xe,d as Ve,q as ze,i as De,a as Re,r as Ae,l as Be}from"./index-BA_4wflW.js";import{r as f,t as Te,e as D,f as e,j as o,g as t,o as R,l as s,x as u,k as _,a3 as A}from"./element-plus-CvrI1lB2.js";import{bd as Fe,cF as K}from"./echarts-Cq7vAPzK.js";const Se={class:"batch-detail-container"},$e={key:0,class:"loading-container"},Ie={key:1,class:"batch-content"},qe={class:"card-header"},Ue={class:"header-actions"},Me={class:"risk-detail-score"},Ye={class:"card-header"},Ee={key:2,class:"error-container"},Le={class:"dialog-footer"},Oe={__name:"BatchDetail",setup(He){Fe([he,Ce,xe,Ve,ze,De,Re]);const q=Be(),Q=Ae(),U=f(Q.params.id),B=f(!0),r=f(null),T=f(null),F=f(null);let g=null,v=null;const y=f(!1),i=f({inspection_date:"",inspector:"",type:"入厂检验",sample_size:100,pass_count:98,conclusion:"合格",remarks:""}),W={inspection_date:[{required:!0,message:"请选择检验日期",trigger:"change"}],inspector:[{required:!0,message:"请输入检验员",trigger:"blur"}],type:[{required:!0,message:"请选择检验类型",trigger:"change"}],sample_size:[{required:!0,message:"请输入样本数量",trigger:"blur"}],pass_count:[{required:!0,message:"请输入合格数",trigger:"blur"}],conclusion:[{required:!0,message:"请选择结论",trigger:"change"}]},M=f([{id:1,inspection_date:"2023-06-01 09:30",inspector:"张工",type:"入厂检验",sample_size:100,pass_count:98,conclusion:"合格",remarks:"外观、尺寸、性能均符合要求"},{id:2,inspection_date:"2023-06-02 14:15",inspector:"李工",type:"过程检验",sample_size:50,pass_count:49,conclusion:"合格",remarks:"组装过程符合要求，参数正常"},{id:3,inspection_date:"2023-06-03 11:20",inspector:"王工",type:"特殊检验",sample_size:30,pass_count:28,conclusion:"合格",remarks:"经过高温测试，性能稳定"},{id:4,inspection_date:"2023-06-05 16:00",inspector:"赵工",type:"终检",sample_size:200,pass_count:196,conclusion:"合格",remarks:"最终检验合格，可以出厂"}]),Z=f([{batch_id:"B20230010",material_name:"电子元件A型",created_date:"2023-05-25",defect_rate:.01,status:"passed",risk_level:"low"},{batch_id:"B20230012",material_name:"电子元件A型",created_date:"2023-05-27",defect_rate:.015,status:"passed",risk_level:"low"},{batch_id:"B20230020",material_name:"电子元件A型",created_date:"2023-06-10",defect_rate:.025,status:"processing",risk_level:"medium"}]);function Y(n){return n.sample_size?(n.pass_count/n.sample_size*100).toFixed(2):0}function ee(n){return n>=95?"#67C23A":n>=90?"#E6A23C":"#F56C6C"}function te(n){return n>.02?"#F56C6C":n>.01?"#E6A23C":"#67C23A"}function E(n){switch(n){case"pending":return"info";case"processing":return"warning";case"passed":return"success";case"rejected":return"danger";case"used":return"primary";default:return"info"}}function L(n){switch(n){case"pending":return"待检验";case"processing":return"检验中";case"passed":return"已通过";case"rejected":return"已拒绝";case"used":return"已使用";default:return"未知"}}function O(n){switch(n){case"high":return"danger";case"medium":return"warning";case"low":return"success";default:return"info"}}function H(n){switch(n){case"high":return"高风险";case"medium":return"中等风险";case"low":return"低风险";default:return"未知"}}function ae(n){return n>=75?"#F56C6C":n>=45?"#E6A23C":"#67C23A"}function le(n){switch(n){case"入厂检验":return"primary";case"首件检验":return"success";case"过程检验":return"warning";case"终检":return"danger";case"特殊检验":return"info";default:return"info"}}function ne(){if(!T.value)return;g&&g.dispose(),g=K(T.value);const n={title:{text:"缺陷类型分布",left:"center"},tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{orient:"vertical",left:"left",top:"middle"},series:[{name:"缺陷类型",type:"pie",radius:"50%",data:[{value:12,name:"外观缺陷"},{value:8,name:"尺寸不良"},{value:5,name:"性能异常"},{value:3,name:"材质问题"},{value:2,name:"其他缺陷"}],emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}}}]};g.setOption(n)}function oe(){if(!F.value)return;v&&v.dispose(),v=K(F.value);const n=[],a=[],x=[],S=new Date;for(let c=30;c>=0;c--){const V=new Date;V.setDate(S.getDate()-c),n.push(V.toISOString().split("T")[0]);const m=(r.value.defect_rate||.02)+(Math.random()-.5)*.01;a.push((m*100).toFixed(2));const w=100-m*100;x.push(w.toFixed(2))}const $={title:{text:"质量趋势分析",left:"center"},tooltip:{trigger:"axis",axisPointer:{type:"cross",label:{backgroundColor:"#6a7985"}}},legend:{data:["合格率","缺陷率"],bottom:"0%"},grid:{left:"3%",right:"4%",bottom:"10%",containLabel:!0},xAxis:[{type:"category",boundaryGap:!1,data:n,axisLabel:{rotate:45,interval:5}}],yAxis:[{type:"value",name:"合格率 (%)",min:90,max:100},{type:"value",name:"缺陷率 (%)",min:0,max:5}],series:[{name:"合格率",type:"line",smooth:!0,yAxisIndex:0,data:x,itemStyle:{color:"#67C23A"}},{name:"缺陷率",type:"line",smooth:!0,yAxisIndex:1,data:a,itemStyle:{color:"#F56C6C"}}]};v.setOption($)}function se(){B.value=!0,setTimeout(()=>{r.value={batch_id:U.value,material_code:"M10010001",material_name:"电子元件A型",category_id:1,category_name:"电子元件",supplier_id:2,supplier_name:"京东方科技集团",quantity:1e3,created_date:"2023-06-01",production_date:"2023-05-30",defect_rate:.015,status:"passed",risk_level:"low",risk_score:35,notes:"用于手机摄像头模组的电子元件"},B.value=!1,nextTick(()=>{ne(),oe()})},1e3)}function re(n){A({message:`查看检验记录：${n.inspection_date}`,type:"info"})}function ie(){i.value={inspection_date:new Date().toISOString().slice(0,16).replace("T"," "),inspector:"",type:"入厂检验",sample_size:100,pass_count:98,conclusion:"合格",remarks:""},y.value=!0}function ue(){A({message:"检验记录添加成功",type:"success"}),M.value.unshift({id:Date.now(),...i.value}),y.value=!1}function de(){A({message:"批次编辑功能开发中",type:"info"})}function ce(){A({message:"数据导出功能开发中",type:"info"})}function pe(n){q.push(`/batch/${n}`)}function P(){q.go(-1)}function j(){g&&g.resize(),v&&v.resize()}return Te(()=>{se(),window.addEventListener("resize",j)}),onUnmounted(()=>{window.removeEventListener("resize",j),g&&g.dispose(),v&&v.dispose()}),(n,a)=>{const x=o("el-page-header"),S=o("el-skeleton"),$=o("el-icon-edit"),c=o("el-button"),V=o("el-icon-download"),p=o("el-descriptions-item"),m=o("el-tag"),w=o("el-progress"),_e=o("el-descriptions"),k=o("el-card"),h=o("el-col"),z=o("el-row"),me=o("el-icon-plus"),d=o("el-table-column"),N=o("el-table"),fe=o("el-empty"),ge=o("el-date-picker"),b=o("el-form-item"),G=o("el-input"),C=o("el-option"),ve=o("el-select"),X=o("el-input-number"),J=o("el-radio"),be=o("el-radio-group"),ye=o("el-form"),we=o("el-dialog");return R(),D("div",Se,[e(x,{onBack:P,title:"返回",content:"批次详情"}),B.value?(R(),D("div",$e,[e(S,{rows:10,animated:""})])):r.value?(R(),D("div",Ie,[e(z,{gutter:20},{default:t(()=>[e(h,{span:24},{default:t(()=>[e(k,null,{header:t(()=>[_("div",qe,[_("h2",null,"批次 "+u(U.value)+" 详情",1),_("div",Ue,[e(c,{type:"primary",onClick:de},{default:t(()=>[e($),a[9]||(a[9]=s(" 编辑 "))]),_:1,__:[9]}),e(c,{type:"success",onClick:ce},{default:t(()=>[e(V),a[10]||(a[10]=s(" 导出 "))]),_:1,__:[10]})])])]),default:t(()=>[e(_e,{column:3,border:""},{default:t(()=>[e(p,{label:"物料编码"},{default:t(()=>[s(u(r.value.material_code),1)]),_:1}),e(p,{label:"物料名称"},{default:t(()=>[s(u(r.value.material_name),1)]),_:1}),e(p,{label:"物料类别"},{default:t(()=>[s(u(r.value.category_name),1)]),_:1}),e(p,{label:"供应商"},{default:t(()=>[s(u(r.value.supplier_name),1)]),_:1}),e(p,{label:"数量"},{default:t(()=>[s(u(r.value.quantity),1)]),_:1}),e(p,{label:"缺陷率"},{default:t(()=>[s(u((r.value.defect_rate*100).toFixed(2))+"%",1)]),_:1}),e(p,{label:"创建日期"},{default:t(()=>[s(u(r.value.created_date),1)]),_:1}),e(p,{label:"生产日期"},{default:t(()=>[s(u(r.value.production_date||"-"),1)]),_:1}),e(p,{label:"状态"},{default:t(()=>[e(m,{type:E(r.value.status)},{default:t(()=>[s(u(L(r.value.status)),1)]),_:1},8,["type"])]),_:1}),e(p,{label:"风险评级",span:3},{default:t(()=>[e(m,{type:O(r.value.risk_level),effect:"dark"},{default:t(()=>[s(u(H(r.value.risk_level)),1)]),_:1},8,["type"]),_("div",Me,[s(" 风险评分: "+u(r.value.risk_score||0)+"/100 ",1),e(w,{percentage:r.value.risk_score||0,color:ae(r.value.risk_score||0),"stroke-width":10},null,8,["percentage","color"])])]),_:1}),e(p,{label:"备注",span:3},{default:t(()=>[s(u(r.value.notes||"无备注"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(z,{gutter:20,class:"data-row"},{default:t(()=>[e(h,{span:24},{default:t(()=>[e(k,null,{header:t(()=>[_("div",Ye,[a[12]||(a[12]=_("h3",null,"质检数据",-1)),e(c,{type:"primary",size:"small",onClick:ie},{default:t(()=>[e(me),a[11]||(a[11]=s(" 添加记录 "))]),_:1,__:[11]})])]),default:t(()=>[e(N,{data:M.value,border:"",stripe:"",style:{width:"100%"}},{default:t(()=>[e(d,{prop:"inspection_date",label:"检验日期",width:"180"}),e(d,{prop:"inspector",label:"检验员",width:"120"}),e(d,{prop:"type",label:"检验类型",width:"120"},{default:t(l=>[e(m,{type:le(l.row.type)},{default:t(()=>[s(u(l.row.type),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"sample_size",label:"样本数量",width:"100"}),e(d,{prop:"pass_count",label:"合格数",width:"100"}),e(d,{label:"合格率",width:"180"},{default:t(l=>[e(w,{percentage:Y(l.row),color:ee(Y(l.row))},null,8,["percentage","color"])]),_:1}),e(d,{prop:"conclusion",label:"结论",width:"100"},{default:t(l=>[e(m,{type:l.row.conclusion==="合格"?"success":"danger"},{default:t(()=>[s(u(l.row.conclusion),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"remarks",label:"备注"}),e(d,{label:"操作",width:"150"},{default:t(l=>[e(c,{type:"primary",size:"small",onClick:I=>re(l.row)},{default:t(()=>a[13]||(a[13]=[s(" 详情 ")])),_:2,__:[13]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1}),e(z,{gutter:20,class:"data-row"},{default:t(()=>[e(h,{xs:24,lg:12},{default:t(()=>[e(k,null,{header:t(()=>a[14]||(a[14]=[_("h3",null,"缺陷类型分布",-1)])),default:t(()=>[_("div",{class:"defect-chart",ref_key:"defectChartRef",ref:T},null,512)]),_:1})]),_:1}),e(h,{xs:24,lg:12},{default:t(()=>[e(k,null,{header:t(()=>a[15]||(a[15]=[_("h3",null,"趋势分析",-1)])),default:t(()=>[_("div",{class:"trend-chart",ref_key:"trendChartRef",ref:F},null,512)]),_:1})]),_:1})]),_:1}),e(z,{gutter:20,class:"data-row"},{default:t(()=>[e(h,{span:24},{default:t(()=>[e(k,null,{header:t(()=>a[16]||(a[16]=[_("h3",null,"相关批次",-1)])),default:t(()=>[e(N,{data:Z.value,border:"",stripe:"",style:{width:"100%"}},{default:t(()=>[e(d,{prop:"batch_id",label:"批次号",width:"150"}),e(d,{prop:"material_name",label:"物料名称"}),e(d,{prop:"created_date",label:"创建日期",width:"120"}),e(d,{label:"缺陷率",width:"180"},{default:t(l=>[e(w,{percentage:l.row.defect_rate*100,color:te(l.row.defect_rate),format:I=>I.toFixed(2)+"%"},null,8,["percentage","color","format"])]),_:1}),e(d,{label:"状态",width:"100"},{default:t(l=>[e(m,{type:E(l.row.status)},{default:t(()=>[s(u(L(l.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(d,{label:"风险等级",width:"100"},{default:t(l=>[e(m,{type:O(l.row.risk_level),effect:"dark"},{default:t(()=>[s(u(H(l.row.risk_level)),1)]),_:2},1032,["type"])]),_:1}),e(d,{label:"操作",width:"120"},{default:t(l=>[e(c,{type:"primary",size:"small",onClick:I=>pe(l.row.batch_id)},{default:t(()=>a[17]||(a[17]=[s(" 查看 ")])),_:2,__:[17]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})])):(R(),D("div",Ee,[e(fe,{description:"未找到批次数据"}),e(c,{type:"primary",onClick:P},{default:t(()=>a[18]||(a[18]=[s("返回")])),_:1,__:[18]})])),e(we,{modelValue:y.value,"onUpdate:modelValue":a[8]||(a[8]=l=>y.value=l),title:"添加检验记录",width:"50%"},{footer:t(()=>[_("span",Le,[e(c,{onClick:a[7]||(a[7]=l=>y.value=!1)},{default:t(()=>a[21]||(a[21]=[s("取消")])),_:1,__:[21]}),e(c,{type:"primary",onClick:ue},{default:t(()=>a[22]||(a[22]=[s("确认")])),_:1,__:[22]})])]),default:t(()=>[e(ye,{ref_key:"inspectionForm",ref:i,model:i.value,rules:W,"label-width":"100px"},{default:t(()=>[e(b,{label:"检验日期",prop:"inspection_date"},{default:t(()=>[e(ge,{modelValue:i.value.inspection_date,"onUpdate:modelValue":a[0]||(a[0]=l=>i.value.inspection_date=l),type:"datetime",placeholder:"选择检验日期时间",format:"YYYY-MM-DD HH:mm","value-format":"YYYY-MM-DD HH:mm"},null,8,["modelValue"])]),_:1}),e(b,{label:"检验员",prop:"inspector"},{default:t(()=>[e(G,{modelValue:i.value.inspector,"onUpdate:modelValue":a[1]||(a[1]=l=>i.value.inspector=l)},null,8,["modelValue"])]),_:1}),e(b,{label:"检验类型",prop:"type"},{default:t(()=>[e(ve,{modelValue:i.value.type,"onUpdate:modelValue":a[2]||(a[2]=l=>i.value.type=l),placeholder:"选择检验类型"},{default:t(()=>[e(C,{label:"入厂检验",value:"入厂检验"}),e(C,{label:"首件检验",value:"首件检验"}),e(C,{label:"过程检验",value:"过程检验"}),e(C,{label:"终检",value:"终检"}),e(C,{label:"特殊检验",value:"特殊检验"})]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"样本数量",prop:"sample_size"},{default:t(()=>[e(X,{modelValue:i.value.sample_size,"onUpdate:modelValue":a[3]||(a[3]=l=>i.value.sample_size=l),min:1},null,8,["modelValue"])]),_:1}),e(b,{label:"合格数",prop:"pass_count"},{default:t(()=>[e(X,{modelValue:i.value.pass_count,"onUpdate:modelValue":a[4]||(a[4]=l=>i.value.pass_count=l),min:0,max:i.value.sample_size},null,8,["modelValue","max"])]),_:1}),e(b,{label:"结论",prop:"conclusion"},{default:t(()=>[e(be,{modelValue:i.value.conclusion,"onUpdate:modelValue":a[5]||(a[5]=l=>i.value.conclusion=l)},{default:t(()=>[e(J,{label:"合格"},{default:t(()=>a[19]||(a[19]=[s("合格")])),_:1,__:[19]}),e(J,{label:"不合格"},{default:t(()=>a[20]||(a[20]=[s("不合格")])),_:1,__:[20]})]),_:1},8,["modelValue"])]),_:1}),e(b,{label:"备注",prop:"remarks"},{default:t(()=>[e(G,{type:"textarea",modelValue:i.value.remarks,"onUpdate:modelValue":a[6]||(a[6]=l=>i.value.remarks=l),rows:"3",placeholder:"请输入检验备注信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])}}},Ge=ke(Oe,[["__scopeId","data-v-b6cdee69"]]);export{Ge as default};
