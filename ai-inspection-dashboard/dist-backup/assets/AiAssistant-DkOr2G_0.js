import{b as ge,r as V,t as $e,ae as qe,a3 as Z,j as d,e as M,o as b,k as t,aa as K,f as e,g as n,l as k,x as D,c as Te,a9 as Re,ac as He,a5 as ne,a6 as re,n as ve,ab as We,v as Fe,w as De,af as _e,a8 as ke,a7 as ae,ag as be,ah as Oe,ai as Ge,aj as Ke}from"./element-plus-CvrI1lB2.js";import{_ as pe,i as Ze,d as Xe,c as Ye,e as Je,p as et,h as tt,a as nt,l as at}from"./index-BA_4wflW.js";import{i as st,a as ot}from"./index-C-zgdgf0.js";import{cF as Le,bd as lt}from"./echarts-Cq7vAPzK.js";import"./install-_7eNnU3u.js";import"./installMarkPoint-DRgdH7kI.js";const it={class:"speech-control"},rt={class:"speech-settings"},ct={class:"speech-actions"},dt={key:0,class:"speech-status"},ut={key:0,class:"recording-indicator"},mt={key:1,class:"transcript-container"},pt={class:"transcript"},ft={class:"transcript-actions"},vt={__name:"SpeechControl",emits:["speech-start","speech-end"],setup(o,{emit:s}){const p=s,a=ge({recognition:!0,synthesis:!0,language:"zh-CN",rate:1,volume:.8,pitch:1}),m=V(!1),i=V("");let f=null;$e(()=>{$()}),qe(()=>{f&&f.stop()});function $(){if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){Z.warning("您的浏览器不支持语音识别功能"),a.recognition=!1;return}const w=window.SpeechRecognition||window.webkitSpeechRecognition;f=new w,f.continuous=!0,f.interimResults=!0,f.lang=a.language,f.onresult=l=>{let y="",R="";for(let L=l.resultIndex;L<l.results.length;L++){const U=l.results[L];U.isFinal?R+=U[0].transcript:y+=U[0].transcript}R?i.value=R:y&&(i.value=y)},f.onend=()=>{m.value=!1,i.value&&p("speech-end",i.value)},f.onerror=l=>{console.error("语音识别错误:",l.error),m.value=!1,Z.error(`语音识别错误: ${l.error}`)}}function v(){if(!(!f&&($(),!f)))try{f.lang=a.language,f.start(),m.value=!0,i.value="",p("speech-start")}catch(w){console.error("开始录音失败:",w),Z.error("开始录音失败")}}function S(){f&&m.value&&f.stop()}function g(){if(!a.synthesis){Z.warning("语音合成功能未启用");return}if(!("speechSynthesis"in window)){Z.warning("您的浏览器不支持语音合成功能"),a.synthesis=!1;return}const w=new SpeechSynthesisUtterance("IQE智能质检助手已准备就绪，有什么可以帮您？");w.lang=a.language,w.rate=a.rate,w.volume=a.volume,w.pitch=a.pitch,window.speechSynthesis.speak(w)}function C(){i.value&&(p("speech-end",i.value),i.value="")}function r(){i.value=""}return(w,l)=>{const y=d("el-switch"),R=d("el-form-item"),L=d("el-option"),U=d("el-select"),z=d("el-slider"),j=d("el-form"),B=d("el-icon-microphone"),q=d("el-icon"),Q=d("el-button"),H=d("el-icon-video-play"),oe=d("el-icon-video-pause"),se=d("el-icon-position"),le=d("el-icon-delete");return b(),M("div",it,[t("div",rt,[l[11]||(l[11]=t("h3",null,"语音设置",-1)),e(j,{model:a,"label-position":"top",size:"default"},{default:n(()=>[e(R,{label:"语音识别"},{default:n(()=>[e(y,{modelValue:a.recognition,"onUpdate:modelValue":l[0]||(l[0]=x=>a.recognition=x)},null,8,["modelValue"]),l[6]||(l[6]=t("span",{class:"setting-description"},"启用语音识别功能",-1))]),_:1,__:[6]}),e(R,{label:"语音合成"},{default:n(()=>[e(y,{modelValue:a.synthesis,"onUpdate:modelValue":l[1]||(l[1]=x=>a.synthesis=x)},null,8,["modelValue"]),l[7]||(l[7]=t("span",{class:"setting-description"},"启用语音合成功能（AI回复会以语音播放）",-1))]),_:1,__:[7]}),e(R,{label:"语音语言"},{default:n(()=>[e(U,{modelValue:a.language,"onUpdate:modelValue":l[2]||(l[2]=x=>a.language=x),style:{width:"100%"}},{default:n(()=>[e(L,{label:"中文 (普通话)",value:"zh-CN"}),e(L,{label:"英语 (美国)",value:"en-US"}),e(L,{label:"日语",value:"ja-JP"})]),_:1},8,["modelValue"])]),_:1}),e(R,{label:"语音速度"},{default:n(()=>[e(z,{modelValue:a.rate,"onUpdate:modelValue":l[3]||(l[3]=x=>a.rate=x),min:.5,max:2,step:.1,"format-tooltip":x=>`${x}x`},null,8,["modelValue","format-tooltip"])]),_:1}),e(R,{label:"语音音量"},{default:n(()=>[e(z,{modelValue:a.volume,"onUpdate:modelValue":l[4]||(l[4]=x=>a.volume=x),min:0,max:1,step:.1,"format-tooltip":x=>`${Math.round(x*100)}%`},null,8,["modelValue","format-tooltip"])]),_:1}),e(R,{label:"语音音调"},{default:n(()=>[e(z,{modelValue:a.pitch,"onUpdate:modelValue":l[5]||(l[5]=x=>a.pitch=x),min:.5,max:2,step:.1},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),t("div",ct,[e(Q,{type:"primary",onClick:g,disabled:!a.synthesis},{default:n(()=>[e(q,null,{default:n(()=>[e(B)]),_:1}),l[8]||(l[8]=k(" 测试语音 "))]),_:1,__:[8]},8,["disabled"]),e(Q,{onClick:v,disabled:m.value||!a.recognition},{default:n(()=>[e(q,null,{default:n(()=>[e(H)]),_:1}),l[9]||(l[9]=k(" 开始录音 "))]),_:1,__:[9]},8,["disabled"]),e(Q,{onClick:S,disabled:!m.value},{default:n(()=>[e(q,null,{default:n(()=>[e(oe)]),_:1}),l[10]||(l[10]=k(" 停止录音 "))]),_:1,__:[10]},8,["disabled"])])]),m.value||i.value?(b(),M("div",dt,[m.value?(b(),M("div",ut,l[12]||(l[12]=[t("div",{class:"recording-animation"},null,-1),t("span",null,"正在录音...",-1)]))):K("",!0),i.value?(b(),M("div",mt,[l[15]||(l[15]=t("h4",null,"识别结果:",-1)),t("div",pt,D(i.value),1),t("div",ft,[e(Q,{size:"small",onClick:C,disabled:!i.value},{default:n(()=>[e(q,null,{default:n(()=>[e(se)]),_:1}),l[13]||(l[13]=k(" 发送 "))]),_:1,__:[13]},8,["disabled"]),e(Q,{size:"small",onClick:r,disabled:!i.value},{default:n(()=>[e(q,null,{default:n(()=>[e(le)]),_:1}),l[14]||(l[14]=k(" 清除 "))]),_:1,__:[14]},8,["disabled"])])])):K("",!0)])):K("",!0),l[16]||(l[16]=t("div",{class:"speech-tips"},[t("h4",null,"语音助手使用技巧"),t("ul",null,[t("li",null,"在聊天窗口点击麦克风图标可以直接开始语音输入"),t("li",null,'说"查看图表"或"生成图表"可以快速生成数据可视化'),t("li",null,'说"分析物料 [物料编码]"可以快速获取物料质量分析'),t("li",null,'说"预测趋势"可以获取AI质量趋势预测')])],-1))])}}},yt=pe(vt,[["__scopeId","data-v-6afd8097"]]),_t={class:"image-analysis"},gt={key:1,class:"image-preview-container"},ht={class:"image-toolbar"},bt={class:"image-controls"},kt={class:"image-container"},wt=["src"],Ct={key:1,class:"analyzing-indicator"},$t={key:0,class:"analysis-results"},Dt={class:"defects-list"},St={class:"defect-location"},xt={class:"defect-probability"},At={class:"analysis-summary"},Tt={class:"summary-item"},Mt={class:"summary-value"},Rt={class:"summary-item"},It={class:"analysis-actions"},Lt={__name:"ImageAnalysis",emits:["analysis-complete","report-generated"],setup(o,{expose:s,emit:p}){const a=p,m=V(null),i=V(null),f=V(null),$=V(""),v=V(""),S=V(100),g=V(100),C=V(100),r=V(!1),w=V(0),l=ge({defects:[],overallQuality:"",confidenceScore:0}),y=Te(()=>l.defects.length>0);function R(){m.value.click()}function L(A){const c=A.target.files;if(c&&c.length>0){const T=c[0];z(T)}}function U(A){A.preventDefault();const c=A.dataTransfer.files;if(c&&c.length>0){const T=c[0];T.type.startsWith("image/")?z(T):Z.error("请上传图片文件")}}function z(A){if(!A.type.startsWith("image/")){Z.error("请上传图片文件");return}const c=new FileReader;c.onload=T=>{$.value=T.target.result,v.value=T.target.result,S.value=100,g.value=100,C.value=100,l.defects=[],l.overallQuality="",l.confidenceScore=0},c.readAsDataURL(A)}function j(){console.log("图像已加载")}function B(){i.value&&(i.value.style.filter=`brightness(${S.value}%) contrast(${g.value}%)`)}function q(){i.value&&(i.value.style.transform=`scale(${C.value/100})`)}function Q(){$.value="",v.value="",l.defects=[],l.overallQuality="",l.confidenceScore=0,m.value.value=""}function H(){$.value=v.value,S.value=100,g.value=100,C.value=100}function oe(){r.value=!0,w.value=0;const A=setInterval(()=>{w.value+=10,w.value>=100&&(clearInterval(A),S.value=110,g.value=120,B(),r.value=!1,Z.success("图像增强完成"))},100)}function se(){if(!$.value){Z.warning("请先上传图片");return}r.value=!0,w.value=0;const A=setInterval(()=>{w.value+=Math.floor(Math.random()*10)+1,w.value>=100&&(w.value=100,clearInterval(A),setTimeout(()=>{le(),x(),r.value=!1,a("analysis-complete",l)},500))},200)}function le(){l.defects=[];const A=Math.floor(Math.random()*3)+1,c=["划痕","凹陷","裂纹","变色","气泡","污点","错位"],T=["low","medium","high"];for(let O=0;O<A;O++){const Y=i.value.naturalWidth,N=i.value.naturalHeight,W={type:c[Math.floor(Math.random()*c.length)],severity:T[Math.floor(Math.random()*T.length)],location:[Math.floor(Math.random()*Y),Math.floor(Math.random()*N)],size:Math.floor(Math.random()*30)+10,probability:Math.random()*.3+.7};l.defects.push(W)}const F=l.defects.some(O=>O.severity==="high");l.overallQuality=F?"fail":"pass",l.confidenceScore=Math.random()*.2+.8}function x(){!f.value||l.defects.length===0||ve(()=>{const A=i.value,c=f.value;c.width=A.naturalWidth,c.height=A.naturalHeight;const T=c.getContext("2d");T.clearRect(0,0,c.width,c.height),l.defects.forEach(F=>{const[O,Y]=F.location,N=F.size;let W;switch(F.severity){case"high":W="rgba(255, 0, 0, 0.7)";break;case"medium":W="rgba(255, 165, 0, 0.7)";break;default:W="rgba(255, 255, 0, 0.7)"}T.beginPath(),T.arc(O,Y,N/2,0,2*Math.PI),T.fillStyle=W,T.fill(),T.lineWidth=2,T.strokeStyle="rgba(255, 255, 255, 0.8)",T.stroke(),T.font="14px Arial",T.fillStyle="white",T.textAlign="center",T.textBaseline="middle",T.fillText(F.type,O,Y)})})}function u(A){switch(A){case"high":return"danger";case"medium":return"warning";default:return"info"}}function P(){if(!y.value){Z.warning("请先分析图像");return}Z.success("分析报告已生成"),a("report-generated",{timestamp:new Date().toISOString(),imageData:$.value,results:l})}return s({analyzeImage:se,enhanceImage:oe}),(A,c)=>{const T=d("el-icon-upload"),F=d("el-icon"),O=d("el-icon-search"),Y=d("el-button"),N=d("el-icon-magic-stick"),W=d("el-icon-refresh-right"),fe=d("el-button-group"),ce=d("el-slider"),ue=d("el-icon-delete"),ye=d("el-progress"),me=d("el-tag");return b(),M("div",_t,[$.value?K("",!0):(b(),M("div",{key:0,class:"upload-area",onClick:R,onDrop:U,onDragover:c[0]||(c[0]=Re(()=>{},["prevent"])),onDragenter:c[1]||(c[1]=Re(()=>{},["prevent"]))},[t("input",{ref_key:"fileInput",ref:m,type:"file",accept:"image/*",onChange:L,style:{display:"none"}},null,544),e(F,{class:"upload-icon"},{default:n(()=>[e(T)]),_:1}),c[5]||(c[5]=t("div",{class:"upload-text"},[t("span",null,"点击或拖拽上传图片"),t("p",null,"支持JPG、PNG格式")],-1))],32)),$.value?(b(),M("div",gt,[t("div",ht,[e(fe,null,{default:n(()=>[e(Y,{type:"primary",size:"small",onClick:se,loading:r.value},{default:n(()=>[e(F,null,{default:n(()=>[e(O)]),_:1}),c[6]||(c[6]=k(" 分析缺陷 "))]),_:1,__:[6]},8,["loading"]),e(Y,{size:"small",onClick:oe,disabled:r.value},{default:n(()=>[e(F,null,{default:n(()=>[e(N)]),_:1}),c[7]||(c[7]=k(" 图像增强 "))]),_:1,__:[7]},8,["disabled"]),e(Y,{size:"small",onClick:H,disabled:r.value},{default:n(()=>[e(F,null,{default:n(()=>[e(W)]),_:1}),c[8]||(c[8]=k(" 重置 "))]),_:1,__:[8]},8,["disabled"])]),_:1}),t("div",bt,[c[9]||(c[9]=t("span",{class:"control-label"},"亮度:",-1)),e(ce,{modelValue:S.value,"onUpdate:modelValue":c[2]||(c[2]=ie=>S.value=ie),min:0,max:200,step:5,onInput:B,disabled:r.value},null,8,["modelValue","disabled"]),c[10]||(c[10]=t("span",{class:"control-label"},"对比度:",-1)),e(ce,{modelValue:g.value,"onUpdate:modelValue":c[3]||(c[3]=ie=>g.value=ie),min:0,max:200,step:5,onInput:B,disabled:r.value},null,8,["modelValue","disabled"]),c[11]||(c[11]=t("span",{class:"control-label"},"缩放:",-1)),e(ce,{modelValue:C.value,"onUpdate:modelValue":c[4]||(c[4]=ie=>C.value=ie),min:10,max:200,step:10,onInput:q,disabled:r.value},null,8,["modelValue","disabled"])]),e(Y,{type:"danger",size:"small",onClick:Q,disabled:r.value},{default:n(()=>[e(F,null,{default:n(()=>[e(ue)]),_:1}),c[12]||(c[12]=k(" 删除 "))]),_:1,__:[12]},8,["disabled"])]),t("div",kt,[t("img",{ref_key:"imageRef",ref:i,src:$.value,style:He({filter:`brightness(${S.value}%) contrast(${g.value}%)`,transform:`scale(${C.value/100})`}),onLoad:j,class:"preview-image"},null,44,wt),y.value?(b(),M("canvas",{key:0,ref_key:"overlayCanvas",ref:f,class:"analysis-overlay"},null,512)):K("",!0),r.value?(b(),M("div",Ct,[e(ye,{type:"circle",percentage:w.value,status:w.value===100?"success":""},null,8,["percentage","status"]),t("p",null,"正在分析图像..."+D(w.value)+"%",1)])):K("",!0)]),y.value?(b(),M("div",$t,[c[16]||(c[16]=t("h3",null,"分析结果",-1)),t("div",Dt,[(b(!0),M(ne,null,re(l.defects,(ie,h)=>(b(),M("div",{key:h,class:"defect-item"},[e(me,{type:u(ie.severity),effect:"dark"},{default:n(()=>[k(D(ie.type),1)]),_:2},1032,["type"]),t("span",St,"位置: "+D(ie.location.join(", ")),1),t("span",xt," 可信度: "+D((ie.probability*100).toFixed(0))+"% ",1)]))),128))]),t("div",At,[t("div",Tt,[c[13]||(c[13]=t("span",{class:"summary-label"},"检测缺陷数:",-1)),t("span",Mt,D(l.defects.length),1)]),t("div",Rt,[c[14]||(c[14]=t("span",{class:"summary-label"},"整体评估:",-1)),e(me,{type:l.overallQuality==="pass"?"success":"danger"},{default:n(()=>[k(D(l.overallQuality==="pass"?"合格":"不合格"),1)]),_:1},8,["type"])])]),t("div",It,[e(Y,{type:"primary",onClick:P},{default:n(()=>c[15]||(c[15]=[k(" 生成分析报告 ")])),_:1,__:[15]})])])):K("",!0)])):K("",!0)])}}},Vt=pe(Lt,[["__scopeId","data-v-850bee73"]]),zt={class:"chart-generator"},Ut={class:"chart-toolbar"},Nt={class:"chart-type-selector"},Ft={class:"chart-actions"},Ot={key:0,class:"data-panel"},Pt={class:"panel-header"},Et={class:"dimensions-editor"},Qt={class:"dimension-list"},Bt={class:"series-editor"},jt={class:"series-header"},qt={class:"series-data"},Ht={key:0,class:"dim-label"},Wt={class:"chart-settings"},Gt={class:"setting-item"},Kt={class:"setting-item"},Zt={class:"setting-item"},Xt={class:"setting-item"},Yt={class:"setting-item"},Jt={class:"setting-item"},en={class:"setting-item"},tn={key:0,class:"chart-loading"},nn={__name:"ChartGenerator",props:{initialData:{type:Object,default:()=>({dimensions:[],series:[]})},initialType:{type:String,default:"line"},height:{type:String,default:"400px"},theme:{type:String,default:""}},emits:["chart-updated","data-changed"],setup(o,{expose:s,emit:p}){We(x=>({"048e0092":a.height}));const a=o,m=p,i=V(null),f=V(null),$=V(null),v=V(a.initialType),S=V(!1),g=V(!1),C=V("dimensions"),r=ge({dimensions:[...a.initialData.dimensions||["类别A","类别B","类别C","类别D","类别E"]],series:[...a.initialData.series||[{name:"系列1",type:"line",color:"#5470c6",data:[120,200,150,80,70]},{name:"系列2",type:"bar",color:"#91cc75",data:[60,80,240,100,150]}]]}),w=ge({title:"数据分析图表",subtitle:"",xAxisName:"",yAxisName:"",showLegend:!0,showDataLabels:!1,enableZoom:!1});$e(()=>{l(),window.addEventListener("resize",z)}),Fe(()=>{$.value&&$.value.dispose(),window.removeEventListener("resize",z)}),De(v,x=>{R()});function l(){i.value&&($.value&&$.value.dispose(),$.value=Le(i.value,a.theme),R(),$.value.on("click",U))}function y(){const x={title:{text:w.title,subtext:w.subtitle},tooltip:{trigger:v.value==="pie"?"item":"axis",formatter:v.value==="pie"?"{a} <br/>{b}: {c} ({d}%)":void 0},legend:{show:w.showLegend,type:r.series.length>10?"scroll":"plain"},toolbox:{feature:{saveAsImage:{},dataZoom:w.enableZoom?{show:!0}:{show:!1},restore:{}}}};return v.value==="pie"?x.series=[{name:w.title,type:"pie",radius:"60%",center:["50%","50%"],data:r.dimensions.map((u,P)=>{var A,c;return{name:u,value:((A=r.series[0])==null?void 0:A.data[P])||0,itemStyle:{color:(c=r.series[0])==null?void 0:c.color}}}),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{show:w.showDataLabels,formatter:"{b}: {c} ({d}%)"}}]:v.value==="radar"?(x.radar={indicator:r.dimensions.map((u,P)=>{const A=Math.max(...r.series.map(c=>c.data[P]||0))*1.2;return{name:u,max:A>0?A:100}})},x.series=[{type:"radar",data:r.series.map(u=>({name:u.name,value:u.data,itemStyle:{color:u.color},lineStyle:{color:u.color},areaStyle:{color:u.color,opacity:.3}}))}]):(x.xAxis={type:"category",name:w.xAxisName,data:r.dimensions,axisLabel:{rotate:r.dimensions.length>6?45:0}},x.yAxis={type:"value",name:w.yAxisName},x.series=r.series.map(u=>({name:u.name,type:v.value==="scatter"?"scatter":u.type||v.value,data:u.data,itemStyle:{color:u.color},label:{show:w.showDataLabels,position:"top"}}))),w.enableZoom&&!["pie","radar"].includes(v.value)&&(x.dataZoom=[{type:"inside",start:0,end:100},{type:"slider",start:0,end:100}]),x}function R(){$.value&&(S.value=!0,ve(()=>{const x=y();$.value.setOption(x,!0),S.value=!1,m("chart-updated",{type:v.value,options:x})}))}function L(){R()}function U(x){console.log("图表点击事件:",x)}function z(){$.value&&$.value.resize()}function j(x){if($.value)switch(x){case"png":const u=$.value.getDataURL({type:"png",pixelRatio:2,backgroundColor:"#fff"});B(u,"chart.png");break;case"svg":const P=$.value.getDataURL({type:"svg",pixelRatio:1,backgroundColor:"#fff"});B(P,"chart.svg");break;case"json":const A={type:v.value,data:r,options:w},c=JSON.stringify(A,null,2),T=new Blob([c],{type:"application/json"}),F=URL.createObjectURL(T);q(F,"chart-data.json");break}}function B(x,u){const P=document.createElement("a");P.href=x,P.download=u,document.body.appendChild(P),P.click(),document.body.removeChild(P)}function q(x,u){const P=document.createElement("a");P.href=x,P.download=u,document.body.appendChild(P),P.click(),document.body.removeChild(P),URL.revokeObjectURL(x)}function Q(){r.dimensions.push(`类别${r.dimensions.length+1}`),r.series.forEach(x=>{x.data.push(0)})}function H(x){if(r.dimensions.length<=2){Z.warning("至少保留两个维度");return}r.dimensions.splice(x,1),r.series.forEach(u=>{u.data.splice(x,1)})}function oe(){const x=["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc"],u=x[r.series.length%x.length];r.series.push({name:`系列${r.series.length+1}`,type:v.value,color:u,data:new Array(r.dimensions.length).fill(0)})}function se(x){if(r.series.length<=1){Z.warning("至少保留一个数据系列");return}r.series.splice(x,1)}function le(){R(),m("data-changed",{dimensions:r.dimensions,series:r.series}),Z.success("数据已更新")}return s({refreshChart:L,generateChart:R,exportChart:j,getChartData(){return{type:v.value,dimensions:r.dimensions,series:r.series}}}),(x,u)=>{const P=d("el-radio-button"),A=d("el-radio-group"),c=d("el-icon-refresh"),T=d("el-icon"),F=d("el-button"),O=d("el-icon-document"),Y=d("el-icon-arrow-down"),N=d("el-dropdown-item"),W=d("el-dropdown-menu"),fe=d("el-dropdown"),ce=d("el-input"),ue=d("el-icon-delete"),ye=d("el-icon-plus"),me=d("el-tab-pane"),ie=d("el-color-picker"),h=d("el-option"),_=d("el-select"),I=d("el-input-number"),ee=d("el-checkbox"),te=d("el-tabs"),G=d("el-icon-loading");return b(),M("div",zt,[t("div",Ut,[t("div",Nt,[u[15]||(u[15]=t("span",{class:"toolbar-label"},"图表类型：",-1)),e(A,{modelValue:v.value,"onUpdate:modelValue":u[0]||(u[0]=E=>v.value=E),size:"small",onChange:R},{default:n(()=>[e(P,{label:"line"},{default:n(()=>u[10]||(u[10]=[k("折线图")])),_:1,__:[10]}),e(P,{label:"bar"},{default:n(()=>u[11]||(u[11]=[k("柱状图")])),_:1,__:[11]}),e(P,{label:"pie"},{default:n(()=>u[12]||(u[12]=[k("饼图")])),_:1,__:[12]}),e(P,{label:"scatter"},{default:n(()=>u[13]||(u[13]=[k("散点图")])),_:1,__:[13]}),e(P,{label:"radar"},{default:n(()=>u[14]||(u[14]=[k("雷达图")])),_:1,__:[14]})]),_:1},8,["modelValue"])]),t("div",Ft,[e(F,{size:"small",onClick:L},{default:n(()=>[e(T,null,{default:n(()=>[e(c)]),_:1})]),_:1}),e(F,{size:"small",onClick:u[1]||(u[1]=E=>g.value=!g.value)},{default:n(()=>[e(T,null,{default:n(()=>[e(O)]),_:1}),u[16]||(u[16]=k(" 编辑数据 "))]),_:1,__:[16]}),e(fe,{onCommand:j},{dropdown:n(()=>[e(W,null,{default:n(()=>[e(N,{command:"png"},{default:n(()=>u[18]||(u[18]=[k("PNG图片")])),_:1,__:[18]}),e(N,{command:"svg"},{default:n(()=>u[19]||(u[19]=[k("SVG图片")])),_:1,__:[19]}),e(N,{command:"json"},{default:n(()=>u[20]||(u[20]=[k("JSON数据")])),_:1,__:[20]})]),_:1})]),default:n(()=>[e(F,{size:"small"},{default:n(()=>[u[17]||(u[17]=k(" 导出 ")),e(T,{class:"el-icon--right"},{default:n(()=>[e(Y)]),_:1})]),_:1,__:[17]})]),_:1})])]),g.value?(b(),M("div",Ot,[t("div",Pt,[u[22]||(u[22]=t("h3",null,"图表数据编辑",-1)),e(F,{size:"small",type:"primary",onClick:le},{default:n(()=>u[21]||(u[21]=[k(" 应用更改 ")])),_:1,__:[21]})]),e(te,{modelValue:C.value,"onUpdate:modelValue":u[9]||(u[9]=E=>C.value=E)},{default:n(()=>[e(me,{label:"维度数据",name:"dimensions"},{default:n(()=>[t("div",Et,[u[24]||(u[24]=t("p",{class:"edit-hint"},"维度数据（如时间、分类等）",-1)),t("div",Qt,[(b(!0),M(ne,null,re(r.dimensions,(E,J)=>(b(),M("div",{key:`dim-${J}`,class:"dimension-item"},[e(ce,{modelValue:r.dimensions[J],"onUpdate:modelValue":de=>r.dimensions[J]=de,size:"small",placeholder:"输入维度名称"},null,8,["modelValue","onUpdate:modelValue"]),e(F,{type:"danger",size:"small",icon:"el-icon-delete",onClick:de=>H(J),circle:"",plain:""},{default:n(()=>[e(T,null,{default:n(()=>[e(ue)]),_:1})]),_:2},1032,["onClick"])]))),128))]),e(F,{size:"small",onClick:Q,type:"primary",plain:""},{default:n(()=>[e(T,null,{default:n(()=>[e(ye)]),_:1}),u[23]||(u[23]=k(" 添加维度 "))]),_:1,__:[23]})])]),_:1}),e(me,{label:"系列数据",name:"series"},{default:n(()=>[t("div",Bt,[u[26]||(u[26]=t("p",{class:"edit-hint"},"系列数据（如各指标数值）",-1)),(b(!0),M(ne,null,re(r.series,(E,J)=>(b(),M("div",{key:`series-${J}`,class:"series-container"},[t("div",jt,[e(ce,{modelValue:r.series[J].name,"onUpdate:modelValue":de=>r.series[J].name=de,size:"small",placeholder:"系列名称"},null,8,["modelValue","onUpdate:modelValue"]),e(ie,{modelValue:r.series[J].color,"onUpdate:modelValue":de=>r.series[J].color=de,size:"small"},null,8,["modelValue","onUpdate:modelValue"]),e(_,{modelValue:r.series[J].type,"onUpdate:modelValue":de=>r.series[J].type=de,size:"small",placeholder:"图表类型"},{default:n(()=>[e(h,{label:"折线图",value:"line"}),e(h,{label:"柱状图",value:"bar"}),e(h,{label:"散点图",value:"scatter"})]),_:2},1032,["modelValue","onUpdate:modelValue"]),e(F,{type:"danger",size:"small",onClick:de=>se(J),circle:"",plain:""},{default:n(()=>[e(T,null,{default:n(()=>[e(ue)]),_:1})]),_:2},1032,["onClick"])]),t("div",qt,[(b(!0),M(ne,null,re(E.data,(de,he)=>(b(),M("div",{key:`value-${J}-${he}`,class:"data-item"},[r.dimensions[he]?(b(),M("span",Ht,D(r.dimensions[he])+": ",1)):K("",!0),e(I,{modelValue:r.series[J].data[he],"onUpdate:modelValue":Me=>r.series[J].data[he]=Me,controls:!1,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]))),128))])]))),128)),e(F,{size:"small",onClick:oe,type:"primary",plain:""},{default:n(()=>[e(T,null,{default:n(()=>[e(ye)]),_:1}),u[25]||(u[25]=k(" 添加系列 "))]),_:1,__:[25]})])]),_:1}),e(me,{label:"图表设置",name:"settings"},{default:n(()=>[t("div",Wt,[t("div",Gt,[u[27]||(u[27]=t("span",{class:"setting-label"},"标题：",-1)),e(ce,{modelValue:w.title,"onUpdate:modelValue":u[2]||(u[2]=E=>w.title=E),size:"small",placeholder:"图表标题"},null,8,["modelValue"])]),t("div",Kt,[u[28]||(u[28]=t("span",{class:"setting-label"},"子标题：",-1)),e(ce,{modelValue:w.subtitle,"onUpdate:modelValue":u[3]||(u[3]=E=>w.subtitle=E),size:"small",placeholder:"图表子标题"},null,8,["modelValue"])]),t("div",Zt,[u[29]||(u[29]=t("span",{class:"setting-label"},"X轴标题：",-1)),e(ce,{modelValue:w.xAxisName,"onUpdate:modelValue":u[4]||(u[4]=E=>w.xAxisName=E),size:"small",placeholder:"X轴标题"},null,8,["modelValue"])]),t("div",Xt,[u[30]||(u[30]=t("span",{class:"setting-label"},"Y轴标题：",-1)),e(ce,{modelValue:w.yAxisName,"onUpdate:modelValue":u[5]||(u[5]=E=>w.yAxisName=E),size:"small",placeholder:"Y轴标题"},null,8,["modelValue"])]),t("div",Yt,[e(ee,{modelValue:w.showLegend,"onUpdate:modelValue":u[6]||(u[6]=E=>w.showLegend=E)},{default:n(()=>u[31]||(u[31]=[k("显示图例")])),_:1,__:[31]},8,["modelValue"])]),t("div",Jt,[e(ee,{modelValue:w.showDataLabels,"onUpdate:modelValue":u[7]||(u[7]=E=>w.showDataLabels=E)},{default:n(()=>u[32]||(u[32]=[k("显示数据标签")])),_:1,__:[32]},8,["modelValue"])]),t("div",en,[e(ee,{modelValue:w.enableZoom,"onUpdate:modelValue":u[8]||(u[8]=E=>w.enableZoom=E)},{default:n(()=>u[33]||(u[33]=[k("启用缩放功能")])),_:1,__:[33]},8,["modelValue"])])])]),_:1})]),_:1},8,["modelValue"])])):K("",!0),t("div",{class:"chart-container",ref_key:"chartContainer",ref:f},[t("div",{ref_key:"chartRef",ref:i,class:"chart"},null,512),S.value?(b(),M("div",tn,[e(T,{class:"loading-icon"},{default:n(()=>[e(G)]),_:1}),u[34]||(u[34]=t("span",null,"加载中...",-1))])):K("",!0)],512)])}}},an=pe(nn,[["__scopeId","data-v-2cffa5a8"]]),sn={class:"chat-window"},on={key:0,class:"message-item system-message"},ln={class:"message-avatar"},rn={class:"message-content"},cn={class:"message-bubble"},dn=["innerHTML"],un={class:"message-time"},mn={class:"message-avatar"},pn={class:"message-content"},fn={class:"message-bubble"},vn=["innerHTML"],yn={key:1,class:"message-chart"},_n={key:0,class:"chart-title"},gn=["id"],hn={key:2,class:"message-image"},bn={class:"image-error"},kn={key:0,class:"image-caption"},wn={key:3,class:"message-file"},Cn={key:4,class:"message-loading"},$n={key:5,class:"message-error"},Dn={class:"message-time"},Sn={key:0,class:"message-actions"},xn={class:"input-container"},An={class:"input-tools"},Tn={class:"input-actions"},Mn={key:0,class:"voice-indicator"},Rn={class:"voice-wave"},In={__name:"ChatWindow",props:{welcomeMessage:{type:String,default:"您好，我是IQE智能助手，有什么可以帮您?"},userAvatar:{type:String,default:"/src/assets/user-avatar.png"},botAvatar:{type:String,default:"/src/assets/bot-avatar.png"},contextMemory:{type:Boolean,default:!0},maxContextMessages:{type:Number,default:10}},emits:["send-message","clear-chat","speech-start","speech-end","image-upload"],setup(o,{expose:s,emit:p}){const a=o,m=p,i=V([]),f=V(""),$=V(null),v=V(!1),S=V(!1),g=V(!1),C=V(!1),r=V(null),w=V(!1),l=V(null),y=ge({});$e(()=>{(window.SpeechRecognition||window.webkitSpeechRecognition)&&(w.value=!0,R()),$.value&&$.value.addEventListener("scroll",B),j()}),Fe(()=>{$.value&&$.value.removeEventListener("scroll",B),Object.values(y).forEach(A=>{A.dispose()}),u()}),De(i,()=>{ve(()=>{q(),j()})},{deep:!0});function R(){try{const A=window.SpeechRecognition||window.webkitSpeechRecognition;l.value=new A,l.value.continuous=!0,l.value.interimResults=!0,l.value.lang="zh-CN",l.value.onresult=c=>{let T="";for(let F=c.resultIndex;F<c.results.length;F++)c.results[F].isFinal&&(T+=c.results[F][0].transcript);T&&(f.value+=T)},l.value.onend=()=>{v.value=!1},l.value.onerror=c=>{console.error("语音识别错误：",c.error),v.value=!1,Z.error("语音识别出错")}}catch(A){console.error("设置语音识别失败：",A),w.value=!1}}function L(A){return new Date(A).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function U(A){if(!A)return"";let c=A.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank">$1</a>');return c=c.replace(/^# (.*?)$/gm,"<h1>$1</h1>").replace(/^## (.*?)$/gm,"<h2>$1</h2>").replace(/^### (.*?)$/gm,"<h3>$1</h3>"),c}async function z(){const A=f.value.trim();if(!A&&!g.value)return;const c={role:"user",type:"text",content:A,timestamp:Date.now()};i.value.push(c),f.value="";const T=i.value.length;i.value.push({role:"assistant",type:"loading",content:"",timestamp:Date.now()}),S.value=!0;try{const F=a.contextMemory?i.value.filter(Y=>Y.type!=="loading"&&Y.type!=="error").slice(-(a.maxContextMessages*2)):[],O=await new Promise(Y=>{m("send-message",A,F,Y)});i.value.splice(T,1),O?typeof O=="string"?i.value.push({role:"assistant",type:"text",content:O,timestamp:Date.now()}):typeof O=="object"&&i.value.push({role:"assistant",type:O.type||"text",content:O.content,timestamp:Date.now(),...O.type==="chart"&&{chartData:O.chartData,chartTitle:O.title},...O.type==="image"&&{alt:O.alt,caption:O.caption},...O.type==="file"&&{fileName:O.fileName}}):i.value.push({role:"assistant",type:"error",content:"抱歉，我无法生成回复。",timestamp:Date.now()})}catch(F){console.error("发送消息错误：",F),i.value.splice(T,1),i.value.push({role:"assistant",type:"error",content:"发送消息时出错："+F.message,timestamp:Date.now()})}finally{S.value=!1,ve(()=>{j()})}}function j(){ve(()=>{i.value.forEach((A,c)=>{if(A.type==="chart"){const T=document.getElementById(`chart-${c}`);T&&(y[`chart-${c}`]&&y[`chart-${c}`].dispose(),y[`chart-${c}`]=Le(T),A.chartData&&y[`chart-${c}`].setOption(A.chartData))}})})}function B(){if(!$.value)return;const{scrollTop:A,scrollHeight:c,clientHeight:T}=$.value,F=c-A-T<50;C.value=!F&&i.value.length>0}function q(){$.value&&($.value.scrollTop=$.value.scrollHeight,C.value=!1)}function Q(A){if(!A)return;const c=document.createElement("div");c.innerHTML=A;const T=c.textContent||c.innerText||A;navigator.clipboard.writeText(T).then(()=>{Z.success("内容已复制到剪贴板")}).catch(F=>{console.error("复制失败：",F),Z.error("复制失败")})}function H(A){if(!A)return;const c=document.createElement("div");c.innerHTML=A;const T=c.textContent||c.innerText||A;m("speech-start",T)}function oe(){r.value&&r.value.click()}async function se(A){const c=A.target.files[0];if(c){if(!c.type.startsWith("image/")){Z.error("请上传图片文件");return}g.value=!0;try{const T=await new Promise(F=>{const O=new FileReader;O.onload=Y=>F(Y.target.result),O.onerror=()=>F(null),O.readAsDataURL(c)});T?(i.value.push({role:"user",type:"image",content:T,timestamp:Date.now()}),m("image-upload",{dataUrl:T,file:c})):Z.error("图片读取失败")}catch(T){console.error("图片上传错误：",T),Z.error("图片上传失败")}finally{g.value=!1,r.value&&(r.value.value="")}}}function le(){v.value?u():x()}function x(){l.value||R();try{l.value.start(),v.value=!0,m("speech-start")}catch(A){console.error("启动语音识别失败：",A),v.value=!1,Z.error("启动语音识别失败")}}function u(){if(l.value)try{l.value.stop()}catch(A){console.error("停止语音识别失败：",A)}v.value=!1,m("speech-end")}function P(A,c){const T=document.createElement("a");T.href=A,T.download=c||"download",document.body.appendChild(T),T.click(),document.body.removeChild(T)}return s({messages:i,addMessage(A,c,T="text",F={}){i.value.push({role:A,type:T,content:c,timestamp:Date.now(),...F})},clearMessages(){i.value=[]},getMessages(){return i.value},startVoiceInput:x,stopVoiceInput:u}),(A,c)=>{const T=d("el-avatar"),F=d("el-icon-picture"),O=d("el-icon"),Y=d("el-image"),N=d("el-icon-document"),W=d("el-button"),fe=d("el-icon-warning"),ce=d("el-icon-document-copy"),ue=d("el-tooltip"),ye=d("el-icon-headset"),me=d("el-icon-caret-bottom"),ie=d("el-icon-picture-outline"),h=d("el-icon-microphone"),_=d("el-input");return b(),M("div",sn,[t("div",{class:"messages-container",ref_key:"messagesContainer",ref:$},[o.welcomeMessage?(b(),M("div",on,[t("div",ln,[e(T,{size:40,src:o.botAvatar},null,8,["src"])]),t("div",rn,[t("div",cn,[t("div",{class:"message-text",innerHTML:U(o.welcomeMessage)},null,8,dn)]),t("div",un,D(L(Date.now())),1)])])):K("",!0),(b(!0),M(ne,null,re(i.value,(I,ee)=>(b(),M("div",{key:ee,class:ke(["message-item",I.role==="user"?"user-message":"bot-message"])},[t("div",mn,[e(T,{size:40,src:I.role==="user"?o.userAvatar:o.botAvatar},null,8,["src"])]),t("div",pn,[t("div",fn,[I.type==="text"?(b(),M("div",{key:0,class:"message-text",innerHTML:U(I.content)},null,8,vn)):I.type==="chart"?(b(),M("div",yn,[I.chartTitle?(b(),M("div",_n,D(I.chartTitle),1)):K("",!0),t("div",{id:`chart-${ee}`,class:"chart-container",style:{height:"300px"}},null,8,gn)])):I.type==="image"?(b(),M("div",hn,[e(Y,{src:I.content,"preview-src-list":[I.content],fit:"contain",alt:I.alt||"图片"},{error:n(()=>[t("div",bn,[e(O,null,{default:n(()=>[e(F)]),_:1}),c[1]||(c[1]=t("span",null,"加载失败",-1))])]),_:2},1032,["src","preview-src-list","alt"]),I.caption?(b(),M("div",kn,D(I.caption),1)):K("",!0)])):I.type==="file"?(b(),M("div",wn,[e(W,{type:"primary",size:"small",onClick:te=>P(I.content,I.fileName)},{default:n(()=>[e(O,null,{default:n(()=>[e(N)]),_:1}),k(" 下载"+D(I.fileName),1)]),_:2},1032,["onClick"])])):I.type==="loading"?(b(),M("div",Cn,c[2]||(c[2]=[t("div",{class:"loading-dots"},[t("div",{class:"dot dot1"}),t("div",{class:"dot dot2"}),t("div",{class:"dot dot3"})],-1)]))):I.type==="error"?(b(),M("div",$n,[e(O,null,{default:n(()=>[e(fe)]),_:1}),t("span",null,D(I.content),1)])):K("",!0)]),t("div",Dn,D(L(I.timestamp)),1),I.role==="assistant"&&I.type!=="loading"?(b(),M("div",Sn,[e(ue,{content:"复制内容",placement:"top"},{default:n(()=>[e(W,{size:"small",circle:"",onClick:te=>Q(I.content)},{default:n(()=>[e(O,null,{default:n(()=>[e(ce)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),I.type==="text"?(b(),ae(ue,{key:0,content:"朗读内容",placement:"top"},{default:n(()=>[e(W,{size:"small",circle:"",onClick:te=>H(I.content)},{default:n(()=>[e(O,null,{default:n(()=>[e(ye)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):K("",!0)])):K("",!0)])],2))),128)),_e(t("div",{class:"new-message-indicator",onClick:q},[e(O,null,{default:n(()=>[e(me)]),_:1}),c[3]||(c[3]=k(" 新消息 "))],512),[[be,C.value]])],512),t("div",xn,[t("div",An,[e(ue,{content:"上传图片",placement:"top"},{default:n(()=>[e(W,{type:"text",onClick:oe},{default:n(()=>[e(O,null,{default:n(()=>[e(ie)]),_:1})]),_:1})]),_:1}),w.value?(b(),ae(ue,{key:0,content:"语音输入",placement:"top"},{default:n(()=>[e(W,{type:"text",class:ke({active:v.value}),onClick:le},{default:n(()=>[e(O,null,{default:n(()=>[e(h)]),_:1})]),_:1},8,["class"])]),_:1})):K("",!0),t("input",{ref_key:"fileInput",ref:r,type:"file",accept:"image/*",style:{display:"none"},onChange:se},null,544)]),e(_,{modelValue:f.value,"onUpdate:modelValue":c[0]||(c[0]=I=>f.value=I),type:"textarea",rows:2,resize:"none",placeholder:"输入您的问题...",onKeyup:Oe(Re(z,["ctrl"]),["enter"])},null,8,["modelValue","onKeyup"]),t("div",Tn,[e(W,{type:"primary",disabled:!f.value.trim()&&!g.value,loading:g.value||S.value,onClick:z},{default:n(()=>c[4]||(c[4]=[k(" 发送 ")])),_:1,__:[4]},8,["disabled","loading"])])]),v.value?(b(),M("div",Mn,[t("div",Rn,[(b(),M(ne,null,re(5,I=>t("div",{class:"wave-bar",key:I})),64))]),c[6]||(c[6]=t("span",null,"正在聆听...",-1)),e(W,{size:"small",type:"danger",onClick:u},{default:n(()=>c[5]||(c[5]=[k(" 停止 ")])),_:1,__:[5]})])):K("",!0)])}}},Ln=pe(In,[["__scopeId","data-v-6f6a439f"]]),Vn={class:"risk-analysis-card"},zn={class:"risk-score-section"},Un={class:"risk-meter"},Nn={class:"progress-content"},Fn={class:"score"},On={class:"risk-level"},Pn={class:"update-time"},En={class:"risk-factors-section"},Qn={class:"recommended-strategy-section"},Bn={class:"section-header"},jn={class:"strategy-item"},qn={class:"item-value"},Hn={class:"strategy-item"},Wn={class:"item-value"},Gn={class:"strategy-item"},Kn={class:"item-value"},Zn={key:0,class:"additional-tests"},Xn={class:"test-tags"},Yn={class:"strategy-description"},Jn={class:"actions-section"},ea={__name:"RiskAnalysisCard",props:{riskData:{type:Object,default:null}},emits:["action-triggered"],setup(o,{emit:s}){const p=o,a=s;function m(C){return C==null?"未知":`${(C*100).toFixed(2)}%`}function i(C){if(!C)return"未知";const r=new Date(C);return`${r.toLocaleDateString()} ${r.toLocaleTimeString()}`}function f(C,r){if(!C||r===void 0)return"未知";switch(C){case"up":return`上升 ${r}%`;case"down":return`下降 ${r}%`;case"stable":return"保持稳定";default:return"未知"}}function $(C){return C>=80?"#8B0000":C>=60?"#F56C6C":C>=40?"#E6A23C":"#67C23A"}function v(C){switch(C){case"critical":return"danger";case"high":return"error";case"medium":return"warning";case"low":return"success";default:return"info"}}function S(C){switch(C){case"up":return"danger";case"down":return"success";case"stable":return"info";default:return"info"}}function g(C){a("action-triggered",{type:C,data:p.riskData})}return(C,r)=>{const w=d("el-progress"),l=d("el-tag"),y=d("el-descriptions-item"),R=d("el-descriptions"),L=d("el-col"),U=d("el-row"),z=d("el-card"),j=d("el-button"),B=d("el-empty");return b(),M("div",Vn,[o.riskData?(b(),M(ne,{key:0},[t("div",zn,[t("div",Un,[e(w,{type:"dashboard",percentage:o.riskData.riskScore,color:$(o.riskData.riskScore),"stroke-width":15},{default:n(()=>[t("div",Nn,[t("span",Fn,D(o.riskData.riskScore),1),r[3]||(r[3]=t("span",{class:"label"},"风险分",-1))])]),_:1},8,["percentage","color"])]),t("div",On,[e(l,{type:v(o.riskData.riskLevel.value),size:"large"},{default:n(()=>[k(D(o.riskData.riskLevel.label),1)]),_:1},8,["type"]),t("p",Pn,"更新于: "+D(i(o.riskData.timestamp)),1)])]),t("div",En,[r[4]||(r[4]=t("h4",null,"风险因素分析",-1)),e(R,{column:2,border:""},{default:n(()=>[e(y,{label:"平均缺陷率"},{default:n(()=>[k(D(m(o.riskData.factors.avgDefectRate)),1)]),_:1}),e(y,{label:"供应商稳定性"},{default:n(()=>[k(D(m(o.riskData.factors.supplierStability)),1)]),_:1}),e(y,{label:"批次一致性"},{default:n(()=>[k(D(m(o.riskData.factors.batchConsistency)),1)]),_:1}),e(y,{label:"历史对比"},{default:n(()=>[e(l,{type:S(o.riskData.historicalComparison.trendDirection)},{default:n(()=>[k(D(f(o.riskData.historicalComparison.trendDirection,o.riskData.historicalComparison.changePercentage)),1)]),_:1},8,["type"])]),_:1})]),_:1})]),t("div",Qn,[t("div",Bn,[r[5]||(r[5]=t("h4",null,"建议检验策略",-1)),e(l,{type:"info"},{default:n(()=>[k("优先级: "+D(o.riskData.recommendedStrategy.priority),1)]),_:1})]),e(z,{shadow:"hover"},{default:n(()=>[e(U,{gutter:20},{default:n(()=>[e(L,{span:8},{default:n(()=>[t("div",jn,[r[6]||(r[6]=t("div",{class:"item-label"},"检验水平",-1)),t("div",qn,D(o.riskData.recommendedStrategy.inspectionLevel),1)])]),_:1}),e(L,{span:8},{default:n(()=>[t("div",Hn,[r[7]||(r[7]=t("div",{class:"item-label"},"抽样大小",-1)),t("div",Wn,D(o.riskData.recommendedStrategy.sampleSize),1)])]),_:1}),e(L,{span:8},{default:n(()=>[t("div",Gn,[r[8]||(r[8]=t("div",{class:"item-label"},"检验频率",-1)),t("div",Kn,D(o.riskData.recommendedStrategy.frequency),1)])]),_:1})]),_:1}),o.riskData.recommendedStrategy.additionalTests.length>0?(b(),M("div",Zn,[r[9]||(r[9]=t("div",{class:"item-label"},"额外测试项目",-1)),t("div",Xn,[(b(!0),M(ne,null,re(o.riskData.recommendedStrategy.additionalTests,q=>(b(),ae(l,{key:q,size:"small",class:"test-tag"},{default:n(()=>[k(D(q),1)]),_:2},1024))),128))])])):K("",!0),t("div",Yn,D(o.riskData.recommendedStrategy.description),1)]),_:1})]),t("div",Jn,[e(j,{type:"primary",onClick:r[0]||(r[0]=q=>g("applyStrategy"))},{default:n(()=>r[10]||(r[10]=[k(" 应用策略 ")])),_:1,__:[10]}),e(j,{type:"success",onClick:r[1]||(r[1]=q=>g("exportReport"))},{default:n(()=>r[11]||(r[11]=[k(" 导出报告 ")])),_:1,__:[11]}),e(j,{onClick:r[2]||(r[2]=q=>g("explainAnalysis"))},{default:n(()=>r[12]||(r[12]=[k(" 解释分析 ")])),_:1,__:[12]})])],64)):(b(),ae(B,{key:1,description:"暂无风险分析数据"}))])}}},ta=pe(ea,[["__scopeId","data-v-2587ea93"]]),na={class:"trend-prediction-card"},aa={class:"trend-overview"},sa={class:"trend-indicator"},oa={class:"confidence"},la={class:"update-time"},ia={class:"trend-chart-container"},ra={class:"prediction-details"},ca={class:"actions-section"},da={__name:"TrendPredictionCard",props:{trendData:{type:Object,default:null}},emits:["action-triggered"],setup(o,{emit:s}){lt([Ze,Xe,Ye,Je,et,tt,st,ot,nt]);const p=o,a=s,m=V(null);let i=null;function f(R){if(!R)return"未知";const L=new Date(R);return`${L.toLocaleDateString()} ${L.toLocaleTimeString()}`}function $(R){return R?new Date(R).toLocaleDateString():"未知"}function v(R){switch(R){case"up":return"danger";case"down":return"success";case"stable":return"info";default:return"info"}}function S(R){switch(R){case"up":return"上升趋势";case"down":return"下降趋势";case"stable":return"稳定趋势";default:return"未知趋势"}}function g(R){return R>=.8?"#67C23A":R>=.6?"#E6A23C":"#F56C6C"}function C(R,L,U){if(L===0)return"info";const z=U[L-1].value;return R>z?"danger":R<z?"success":"info"}function r(R,L,U){if(L===0)return"基准点";const z=U[L-1].value,j=R-z,B=(Math.abs(j)/z*100).toFixed(1);return j>0?`上升 ${B}%`:j<0?`下降 ${B}%`:"持平"}function w(){m.value&&(i=Le(m.value),l(),window.addEventListener("resize",()=>{i&&i.resize()}))}function l(){if(!i||!p.trendData)return;const{prediction:R,trend:L}=p.trendData,U=R.map(Q=>$(Q.timestamp)),z=R.map(Q=>Q.value),j=R.map(Q=>Q.value*(1-(1-Q.confidence)/2)),B=R.map(Q=>Q.value*(1+(1-Q.confidence)/2)),q={title:{text:"质量趋势预测",left:"center"},tooltip:{trigger:"axis",formatter:function(Q){const H=Q[0].axisValue,oe=Q[0].data.toFixed(2),se=Q[1].data.toFixed(2),le=Q[2].data.toFixed(2);return`
          <div style="font-weight: bold; margin-bottom: 5px;">${H}</div>
          <div>预测值: ${oe}</div>
          <div>下限: ${se}</div>
          <div>上限: ${le}</div>
          <div>可信区间: ${se} - ${le}</div>
        `}},legend:{data:["预测值","可信区间"],bottom:0},grid:{left:"3%",right:"4%",bottom:"15%",top:"15%",containLabel:!0},xAxis:{type:"category",data:U,boundaryGap:!1},yAxis:{type:"value",name:"值",axisLabel:{formatter:"{value}"}},dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}],series:[{name:"预测值",type:"line",data:z,symbol:"circle",symbolSize:8,itemStyle:{color:L==="up"?"#F56C6C":L==="down"?"#67C23A":"#409EFF"},lineStyle:{width:3}},{name:"下限",type:"line",data:j,lineStyle:{opacity:0},stack:"confidence",symbol:"none"},{name:"上限",type:"line",data:B,lineStyle:{opacity:0},areaStyle:{color:"rgba(64, 158, 255, 0.2)"},stack:"confidence",symbol:"none"}]};i.setOption(q)}function y(R){a("action-triggered",{type:R,data:p.trendData})}return De(()=>p.trendData,()=>{l()},{deep:!0}),$e(()=>{w()}),onUnmounted(()=>{i&&(i.dispose(),i=null),window.removeEventListener("resize",()=>{i&&i.resize()})}),(R,L)=>{const U=d("el-tag"),z=d("el-progress"),j=d("el-table-column"),B=d("el-table"),q=d("el-button"),Q=d("el-empty");return b(),M("div",na,[o.trendData?(b(),M(ne,{key:0},[t("div",aa,[t("div",sa,[e(U,{type:v(o.trendData.trend),size:"large"},{default:n(()=>[k(D(S(o.trendData.trend)),1)]),_:1},8,["type"]),t("div",oa,[L[3]||(L[3]=t("span",{class:"label"},"置信度:",-1)),e(z,{percentage:Math.round(o.trendData.confidence*100),format:H=>`${H}%`,color:g(o.trendData.confidence),"stroke-width":10},null,8,["percentage","format","color"])]),t("p",la,"更新于: "+D(f(o.trendData.timestamp)),1)])]),t("div",ia,[t("div",{ref_key:"chartRef",ref:m,class:"trend-chart"},null,512)]),t("div",ra,[L[4]||(L[4]=t("h4",null,"预测详情",-1)),e(B,{data:o.trendData.prediction,style:{width:"100%"}},{default:n(()=>[e(j,{prop:"timestamp",label:"时间点",width:"180"},{default:n(H=>[k(D($(H.row.timestamp)),1)]),_:1}),e(j,{prop:"value",label:"预测值",width:"120"},{default:n(H=>[k(D(H.row.value.toFixed(2)),1)]),_:1}),e(j,{prop:"confidence",label:"置信度",width:"120"},{default:n(H=>[e(z,{percentage:Math.round(H.row.confidence*100),color:g(H.row.confidence),"stroke-width":6},null,8,["percentage","color"])]),_:1}),e(j,{label:"趋势"},{default:n(H=>[e(U,{type:C(H.row.value,H.$index,o.trendData.prediction)},{default:n(()=>[k(D(r(H.row.value,H.$index,o.trendData.prediction)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),t("div",ca,[e(q,{type:"primary",onClick:L[0]||(L[0]=H=>y("exportPrediction"))},{default:n(()=>L[5]||(L[5]=[k(" 导出预测 ")])),_:1,__:[5]}),e(q,{type:"success",onClick:L[1]||(L[1]=H=>y("createAlert"))},{default:n(()=>L[6]||(L[6]=[k(" 设置提醒 ")])),_:1,__:[6]}),e(q,{onClick:L[2]||(L[2]=H=>y("explainPrediction"))},{default:n(()=>L[7]||(L[7]=[k(" 解释预测 ")])),_:1,__:[7]})])],64)):(b(),ae(Q,{key:1,description:"暂无趋势预测数据"}))])}}},ua=pe(da,[["__scopeId","data-v-048686c2"]]),ma={class:"anomaly-detection-card"},pa={class:"anomaly-summary"},fa={class:"anomaly-count"},va={class:"updated-at"},ya={class:"anomaly-list"},_a={class:"anomaly-item-header"},ga={class:"anomaly-title"},ha={class:"anomaly-details"},ba={key:0,class:"anomaly-metrics"},ka={class:"anomaly-actions"},wa={class:"batch-actions"},Ca={key:1,class:"no-anomalies"},$a={__name:"AnomalyDetectionCard",props:{anomalyData:{type:Object,default:null}},emits:["action-triggered"],setup(o,{emit:s}){const p=o,a=s,m=V([0]);function i(l){if(!l)return"未知";const y=new Date(l);return`${y.toLocaleDateString()} ${y.toLocaleTimeString()}`}function f(l){return l==null?"未知":typeof l=="number"?l.toFixed(2):l.toString()}function $(l){if(l==null)return"未知";const y=(l*100).toFixed(2);return(l>=0?"+":"")+`${y}%`}function v(l){switch(l){case"critical":return"danger";case"high":return"error";case"medium":return"warning";case"low":return"info";default:return"info"}}function S(l){switch(l){case"critical":return"严重";case"high":return"高";case"medium":return"中";case"low":return"低";default:return"未知"}}function g(l){return l>=.8?"#67C23A":l>=.6?"#E6A23C":"#F56C6C"}function C(l){return Math.abs(l)<.05?"info":Math.abs(l)<.1?"warning":"danger"}function r(l,y){a("action-triggered",{type:l,anomaly:y,data:p.anomalyData})}function w(l){a("action-triggered",{type:l,data:p.anomalyData})}return(l,y)=>{const R=d("el-badge"),L=d("el-tag"),U=d("el-descriptions-item"),z=d("el-progress"),j=d("el-descriptions"),B=d("el-table-column"),q=d("el-table"),Q=d("el-button"),H=d("el-collapse-item"),oe=d("el-collapse"),se=d("el-result"),le=d("el-empty");return b(),M("div",ma,[o.anomalyData&&o.anomalyData.anomalies.length>0?(b(),M(ne,{key:0},[t("div",pa,[t("div",fa,[e(R,{value:o.anomalyData.anomalies.length,type:"warning",max:99},{default:n(()=>y[4]||(y[4]=[t("span",{class:"count-title"},"检测到的异常",-1)])),_:1,__:[4]},8,["value"])]),t("div",va," 更新于: "+D(i(o.anomalyData.timestamp)),1)]),t("div",ya,[e(oe,{modelValue:m.value,"onUpdate:modelValue":y[0]||(y[0]=x=>m.value=x)},{default:n(()=>[(b(!0),M(ne,null,re(o.anomalyData.anomalies,(x,u)=>(b(),ae(H,{key:u,name:u},{title:n(()=>[t("div",_a,[e(L,{type:v(x.severity),size:"small"},{default:n(()=>[k(D(S(x.severity)),1)]),_:2},1032,["type"]),t("span",ga,D(x.name),1)])]),default:n(()=>[t("div",ha,[e(j,{column:1,border:"",size:"small"},{default:n(()=>[e(U,{label:"异常类型"},{default:n(()=>[k(D(x.type),1)]),_:2},1024),e(U,{label:"异常描述"},{default:n(()=>[k(D(x.description),1)]),_:2},1024),e(U,{label:"发现时间"},{default:n(()=>[k(D(i(x.detectedAt)),1)]),_:2},1024),e(U,{label:"置信度"},{default:n(()=>[e(z,{percentage:Math.round(x.confidence*100),format:P=>`${P}%`,color:g(x.confidence),"stroke-width":10},null,8,["percentage","format","color"])]),_:2},1024)]),_:2},1024),x.metrics&&x.metrics.length>0?(b(),M("div",ba,[y[5]||(y[5]=t("h5",null,"关联指标",-1)),e(q,{data:x.metrics,style:{width:"100%"},size:"small"},{default:n(()=>[e(B,{prop:"name",label:"指标名称"}),e(B,{prop:"value",label:"观察值"},{default:n(P=>[k(D(f(P.row.value)),1)]),_:1}),e(B,{prop:"expected",label:"预期值"},{default:n(P=>[k(D(f(P.row.expected)),1)]),_:1}),e(B,{prop:"deviation",label:"偏差"},{default:n(P=>[e(L,{type:C(P.row.deviation)},{default:n(()=>[k(D($(P.row.deviation)),1)]),_:2},1032,["type"])]),_:1})]),_:2},1032,["data"])])):K("",!0),t("div",ka,[e(Q,{type:"primary",size:"small",onClick:P=>r("investigate",x)},{default:n(()=>y[6]||(y[6]=[k(" 调查异常 ")])),_:2,__:[6]},1032,["onClick"]),e(Q,{type:"success",size:"small",onClick:P=>r("resolve",x)},{default:n(()=>y[7]||(y[7]=[k(" 标记已解决 ")])),_:2,__:[7]},1032,["onClick"])])])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),t("div",wa,[e(Q,{type:"primary",onClick:y[1]||(y[1]=x=>w("exportAnomalies"))},{default:n(()=>y[8]||(y[8]=[k(" 导出异常报告 ")])),_:1,__:[8]}),e(Q,{onClick:y[2]||(y[2]=x=>w("configureDetection"))},{default:n(()=>y[9]||(y[9]=[k(" 配置检测规则 ")])),_:1,__:[9]})])],64)):o.anomalyData&&o.anomalyData.anomalies.length===0?(b(),M("div",Ca,[e(se,{icon:"success",title:"未检测到异常","sub-title":"当前物料没有发现任何异常，系统将持续监控"},{extra:n(()=>[e(Q,{type:"primary",onClick:y[3]||(y[3]=x=>w("configureDetection"))},{default:n(()=>y[10]||(y[10]=[k(" 配置检测规则 ")])),_:1,__:[10]})]),_:1})])):(b(),ae(le,{key:2,description:"暂无异常检测数据"}))])}}},Da=pe($a,[["__scopeId","data-v-7e087b2b"]]),Sa={class:"recommendation-card"},xa={class:"recommendation-overview"},Aa={class:"overview-header"},Ta={class:"update-time"},Ma={key:0,class:"context-info"},Ra={class:"recommendations-list"},Ia={class:"recommendation-item"},La={class:"recommendation-header"},Va={class:"recommendation-content"},za={class:"description"},Ua={class:"detail-item"},Na={class:"value"},Fa={class:"detail-item"},Oa={class:"value"},Pa={class:"detail-item"},Ea={class:"value"},Qa={class:"key-checkpoints"},Ba={class:"expected-outcome"},ja={class:"recommendation-actions"},qa={class:"global-actions"},Ha={__name:"RecommendationCard",props:{recommendationData:{type:Object,default:null}},emits:["action-triggered"],setup(o,{emit:s}){const p=o,a=s;function m(v){if(!v)return"未知";const S=new Date(v);return`${S.toLocaleDateString()} ${S.toLocaleTimeString()}`}function i(v){return v>=.8?"success":v>=.6?"warning":"info"}function f(v,S){a("action-triggered",{type:v,recommendation:S,data:p.recommendationData})}function $(v){a("action-triggered",{type:v,data:p.recommendationData})}return(v,S)=>{const g=d("el-alert"),C=d("el-tag"),r=d("el-divider"),w=d("el-col"),l=d("el-row"),y=d("el-button"),R=d("el-tab-pane"),L=d("el-tabs"),U=d("el-empty");return b(),M("div",Sa,[o.recommendationData&&o.recommendationData.recommendations.length>0?(b(),M(ne,{key:0},[t("div",xa,[t("div",Aa,[S[2]||(S[2]=t("h4",null,"检验策略推荐",-1)),t("p",Ta,"更新于: "+D(m(o.recommendationData.timestamp)),1)]),o.recommendationData.context?(b(),M("div",Ma,[e(g,{type:"info",closable:!1,"show-icon":""},{title:n(()=>[k(" AI推荐依据: "+D(o.recommendationData.context.reason),1)]),default:n(()=>[t("p",null,D(o.recommendationData.context.description),1)]),_:1})])):K("",!0)]),t("div",Ra,[e(L,{type:"border-card"},{default:n(()=>[(b(!0),M(ne,null,re(o.recommendationData.recommendations,(z,j)=>(b(),ae(R,{key:j,label:`策略 ${j+1}`},{default:n(()=>[t("div",Ia,[t("div",La,[t("h5",null,D(z.name),1),e(C,{type:i(z.confidence)},{default:n(()=>[k(" 置信度: "+D(Math.round(z.confidence*100))+"% ",1)]),_:2},1032,["type"])]),t("div",Va,[t("p",za,D(z.description),1),e(r,{"content-position":"left"},{default:n(()=>S[3]||(S[3]=[k("策略详情")])),_:1,__:[3]}),e(l,{gutter:20},{default:n(()=>[e(w,{span:8},{default:n(()=>[t("div",Ua,[S[4]||(S[4]=t("span",{class:"label"},"检验水平:",-1)),t("span",Na,D(z.details.inspectionLevel),1)])]),_:2},1024),e(w,{span:8},{default:n(()=>[t("div",Fa,[S[5]||(S[5]=t("span",{class:"label"},"抽样方案:",-1)),t("span",Oa,D(z.details.samplingPlan),1)])]),_:2},1024),e(w,{span:8},{default:n(()=>[t("div",Pa,[S[6]||(S[6]=t("span",{class:"label"},"检验频率:",-1)),t("span",Ea,D(z.details.frequency),1)])]),_:2},1024)]),_:2},1024),t("div",Qa,[S[7]||(S[7]=t("p",{class:"sub-title"},"关键检查点:",-1)),(b(!0),M(ne,null,re(z.details.keyCheckpoints,(B,q)=>(b(),ae(C,{key:q,class:"checkpoint-tag"},{default:n(()=>[k(D(B),1)]),_:2},1024))),128))]),t("div",Ba,[S[8]||(S[8]=t("p",{class:"sub-title"},"预期效果:",-1)),t("ul",null,[(b(!0),M(ne,null,re(z.details.expectedOutcomes,(B,q)=>(b(),M("li",{key:q},D(B),1))),128))])])]),t("div",ja,[e(y,{type:"primary",onClick:B=>f("apply",z)},{default:n(()=>S[9]||(S[9]=[k(" 应用此策略 ")])),_:2,__:[9]},1032,["onClick"]),e(y,{type:"success",onClick:B=>f("customize",z)},{default:n(()=>S[10]||(S[10]=[k(" 自定义修改 ")])),_:2,__:[10]},1032,["onClick"]),e(y,{onClick:B=>f("explain",z)},{default:n(()=>S[11]||(S[11]=[k(" 解释推荐 ")])),_:2,__:[11]},1032,["onClick"])])])]),_:2},1032,["label"]))),128))]),_:1})]),t("div",qa,[e(y,{type:"primary",onClick:S[0]||(S[0]=z=>$("exportRecommendations"))},{default:n(()=>S[12]||(S[12]=[k(" 导出所有推荐 ")])),_:1,__:[12]}),e(y,{onClick:S[1]||(S[1]=z=>$("historyRecommendations"))},{default:n(()=>S[13]||(S[13]=[k(" 查看历史推荐 ")])),_:1,__:[13]})])],64)):(b(),ae(U,{key:1,description:"暂无推荐策略数据"}))])}}},Wa=pe(Ha,[["__scopeId","data-v-a42fd9c3"]]),Ie={今天:()=>{const o=new Date;return o.setHours(0,0,0,0),{start:o,end:new Date}},昨天:()=>{const o=new Date;o.setDate(o.getDate()-1),o.setHours(0,0,0,0);const s=new Date;return s.setHours(0,0,0,0),{start:o,end:s}},本周:()=>{const o=new Date,s=o.getDay(),p=o.getDate()-s+(s===0?-6:1),a=new Date(o.setDate(p));return a.setHours(0,0,0,0),{start:a,end:new Date}},上周:()=>{const o=new Date,s=o.getDay(),p=o.getDate()-s+(s===0?-6:1),a=new Date(o.setDate(p-7));a.setHours(0,0,0,0);const m=new Date(o.setDate(p-1));return m.setHours(23,59,59,999),{start:a,end:m}},本月:()=>{const o=new Date;return{start:new Date(o.getFullYear(),o.getMonth(),1),end:new Date}},上个月:()=>{const o=new Date,s=new Date(o.getFullYear(),o.getMonth()-1,1),p=new Date(o.getFullYear(),o.getMonth(),0,23,59,59,999);return{start:s,end:p}},最近一周:()=>{const o=new Date,s=new Date(o);return s.setDate(s.getDate()-7),{start:s,end:o}},最近一个月:()=>{const o=new Date,s=new Date(o);return s.setMonth(s.getMonth()-1),{start:s,end:o}},最近三个月:()=>{const o=new Date,s=new Date(o);return s.setMonth(s.getMonth()-3),{start:s,end:o}}},Ae={entities:{inventory:["库存","物料","批次","仓库"],anomaly:["异常","缺陷","问题","故障","产线异常"],labTest:["测试","检验","实验","化验","检测"],risk:["风险","隐患","威胁"],trend:["趋势","走势","变化"]},actions:{query:["查询","查看","显示","列出","找出"],update:["更新","修改","变更","改变"],alert:["警告","提醒","通知"],analyze:["分析","评估","诊断"],recommend:["推荐","建议","提议"]},riskLevels:{high:["高风险","高危","严重"],medium:["中风险","中等风险","一般"],low:["低风险","轻微"]},status:{normal:["正常","普通","常规"],frozen:["冻结","锁定","停用"],inspection:["检验中","审核中","待检"]}};function Ga(o){const s={action:"query",entity:"inventory",filters:{}};for(const[i,f]of Object.entries(Ae.entities))if(f.some($=>o.includes($))){s.entity=i;break}for(const[i,f]of Object.entries(Ae.actions))if(f.some($=>o.includes($))){s.action=i;break}for(const[i,f]of Object.entries(Ae.riskLevels))if(f.some($=>o.includes($))){s.filters.riskLevel=i;break}for(const[i,f]of Object.entries(Ae.status))if(f.some($=>o.includes($))){s.filters.status=i;break}for(const[i,f]of Object.entries(Ie))if(o.includes(i)){s.timeRange=f();break}const p=o.match(/[Mm][0-9]{5,}/);p&&(s.filters.materialCode=p[0]);const a=o.match(/[Bb][0-9]{5,}/);a&&(s.filters.batchNumber=a[0]);const m=["供应商","厂商","供货商"];for(const i of m){const f=o.indexOf(i);if(f!==-1){const v=o.substring(f+i.length).trim().match(/^[：:]\s*([^\s,，.。]+)/);v&&(s.filters.supplier=v[1])}}return s}function Ka(o){const s={inventory:"库存",anomaly:"产线异常",labTest:"实验室测试",risk:"风险评估",trend:"趋势分析"};let a=`${{query:"查询",update:"更新",alert:"提醒",analyze:"分析",recommend:"推荐"}[o.action]}${s[o.entity]}`;const m=[];if(o.filters.riskLevel){const i={high:"高风险",medium:"中风险",low:"低风险"};m.push(i[o.filters.riskLevel])}if(o.filters.status){const i={normal:"正常",frozen:"已冻结",inspection:"检验中"};m.push(i[o.filters.status])}if(o.filters.materialCode&&m.push(`物料编码为${o.filters.materialCode}`),o.filters.batchNumber&&m.push(`批次号为${o.filters.batchNumber}`),o.filters.supplier&&m.push(`供应商为${o.filters.supplier}`),o.timeRange){const i=ze(o.timeRange.start),f=ze(o.timeRange.end);m.push(`时间范围从${i}到${f}`)}return m.length>0&&(a+=`（${m.join("、")}）`),a}function ze(o){return`${o.getFullYear()}年${o.getMonth()+1}月${o.getDate()}日`}const Ue={查询最近一周的产线异常:{action:"query",entity:"anomaly",filters:{},timeRange:Ie.最近一周()},分析高风险物料:{action:"analyze",entity:"inventory",filters:{riskLevel:"high"}},查看已冻结库存:{action:"query",entity:"inventory",filters:{status:"frozen"}},推荐处理方案:{action:"recommend",entity:"anomaly",filters:{status:"open"}},显示本月检验结果:{action:"query",entity:"labTest",filters:{},timeRange:Ie.本月()}};class Za{processQuery(s){for(const[p,a]of Object.entries(Ue))if(s.includes(p))return{...a};return Ga(s)}getIntentDescription(s){return Ka(s)}generateSuggestions(s){const p=[];for(const a of Object.keys(Ue))a.toLowerCase().includes(s.toLowerCase())&&p.push(a);return p.slice(0,5)}}class Xa{constructor(s){this.modelWeights={},this.thresholds={inventoryQualityScore:60,labTestDeviation:.15,supplierReliability:70,historicalAnomalyRate:.05,criticalTestFailure:!0},s&&(this.thresholds={...this.thresholds,...s}),this.initializeModelWeights()}initializeModelWeights(){this.modelWeights={material_complexity:.15,supplier_reliability:.25,historical_defect_rate:.3,shelf_life_remaining:.1,test_failure_rate:.2,dimension_anomaly:.15,appearance_anomaly:.1,functional_anomaly:.3,chemical_anomaly:.25,reliability_anomaly:.2}}detectInventoryAnomalies(s){const p=[];for(const a of s)a.qualityScore<this.thresholds.inventoryQualityScore&&p.push({entityType:"inventory",entityId:a.id,anomalyType:"low_quality_score",confidence:this.calculateConfidence(this.thresholds.inventoryQualityScore,a.qualityScore),suggestedActions:["建议增加抽检比例","检查供应商质量体系","考虑临时冻结库存"]}),a.riskLevel==="high"&&p.push({entityType:"inventory",entityId:a.id,anomalyType:"high_risk_level",confidence:.9,suggestedActions:["立即冻结库存","通知质量管理部门","安排全检计划"]}),a.expiryDate&&this.isNearExpiry(a.expiryDate)&&p.push({entityType:"inventory",entityId:a.id,anomalyType:"near_expiry",confidence:.95,suggestedActions:["优先使用该批次","考虑调整库存计划","评估是否需要报废"]});return p}detectLabTestAnomalies(s){const p=[];for(const a of s){a.overallResult==="fail"&&p.push({entityType:"labTest",entityId:a.id,anomalyType:"test_failure",confidence:.95,suggestedActions:["通知供应商测试失败情况","对相关批次进行全检","考虑暂停使用相关物料"]});for(const m of a.testItems)if(m.result==="fail"&&m.importance==="critical"){p.push({entityType:"labTest",entityId:a.id,anomalyType:"critical_test_item_failure",confidence:.98,suggestedActions:["立即冻结相关批次","通知生产部门停止使用","启动应急处理预案"]});break}for(const m of a.testItems){const i=Math.abs(m.actualValue-m.standardValue)/m.standardValue;i>this.thresholds.labTestDeviation&&p.push({entityType:"labTest",entityId:a.id,anomalyType:"significant_deviation",confidence:this.calculateConfidence(this.thresholds.labTestDeviation,i),suggestedActions:["复检该测试项目","分析偏差原因","评估对产品性能的影响"]})}}return p}detectProductionPatterns(s){const p=[],a=this.groupByProperty(s,"materialCode");for(const[i,f]of Object.entries(a))f.length>=3&&p.push({entityType:"production",entityId:i,anomalyType:"frequent_anomalies",confidence:this.calculateFrequencyConfidence(f.length),suggestedActions:["进行物料质量专项调查","检查供应商生产过程","考虑更换供应商"]}),f.filter(v=>v.severity==="critical").length>=2&&p.push({entityType:"production",entityId:i,anomalyType:"multiple_critical_issues",confidence:.9,suggestedActions:["立即暂停使用该物料","组织专家团队评估风险","制定应急替代方案"]});const m=this.groupByProperty(s,"productionLine");for(const[i,f]of Object.entries(m))f.length>=5&&p.push({entityType:"production",entityId:i,anomalyType:"production_line_issues",confidence:.85,suggestedActions:["检查产线设备状态","对操作人员进行培训","评估工艺参数是否合适"]});return p}predictMaterialRisk(s,p,a,m,i){const f=a.find(y=>y.materialCode===s&&y.batchNumber===p),$=m.filter(y=>y.materialCode===s&&y.batchNumber===p),v=i.filter(y=>y.materialCode===s&&y.batchNumber===p),S=i.filter(y=>y.materialCode===s&&y.batchNumber!==p),g=[];if(f){const y=100-f.qualityScore;g.push({factor:"物料质量评分",contribution:y*this.modelWeights.material_complexity/100})}if($.length>0){const y=$.flatMap(U=>U.testItems.filter(z=>z.result==="fail")),R=y.length/$.flatMap(U=>U.testItems).length*100;g.push({factor:"测试失败率",contribution:R*this.modelWeights.test_failure_rate/100}),y.filter(U=>U.importance==="critical").length>0&&g.push({factor:"关键测试项失败",contribution:.3})}if(S.length>0){const y=Math.min(S.length*.1,.3);g.push({factor:"历史异常记录",contribution:y});const R=S.filter(L=>L.severity==="critical").length;R>0&&g.push({factor:"历史严重异常",contribution:R*.15})}if(v.length>0){const y=Math.min(v.length*.15,.45);g.push({factor:"当前批次异常",contribution:y})}const C=Math.min(Math.round(g.reduce((y,R)=>y+R.contribution,0)*100),100);let r="low";C>=70?r="high":C>=40&&(r="medium");const w=this.predictPotentialIssues(s,g,$,S),l=this.generateRecommendations(r,g,w);return{materialCode:s,batchNumber:p,riskLevel:r,riskScore:C,riskFactors:g,projectedIssues:w,recommendedActions:l}}predictPotentialIssues(s,p,a,m){const i=[],f=m.map(C=>C.anomalyType),$={};f.forEach(C=>{$[C]=($[C]||0)+1});for(const[C,r]of Object.entries($)){const w=Math.min(r/m.length+.2,.9);i.push({issue:this.anomalyTypeToIssue(C),probability:w})}if(a.length>0){const C=a.flatMap(w=>w.testItems.filter(l=>l.result==="fail"));new Set(C.map(w=>w.name)).forEach(w=>{i.push({issue:`${w}测试不合格`,probability:.75})})}const v=p.filter(C=>C.contribution>.2).map(C=>C.factor);v.includes("关键测试项失败")&&i.push({issue:"产品性能不达标",probability:.85}),v.includes("历史严重异常")&&i.push({issue:"生产工艺稳定性问题",probability:.7});const S=[],g=new Map;return i.forEach(({issue:C,probability:r})=>{(!g.has(C)||g.get(C)<r)&&g.set(C,r)}),g.forEach((C,r)=>{S.push({issue:r,probability:C})}),S.sort((C,r)=>r.probability-C.probability)}anomalyTypeToIssue(s){return{dimension_anomaly:"尺寸规格问题",appearance_anomaly:"外观缺陷",functional_anomaly:"功能异常",chemical_anomaly:"化学成分异常",reliability_anomaly:"可靠性问题"}[s]||`${s}类型问题`}generateRecommendations(s,p,a){const m=[];s==="high"?(m.push("冻结该批次物料，避免用于生产"),m.push("对现有库存进行全检"),m.push("通知供应商关于风险情况")):s==="medium"?(m.push("增加该批次的抽检比例"),m.push("监控使用过程中的异常情况"),m.push("准备备选物料方案")):m.push("按常规检验流程处理");const i=p.filter(f=>f.contribution>.15).map(f=>f.factor);if(i.includes("测试失败率")&&m.push("重点关注失败测试项目，针对性改进"),i.includes("历史异常记录")&&m.push("分析历史异常共性，制定预防措施"),i.includes("当前批次异常")&&m.push("组织专项会议分析当前异常原因"),a.length>0){const f=a[0];f.probability>.7&&m.push(`针对${f.issue}制定专项防范措施`)}return[...new Set(m)]}calculateConfidence(s,p){const a=Math.abs(s-p),m=s*.5;return Math.min(.5+a/m*.5,.99)}calculateFrequencyConfidence(s){return Math.min(.7+(s-3)*.05,.95)}isNearExpiry(s){const p=new Date;return(s.getTime()-p.getTime())/(1e3*60*60*24*30)<3}groupByProperty(s,p){return s.reduce((a,m)=>{const i=String(m[p]);return a[i]=a[i]||[],a[i].push(m),a},{})}}function Ne(){return"id_"+Math.random().toString(36).substring(2,15)+Math.random().toString(36).substring(2,15)+"_"+Date.now()}class Ya{constructor(){this.recommendationHistory=new Map,this.rules=[],this.initializeRules()}initializeRules(){this.rules.push({context:{riskLevel:"high"},recommendation:{type:"inventory_action",priority:"high",description:"高风险物料库存冻结",reasoning:"基于物料的高风险评级，建议冻结相关库存以防止潜在的质量问题影响生产。",suggestedActions:[{action:"冻结所有相关批次库存",expectedOutcome:"防止不合格物料进入生产流程"},{action:"通知相关部门和供应商",expectedOutcome:"协调解决方案并启动替代计划"}],historicalSuccess:{implementationCount:24,successRate:.92}}}),this.rules.push({context:{riskLevel:"medium"},recommendation:{type:"inventory_action",priority:"medium",description:"增加中风险物料抽检频率",reasoning:"物料风险等级为中等，建议增加抽检频率以监控物料质量状况。",suggestedActions:[{action:"将抽检比例从标准的3%提高到8%",expectedOutcome:"及早发现潜在质量问题"},{action:"针对关键参数进行重点检测",expectedOutcome:"确保产品核心性能不受影响"}],historicalSuccess:{implementationCount:56,successRate:.85}}}),this.rules.push({context:{testResult:"fail"},recommendation:{type:"inspection",priority:"high",description:"失败测试项目复检与根因分析",reasoning:"测试结果显示失败项目，需要确认测试结果准确性并找出根本原因。",suggestedActions:[{action:"对失败项目进行复检",expectedOutcome:"验证测试结果准确性"},{action:"进行根因分析",expectedOutcome:"识别问题源头并制定解决方案"},{action:"评估对相关批次的影响",expectedOutcome:"确定问题范围和严重程度"}]}}),this.rules.push({context:{anomalyType:"frequent_anomalies"},recommendation:{type:"production_change",priority:"medium",description:"产线工艺参数优化",reasoning:"频繁出现的异常可能与产线工艺参数设置不合理有关。",suggestedActions:[{action:"分析工艺参数与异常的相关性",expectedOutcome:"识别关键影响因素"},{action:"小批量试产不同参数组合",expectedOutcome:"确定最优参数设置"},{action:"更新工艺规范文件",expectedOutcome:"标准化最佳实践"}]}}),this.rules.push({context:{anomalyType:"critical_test_item_failure"},recommendation:{type:"supplier_action",priority:"critical",description:"要求供应商提交改进计划",reasoning:"关键测试项目失败表明供应商质量控制存在严重问题。",suggestedActions:[{action:"要求供应商提交详细的纠正预防措施报告",expectedOutcome:"确保问题得到系统性解决"},{action:"安排供应商质量审核",expectedOutcome:"验证供应商质量管理体系有效性"},{action:"评估替代供应商可行性",expectedOutcome:"降低供应链风险"}]}})}async generateRecommendations(s){var i,f,$;const p={materialCode:s.materialCode,batchNumber:s.batchNumber,riskLevel:s.riskLevel||((i=s.inventory)==null?void 0:i.riskLevel)||"low",anomalyType:(f=s.anomaly)==null?void 0:f.anomalyType,testResult:(($=s.test)==null?void 0:$.overallResult)==="fail"?"fail":"pass"},m=this.findMatchingRules(p).map(v=>({id:Ne(),...v.recommendation}));return this.prioritizeRecommendations(m)}findMatchingRules(s){return this.rules.filter(p=>{for(const[a,m]of Object.entries(p.context))if(m!==void 0&&s[a]!==m)return!1;return!0})}prioritizeRecommendations(s){const p={critical:4,high:3,medium:2,low:1};return s.sort((a,m)=>{var v,S;const i=p[m.priority]-p[a.priority];if(i!==0)return i;const f=((v=a.historicalSuccess)==null?void 0:v.successRate)||0;return(((S=m.historicalSuccess)==null?void 0:S.successRate)||0)-f})}async trackRecommendationOutcome(s,p,a,m){if(!this.recommendationHistory.has(s)){console.warn(`推荐ID不存在: ${s}`);return}const i=this.recommendationHistory.get(s);if(i.implemented=p,i.outcome=a,p&&a){const f=i.recommendation,$=f.historicalSuccess||{implementationCount:0,successRate:0};$.implementationCount+=1;const v=a==="positive"?1:a==="neutral"?.5:0;$.successRate=($.successRate*($.implementationCount-1)+v)/$.implementationCount,f.historicalSuccess=$}console.log(`推荐反馈已记录: ${s}, 实施: ${p}, 结果: ${a}`)}async getRecommendationsForMaterial(s,p){return this.generateRecommendations({materialCode:s,batchNumber:p})}async getTopRecommendations(s=5){const p=await Promise.all(this.rules.filter(a=>a.recommendation.priority==="high"||a.recommendation.priority==="critical").map(a=>({id:Ne(),...a.recommendation})));return this.prioritizeRecommendations(p).slice(0,s)}}const Ja={name:"AIInsightsPanel",components:{RiskAnalysisCard:ta,TrendPredictionCard:ua,AnomalyDetectionCard:Da,RecommendationCard:Wa},props:{selectedMaterialCode:{type:String,default:null},selectedBatchNumber:{type:String,default:null}},setup(o){const s=new Za;new Xa;const p=new Ya,a=V(!1),m=V(""),i=V([]),f=V(null),$=V([]),v=V(null),S=V(null),g=V([]),C=V([]),r=V(!1),w=V(!1),l=V(!1),y=V(!1),R=Te(()=>f.value?s.getIntentDescription(f.value):"");$e(()=>{L()}),De(()=>[o.selectedMaterialCode,o.selectedBatchNumber],()=>{o.selectedMaterialCode&&o.selectedBatchNumber&&U()});const L=async()=>{a.value=!0;try{C.value=await p.getTopRecommendations(3),y.value=C.value.length>0,O()}catch(N){console.error("加载AI分析数据失败:",N)}finally{a.value=!1}},U=async()=>{if(!(!o.selectedMaterialCode||!o.selectedBatchNumber)){a.value=!0;try{v.value={materialCode:o.selectedMaterialCode,batchNumber:o.selectedBatchNumber,riskLevel:"medium",riskScore:65,riskFactors:[{factor:"物料质量评分",contribution:.3},{factor:"历史异常记录",contribution:.2},{factor:"供应商可靠性",contribution:.15}],projectedIssues:[{issue:"尺寸规格问题",probability:.75},{issue:"外观缺陷",probability:.45}]},r.value=!0,C.value=await p.getRecommendationsForMaterial(o.selectedMaterialCode,o.selectedBatchNumber),y.value=C.value.length>0}catch(N){console.error("分析物料数据失败:",N)}finally{a.value=!1}}},z=()=>{m.value.length>2?i.value=s.generateSuggestions(m.value):i.value=[]},j=N=>{m.value=N,i.value=[],B()},B=async()=>{if(m.value.trim()){a.value=!0,i.value=[];try{f.value=s.processQuery(m.value),f.value.action==="query"?await q():f.value.action==="analyze"?await Q():f.value.action==="recommend"&&await H()}catch(N){console.error("执行查询失败:",N)}finally{a.value=!1}}},q=async()=>{$.value=Y(f.value)},Q=async()=>{f.value.entity==="risk"?r.value=!0:f.value.entity==="trend"?w.value=!0:f.value.entity==="anomaly"&&(l.value=!0)},H=async()=>{C.value=await p.getTopRecommendations(5),y.value=!0},oe=N=>{console.log("风险分析操作:",N)},se=N=>{console.log("趋势预测操作:",N)},le=N=>{console.log("异常检测操作:",N)},x=(N,W)=>{console.log("推荐操作:",N,W)},u=N=>{if(!N)return"";const W=new Date(N);return`${W.getFullYear()}-${String(W.getMonth()+1).padStart(2,"0")}-${String(W.getDate()).padStart(2,"0")}`},P=N=>({normal:"正常",frozen:"冻结",inspection:"检验中"})[N]||N,A=N=>({low:"低风险",medium:"中风险",high:"高风险"})[N]||N,c=N=>({low:"轻微",medium:"一般",high:"严重",critical:"紧急"})[N]||N,T=N=>({pass:"通过",fail:"不通过",warning:"警告"})[N]||N,F=N=>!N||!Array.isArray(N)?0:N.filter(W=>W.result==="pass").length,O=()=>{v.value={materialCode:"M12345",batchNumber:"B20230501",riskLevel:"medium",riskScore:58,riskFactors:[{factor:"物料质量评分",contribution:.25},{factor:"历史异常记录",contribution:.15},{factor:"供应商可靠性",contribution:.18}],projectedIssues:[{issue:"尺寸规格问题",probability:.65},{issue:"外观缺陷",probability:.4}]},r.value=!0,S.value={predictedAnomalies:12,historicalAverage:8,trend:"increasing",confidenceLevel:.85,timeframe:"未来30天",categories:[{name:"尺寸问题",count:5,percentage:41.7},{name:"外观缺陷",count:3,percentage:25},{name:"功能异常",count:2,percentage:16.7},{name:"其他",count:2,percentage:16.7}]},w.value=!0,g.value=[{entityType:"inventory",entityId:"INV123",anomalyType:"low_quality_score",confidence:.89,suggestedActions:["建议增加抽检比例","检查供应商质量体系"]},{entityType:"labTest",entityId:"LT456",anomalyType:"critical_test_item_failure",confidence:.95,suggestedActions:["立即冻结相关批次","通知生产部门停止使用"]}],l.value=!0},Y=N=>N.entity==="inventory"?[{type:"inventory",id:"INV001",materialCode:"M12345",materialName:"标准螺丝5mm",batchNumber:"B20230501",quantity:5e3,status:"normal",location:"A区-12-3",supplier:"优质五金供应商",riskLevel:"low"},{type:"inventory",id:"INV002",materialCode:"M12346",materialName:"标准螺丝8mm",batchNumber:"B20230502",quantity:3e3,status:"inspection",location:"A区-12-4",supplier:"优质五金供应商",riskLevel:"medium"}]:N.entity==="anomaly"?[{type:"anomaly",id:"ANO001",date:new Date("2023-05-10"),productionLine:"A线-1",materialCode:"M12345",batchNumber:"B20230501",anomalyType:"尺寸规格问题",severity:"medium",description:"螺丝直径超出公差范围"},{type:"anomaly",id:"ANO002",date:new Date("2023-05-12"),productionLine:"B线-2",materialCode:"M12346",batchNumber:"B20230502",anomalyType:"外观缺陷",severity:"low",description:"表面镀层不均匀"}]:N.entity==="labTest"?[{type:"labTest",id:"LT001",date:new Date("2023-05-09"),materialCode:"M12345",materialName:"标准螺丝5mm",batchNumber:"B20230501",testType:"尺寸检测",inspector:"张工",overallResult:"pass",testItems:[{name:"直径",result:"pass"},{name:"长度",result:"pass"},{name:"螺纹间距",result:"pass"}]},{type:"labTest",id:"LT002",date:new Date("2023-05-11"),materialCode:"M12346",materialName:"标准螺丝8mm",batchNumber:"B20230502",testType:"强度测试",inspector:"李工",overallResult:"fail",testItems:[{name:"抗拉强度",result:"pass"},{name:"抗弯强度",result:"fail"},{name:"硬度",result:"pass"}]}]:[];return{loading:a,queryInput:m,suggestions:i,currentIntent:f,intentDescription:R,queryResults:$,riskData:v,trendData:S,anomalyData:g,recommendations:C,showRiskAnalysis:r,showTrendPrediction:w,showAnomalyDetection:l,showRecommendations:y,refreshInsights:L,handleQueryInput:z,selectSuggestion:j,executeQuery:B,handleRiskAction:oe,handleTrendAction:se,handleAnomalyAction:le,handleRecommendationAction:x,formatDate:u,formatStatus:P,formatRiskLevel:A,formatSeverity:c,formatTestResult:T,countPassedItems:F}}},es={class:"ai-insights-panel"},ts={class:"panel-header"},ns={class:"panel-actions"},as={key:0,class:"loading-container"},ss={key:1,class:"panel-content"},os={class:"nlp-query-section"},ls={class:"query-input-container"},is={key:0,class:"suggestions"},rs=["onClick"],cs={key:0,class:"current-intent"},ds={class:"intent-header"},us={class:"intent-description"},ms={class:"insights-cards"},ps={key:1,class:"query-results"},fs={class:"results-container"},vs={key:0,class:"inventory-result"},ys={class:"result-header"},_s={class:"material-code"},gs={class:"material-name"},hs={class:"batch-number"},bs={class:"result-details"},ks={class:"detail-item"},ws={class:"value"},Cs={class:"detail-item"},$s={class:"detail-item"},Ds={key:1,class:"anomaly-result"},Ss={class:"result-header"},xs={class:"date"},As={class:"production-line"},Ts={class:"result-details"},Ms={class:"detail-item"},Rs={class:"value"},Is={class:"detail-item"},Ls={class:"value"},Vs={class:"detail-item"},zs={class:"value"},Us={key:2,class:"lab-test-result"},Ns={class:"result-header"},Fs={class:"date"},Os={class:"material-info"},Ps={class:"result-details"},Es={class:"detail-item"},Qs={class:"value"},Bs={class:"detail-item"},js={class:"value"},qs={class:"detail-item test-items-summary"},Hs={class:"value"};function Ws(o,s,p,a,m,i){const f=d("risk-analysis-card"),$=d("trend-prediction-card"),v=d("anomaly-detection-card"),S=d("recommendation-card");return b(),M("div",es,[t("div",ts,[s[6]||(s[6]=t("h2",null,"AI 智能分析",-1)),t("div",ns,[t("button",{onClick:s[0]||(s[0]=(...g)=>a.refreshInsights&&a.refreshInsights(...g)),class:"refresh-btn"},s[5]||(s[5]=[t("i",{class:"fas fa-sync-alt"},null,-1),k(" 刷新分析 ")]))])]),a.loading?(b(),M("div",as,s[7]||(s[7]=[t("div",{class:"spinner"},null,-1),t("p",null,"AI正在分析数据...",-1)]))):(b(),M("div",ss,[t("div",os,[t("div",ls,[_e(t("input",{"onUpdate:modelValue":s[1]||(s[1]=g=>a.queryInput=g),onInput:s[2]||(s[2]=(...g)=>a.handleQueryInput&&a.handleQueryInput(...g)),onKeyup:s[3]||(s[3]=Oe((...g)=>a.executeQuery&&a.executeQuery(...g),["enter"])),placeholder:"使用自然语言提问，例如：查询最近一周的产线异常",class:"query-input"},null,544),[[Ge,a.queryInput]]),t("button",{onClick:s[4]||(s[4]=(...g)=>a.executeQuery&&a.executeQuery(...g)),class:"query-btn"},s[8]||(s[8]=[t("i",{class:"fas fa-search"},null,-1)]))]),a.suggestions.length>0?(b(),M("div",is,[(b(!0),M(ne,null,re(a.suggestions,(g,C)=>(b(),M("div",{key:C,onClick:r=>a.selectSuggestion(g),class:"suggestion-item"},D(g),9,rs))),128))])):K("",!0)]),a.currentIntent?(b(),M("div",cs,[t("div",ds,[s[9]||(s[9]=t("span",{class:"intent-label"},"当前查询:",-1)),t("span",us,D(a.intentDescription),1)])])):K("",!0),t("div",ms,[a.showRiskAnalysis?(b(),ae(f,{key:0,"risk-data":a.riskData,onActionClick:a.handleRiskAction},null,8,["risk-data","onActionClick"])):K("",!0),a.showTrendPrediction?(b(),ae($,{key:1,"trend-data":a.trendData,onActionClick:a.handleTrendAction},null,8,["trend-data","onActionClick"])):K("",!0),a.showAnomalyDetection?(b(),ae(v,{key:2,"anomaly-data":a.anomalyData,onActionClick:a.handleAnomalyAction},null,8,["anomaly-data","onActionClick"])):K("",!0),a.showRecommendations?(b(),ae(S,{key:3,recommendations:a.recommendations,onActionClick:a.handleRecommendationAction},null,8,["recommendations","onActionClick"])):K("",!0)]),a.queryResults.length>0?(b(),M("div",ps,[s[19]||(s[19]=t("h3",null,"查询结果",-1)),t("div",fs,[(b(!0),M(ne,null,re(a.queryResults,(g,C)=>(b(),M("div",{key:C,class:"result-item"},[g.type==="inventory"?(b(),M("div",vs,[t("div",ys,[t("span",_s,D(g.materialCode),1),t("span",gs,D(g.materialName),1),t("span",hs,"批次: "+D(g.batchNumber),1)]),t("div",bs,[t("div",ks,[s[10]||(s[10]=t("span",{class:"label"},"库存数量:",-1)),t("span",ws,D(g.quantity),1)]),t("div",Cs,[s[11]||(s[11]=t("span",{class:"label"},"状态:",-1)),t("span",{class:ke(["value","status-"+g.status])},D(a.formatStatus(g.status)),3)]),t("div",$s,[s[12]||(s[12]=t("span",{class:"label"},"风险等级:",-1)),t("span",{class:ke(["value","risk-"+g.riskLevel])},D(a.formatRiskLevel(g.riskLevel)),3)])])])):g.type==="anomaly"?(b(),M("div",Ds,[t("div",Ss,[t("span",xs,D(a.formatDate(g.date)),1),t("span",As,"产线: "+D(g.productionLine),1),t("span",{class:ke(["severity","severity-"+g.severity])},D(a.formatSeverity(g.severity)),3)]),t("div",Ts,[t("div",Ms,[s[13]||(s[13]=t("span",{class:"label"},"物料:",-1)),t("span",Rs,D(g.materialCode)+" / "+D(g.batchNumber),1)]),t("div",Is,[s[14]||(s[14]=t("span",{class:"label"},"异常类型:",-1)),t("span",Ls,D(g.anomalyType),1)]),t("div",Vs,[s[15]||(s[15]=t("span",{class:"label"},"描述:",-1)),t("span",zs,D(g.description),1)])])])):g.type==="labTest"?(b(),M("div",Us,[t("div",Ns,[t("span",Fs,D(a.formatDate(g.date)),1),t("span",Os,D(g.materialCode)+" / "+D(g.batchNumber),1),t("span",{class:ke(["overall-result","result-"+g.overallResult])},D(a.formatTestResult(g.overallResult)),3)]),t("div",Ps,[t("div",Es,[s[16]||(s[16]=t("span",{class:"label"},"测试类型:",-1)),t("span",Qs,D(g.testType),1)]),t("div",Bs,[s[17]||(s[17]=t("span",{class:"label"},"检验员:",-1)),t("span",js,D(g.inspector),1)]),t("div",qs,[s[18]||(s[18]=t("span",{class:"label"},"测试项目:",-1)),t("span",Hs,"通过 "+D(a.countPassedItems(g.testItems))+"/"+D(g.testItems.length),1)])])])):K("",!0)]))),128))])])):K("",!0)]))])}const Gs=pe(Ja,[["render",Ws],["__scopeId","data-v-41e3d410"]]),Ks={class:"ai-assistant-container"},Zs={class:"assistant-layout"},Xs={class:"chat-section"},Ys={class:"scenario-cards"},Js={class:"quick-questions"},eo={class:"features-section"},to={key:0,class:"insight-panel-container"},no={class:"material-info-header"},ao={class:"material-details"},so={class:"material-tags"},oo={key:1,class:"no-material-selected"},lo={class:"actions-container"},io={key:1,class:"action-cards"},ro={class:"action-header"},co={class:"action-content"},uo={class:"dialog-footer"},mo={__name:"AiAssistant",setup(o){const s=at(),p=V("general"),a=V("insights");ge({nlp:!0,visualization:!0,vision:!0,predictive:!0,integration:!0}),V(1280),V(96.5),V(["电气参数","物理特性","可靠性","功能测试","外观检查"]),V([{date:"2025/05/26",project:"X6725B",projectPhase:"量产",componentType:"结构件",anomalyType:"可靠性",urgencyLevel:"返工生产",responsibleFactory:"南昌工厂",location:"IQC",materialCode:"37301062",materialName:"电池盖",description:"装卸100次后针变形（标准500次），不良率2/3",supplier:"金盾",responsibility:"来料",riskLevel:"B"},{date:"2025/05/25",project:"X6725B",projectPhase:"量产",componentType:"包材",anomalyType:"外观",urgencyLevel:"克服生产",responsibleFactory:"泰衡诺工厂",location:"产线",materialCode:"38501375",materialName:"保护膜",description:"酒精耐磨500g×25次掉漆油墨",supplier:"易湛",responsibility:"来料",riskLevel:"C"}]);const m=V([{testDate:"2025/05/26",testSource:"深圳实验室来料例行测试",project:"X6725",materialCode:"38501375",materialName:"保护膜（全包膜）",testItem:"酒精耐磨 500g × 25次掉漆油墨",result:"NG",badBatch:"#03, #04",defectRate:"2/2（100%）",supplier:"易湛",responsibility:"来料",recommendation:"整批物料标记为不合格，建议暂停上线使用",remarks:"与生产端返工记录匹配（见2025/05/26记录）"},{testDate:"2025/05/24",testSource:"南昌实验室来料检测",project:"X6725",materialCode:"37301062",materialName:"电池盖",testItem:"连续开合耐久性测试 500次",result:"NG",badBatch:"#A22, #A23",defectRate:"2/3（66.7%）",supplier:"金盾",responsibility:"来料",recommendation:"返工处理，增加抽检比例",remarks:"与上月同批次问题相似，建议供应商改进工艺"}]);V({criticalAlerts:2,pendingReviews:7,lastRefreshTime:new Date().toLocaleString()});const i=ge({general:["分析最近一周的质量趋势","识别最常见的缺陷类型","哪些物料需要加强检验?","生成月度质量报告"],factory:["南昌工厂返工率趋势如何?","金盾供应商的材料合格率","分析电池盖变形原因","推荐结构件检验标准"],lab:["分析X6725B可靠性问题","易湛耐磨不良统计汇总","对比不同批次电池盖质量","生成测试偏差报告"],online:["预测下批次保护膜良率","物料#38501375缺陷趋势","C级风险物料清单","推荐产线质量改进方案"],supplier:["评估易湛供应商质量等级","金盾供应商质量趋势分析","供应商质量排名前5","供应商来料不良TOP5"]});function f(h){switch(h){case"factory":return'您好，我是IQE工厂质检助手。我可以帮助您分析物料异常数据，评估供应商质量，追踪返工记录，以及生成针对性的物料质量报告。最近"电池盖（料号37301062）"出现可靠性问题，您需要了解相关情况吗？';case"lab":return'您好，我是IQE实验室助手。我可以帮助您分析测试数据，比对检验批次，评估测试标准，以及生成测试报告。最近"保护膜（料号38501375）"酒精耐磨测试100%不良，我可以提供详细分析。';case"online":return"您好，我是IQE产线助手。我可以帮助您分析在线生产数据，识别缺陷模式，追踪批次质量，以及预测潜在风险。目前有2个C级质量风险需要关注，需要我列出详情吗？";case"supplier":return'您好，我是IQE供应商质量助手。我可以帮助您评估供应商质量表现，分析质量趋势，识别高风险供应商，以及生成供应商质量报告。目前"易湛"供应商被评为C级(高风险)，需要我提供详细分析吗？';default:return`您好，我是IQE智能助手，有什么可以帮您？

根据最新数据，我发现：
- 易湛供应商保护膜存在严重质量问题（100%不良率）
- 电池盖耐久性测试未达标准（66.7%不良率）
- 南昌工厂返工率上升5.2%

您想了解哪方面的详细信息？`}}const $=Te(()=>{if(!R.value)return[];const h=[{icon:"el-icon-warning",title:"生成异常物料报告",description:"基于最近一周的异常记录，生成物料质量分析报告",action:"generateReport"},{icon:"el-icon-pie-chart",title:"检测结果分析",description:"对比近期实验室检测结果，识别潜在风险模式",action:"analyzeTestResults"}],_=R.value.toLowerCase();if(_.includes("保护膜")||_.includes("38501375"))return[{icon:"el-icon-document",title:"保护膜质量分析",description:"分析料号38501375的历史质量数据和测试结果",action:"analyzeMaterial",params:{materialCode:"38501375"}},{icon:"el-icon-warning",title:"供应商易湛评估",description:"查看易湛供应商最近6个月的质量表现和异常记录",action:"analyzeSupplier",params:{supplierCode:"SUP002"}},{icon:"el-icon-data-line",title:"生成检测方案",description:"为下批次保护膜生成强化检验方案",action:"generateInspectionPlan",params:{materialCode:"38501375",riskLevel:"high"}},{icon:"el-icon-trend-charts",title:"预测质量趋势",description:"使用AI模型预测未来30天内的质量趋势",action:"predictQualityTrend",params:{materialCode:"38501375",days:30}}];if(_.includes("电池盖")||_.includes("37301062"))return[{icon:"el-icon-document",title:"电池盖可靠性分析",description:"分析料号37301062的耐久性测试数据",action:"analyzeMaterial",params:{materialCode:"37301062"}},{icon:"el-icon-video-camera",title:"查看失效视频",description:"观看电池盖变形失效的测试记录视频",action:"viewFailureVideo",params:{materialCode:"37301062",testType:"reliability"}},{icon:"el-icon-s-cooperation",title:"工艺改进建议",description:"基于历史数据，推荐供应商金盾的工艺改进方向",action:"generateImprovementPlan",params:{materialCode:"37301062",supplierCode:"SUP001"}},{icon:"el-icon-connection",title:"集成数据分析",description:"整合实验室、生产线和质量数据进行全面分析",action:"integratedAnalysis",params:{materialCode:"37301062"}}];if(_.includes("供应商")||_.includes("评估")){const I=_.includes("易湛"),ee=_.includes("金盾");return[{icon:"el-icon-user",title:`${I?"易湛":ee?"金盾":"供应商"}质量评估`,description:`分析${I?"易湛":ee?"金盾":"所有"}供应商的质量表现`,action:"analyzeSupplier",params:{supplierCode:I?"SUP002":ee?"SUP001":"all"}},{icon:"el-icon-data-analysis",title:"供应商质量趋势",description:"分析供应商近6个月质量分数变化趋势",action:"analyzeSupplierTrend",params:{supplierCode:I?"SUP002":ee?"SUP001":"all"}},{icon:"el-icon-document-checked",title:"供应商审核计划",description:"生成供应商质量审核计划",action:"generateAuditPlan",params:{supplierCode:I?"SUP002":ee?"SUP001":"all",priority:I?"high":ee?"medium":"normal"}}]}if(_.includes("预测")||_.includes("趋势"))return y.value=!0,a.value="prediction",[{icon:"el-icon-trend-charts",title:"质量趋势预测",description:"使用AI预测未来30天的质量趋势",action:"predictQualityTrend",params:{days:30}},{icon:"el-icon-warning",title:"风险物料预警",description:"识别未来可能出现质量问题的高风险物料",action:"predictRiskMaterials"},{icon:"el-icon-document",title:"生成预测报告",description:"生成详细的AI预测分析报告",action:"generatePredictionReport"}];switch(p.value){case"factory":return[...h,{icon:"el-icon-reading",title:"返工流程优化",description:"分析返工生产流程并提供优化建议",action:"optimizeReworkProcess"},{icon:"el-icon-receiving",title:"来料质检计划",description:"生成针对高风险供应商的强化IQC计划",action:"generateInspectionPlan",params:{target:"incoming"}}];case"lab":return[...h,{icon:"el-icon-coordinate",title:"测试标准调整",description:"根据近期不良趋势，推荐测试标准调整",action:"optimizeTestStandards"},{icon:"el-icon-finished",title:"批次质量预测",description:"基于历史数据预测即将到货批次的质量风险",action:"predictBatchQuality"}];case"online":return[...h,{icon:"el-icon-alarm-clock",title:"质量预警配置",description:"设置基于AI的实时质量异常预警规则",action:"configureQualityAlerts"},{icon:"el-icon-set-up",title:"产线参数优化",description:"根据质量数据推荐生产线参数调整",action:"optimizeProductionParams"}];case"supplier":return[...h,{icon:"el-icon-user",title:"供应商评级",description:"生成供应商质量等级评估报告",action:"rateSuppliers"},{icon:"el-icon-document-checked",title:"供应商质量改进计划",description:"为高风险供应商生成质量改进计划",action:"generateSupplierImprovementPlan"}];default:return h}}),v=V(null),S=V(null),g=V(null),C=V(null),r=V(!1),w=V(!1),l=V(!1),y=V(!1),R=V(""),L=V(!1),U=V(null),z=ge({code:"",name:"",supplier:""}),j=V([{code:"37301062",name:"电池盖",type:"结构件",supplier:"金盾",lastInspection:"2025/05/24",riskLevel:"B",defectRate:.25,factoryData:{},labData:{}},{code:"38501375",name:"保护膜",type:"包材",supplier:"易湛",lastInspection:"2025/05/26",riskLevel:"C",defectRate:.65,factoryData:{},labData:{}},{code:"37402185",name:"屏幕组件",type:"电子元件",supplier:"盛达",lastInspection:"2025/05/22",riskLevel:"A",defectRate:.05,factoryData:{},labData:{}}]),B=Te(()=>j.value.filter(h=>{const _=!z.code||h.code.includes(z.code),I=!z.name||h.name.includes(z.name),ee=!z.supplier||h.supplier===z.supplier;return _&&I&&ee}));function q(h){switch(h){case"A":return"success";case"B":return"warning";case"C":return"danger";default:return"info"}}function Q(){console.log("搜索物料，当前条件:",z)}function H(){z.code="",z.name="",z.supplier=""}function oe(h){U.value=h}function se(){U.value&&(L.value=!1,a.value="insights",Z.success(`已选择物料: ${U.value.name} (${U.value.code})`))}function le(h){S.value&&S.value.speakText(h)}function x(h){R.value=h,v.value&&(v.value.addUserMessage(h),v.value.addBotMessage(`已收到您的语音消息: "${h}"`))}function u(){v.value&&v.value.startSpeechRecognition()}function P(){v.value&&v.value.stopSpeechRecognition()}async function A(h,_,I){R.value=h;const ee=c(h);if(ee){I({type:"text",content:`正在为您导航至${ee.name}页面，请稍候...`}),setTimeout(()=>{s.push(ee.path)},1e3);return}(h.toLowerCase().includes("图表")||h.toLowerCase().includes("趋势")||h.toLowerCase().includes("统计"))&&(l.value=!0,a.value="chart",setTimeout(()=>{v.value&&v.value.addBotMessage("正在生成相关数据图表..."),ie(h)},1e3)),(h.toLowerCase().includes("图像")||h.toLowerCase().includes("照片")||h.toLowerCase().includes("视觉"))&&(w.value=!0,a.value="image"),(h.toLowerCase().includes("预测")||h.toLowerCase().includes("分析趋势")||h.toLowerCase().includes("预估"))&&(y.value=!0,a.value="prediction"),setTimeout(()=>{let te="";const G=h.toLowerCase();if(G.includes("保护膜")||G.includes("38501375")){w.value=!0,a.value="image";const E=m.value.find(J=>J.materialCode==="38501375");te={type:"text",content:`## 料号38501375保护膜分析结果

**检测日期**: ${E.testDate}
**检测项目**: ${E.testItem}
**批次**: ${E.badBatch}
**不良率**: ${E.defectRate}

**问题分析**:
保护膜出现严重耐磨性不足问题，酒精测试下100%批次出现掉漆现象。根据历史记录，该供应商"易湛"在过去3个月内有2次类似异常记录。

**建议措施**:
1. 立即暂停该批次物料使用
2. 对供应商发出质量预警
3. 要求供应商提供整改方案
4. 在图片分析面板中可查看材料缺陷详情`}}else if(G.includes("电池盖")||G.includes("37301062"))l.value=!0,a.value="chart",te={type:"text",content:`## 料号37301062电池盖分析结果

**异常描述**: 装卸100次后针变形（标准500次），不良率66.7%
**发生位置**: 南昌工厂IQC
**供应商**: 金盾

**趋势分析**:
该问题与上月同批次相似，显示供应商工艺存在稳定性问题。右侧图表面板展示了该物料近6个月的质量趋势，可见5月份开始异常率明显上升。

**根本原因分析**:
1. 模具磨损导致精度下降
2. 原材料批次变更未经充分验证
3. 供应商生产参数偏移

**建议对策**:
1. 要求供应商调整模具参数
2. 增加来料抽检比例至8%
3. 对库存批次进行100%复检`};else if(G.includes("分析")&&(G.includes("质量")||G.includes("趋势")))l.value=!0,a.value="chart",te={type:"text",content:`## IQE质量趋势分析

根据过去30天的检验数据分析：

### 主要发现
1. **来料质量问题**占异常总数的68%，较上月增加12%
2. **结构件类**材料不良率最高，达8.5%
3. **南昌工厂**返工率最高，达4.2%
4. **易湛**和**金盾**两家供应商贡献了56%的质量异常

### 风险预警
- C级风险物料：保护膜(38501375)，建议100%检验
- B级风险物料：电池盖(37301062)，建议提升抽检比例

您可以在右侧图表面板中查看详细的趋势变化。`};else if(G.includes("供应商")&&(G.includes("易湛")||G.includes("金盾"))){l.value=!0,a.value="chart";const E=G.includes("易湛")?"易湛":"金盾";te={type:"text",content:`## ${E}供应商质量分析报告

**供应商等级**: ${E==="易湛"?"C级(高风险)":"B级(中风险)"}
**近3个月合格率**: ${E==="易湛"?"86.4%":"91.2%"}
**主要问题类型**: ${E==="易湛"?"外观不良、耐磨性不足":"结构强度不足、尺寸偏差"}

**异常批次记录**:
${E==="易湛"?`- 2025/05/25: 保护膜(38501375)掉漆
- 2025/04/12: 标签(38402156)褪色
- 2025/03/22: 包装盒(38904532)异味`:`- 2025/05/26: 电池盖(37301062)变形
- 2025/04/28: 按键(37208631)卡顿
- 2025/03/05: 卡托(37108952)断裂`}

**改进建议**:
1. ${E==="易湛"?"要求提供油墨供应商变更说明":"建议调整模具参数和注塑温度"}
2. ${E==="易湛"?"增加UV老化测试项目":"增加疲劳测试循环次数"}
3. 安排质量工程师现场辅导

右侧图表展示了该供应商过去6个月的质量趋势。`}}else G.includes("生成")&&G.includes("检测方案")?te={type:"text",content:`## 智能检验方案

基于历史数据和当前质量状态，我为您生成了优化检验方案：

### 高风险物料检验方案
- **保护膜(38501375)**:
  - IQC抽检比例: 100%
  - 重点检测项: 酒精耐磨测试(500g×50次)，UV老化测试(48h)
  - 检验频率: 每批次
  - 特别要求: 供应商提供出厂检验报告，增加老化测试

### 中风险物料检验方案
- **电池盖(37301062)**:
  - IQC抽检比例: 8% (标准2%)
  - 重点检测项: 连续开合测试(标准提升至800次)
  - 检验频率: 每批次
  - 特别要求: 供应商提供原材料检验证明

### 一般物料检验方案
- 维持标准检验流程，抽检比例2%
- 重点关注新批次物料

**有效期**: 2025/06/01 - 2025/07/01`}:G.includes("图表")||G.includes("chart")?(l.value=!0,a.value="chart",te={type:"text",content:'我已为您准备了图表生成工具，您可以在右侧面板中创建和编辑图表来分析质量数据趋势。建议您关注"来料质量趋势"和"供应商不良率对比"两个关键指标。'}):G.includes("图片")||G.includes("图像分析")?(w.value=!0,a.value="image",te={type:"text",content:"我已为您打开图像分析工具，您可以上传物料图片进行缺陷检测。系统支持分析结构件表面缺陷、印刷品质量问题和组装偏差等多种缺陷类型。"}):G.includes("语音")||G.includes("朗读")?(r.value=!0,a.value="speech",te={type:"text",content:"语音控制面板已打开，您可以调整语音设置或使用语音输入。语音识别已针对IQE常用术语进行优化，支持识别物料代码、供应商名称和质量术语。"}):te={type:"text",content:`您好，我是IQE智能助手。我注意到您询问的是"${h}"，以下是我可以协助的内容：

1. **物料质量分析**：查询并分析特定物料代码的质量历史和当前状态
2. **供应商评估**：评估供应商质量表现并生成风险评级
3. **异常分析**：分析质量异常原因并提供处理建议
4. **检验方案**：生成基于风险的智能检验方案

您可以尝试询问特定材料(如"分析电池盖质量问题")、供应商(如"评估易湛供应商")或生成特定报告(如"生成检测方案")。`};I(te)},1e3)}function c(h){const _=h.toLowerCase();return _.includes("实验室")&&_.includes("数据")||_.includes("检测结果")||_.includes("lab view")||_.includes("测试结果")?{name:"实验室检测分析",path:"/lab-view"}:_.includes("监控")||_.includes("仪表板")||_.includes("dashboard")||_.includes("总览")?{name:"质量监控仪表板",path:"/monitoring-dashboard"}:null}function T(h){console.log("图表已更新",h)}function F(h){console.log("分析完成",h),v.value&&v.value.addMessage("system",`系统检测到${h.defects.length}个缺陷，整体质量评估: ${h.overallQuality==="pass"?"合格":"不合格"}`,"text")}function O(h){console.log("报告已生成",h),Z.success("分析报告已生成"),v.value&&v.value.addMessage("system",`质量分析报告已生成 (${new Date().toLocaleString()})`,"text")}function Y(h){w.value=!0,a.value="image",Z.success("图片已上传，可以在右侧面板进行分析")}function N(h){v.value&&(R.value=h,ve(()=>{v.value&&(v.value.addMessage("user",h,"text"),setTimeout(()=>{const _=v.value.messages.length;v.value.addMessage("assistant","","loading"),setTimeout(()=>{v.value.messages.splice(_,1),A(h,[],I=>{typeof I=="string"?v.value.addMessage("assistant",I,"text"):v.value.addMessage("assistant",I.content,I.type||"text",{...I.type==="chart"&&{chartData:I.chartData,chartTitle:I.title},...I.type==="image"&&{alt:I.alt,caption:I.caption}})})},1500)},100))}))}async function W(h){if(h.action==="analyzeMaterial"||h.action==="generateInspectionPlan"){fe();return}if(console.log(`执行操作: ${h.title}`,h),Z.success(`正在${h.title}，请稍候...`),h.action==="generateReport"?(a.value="chart",l.value=!0,ve(()=>{C.value&&C.value.generateRandomChart("bar")})):h.action==="analyzeTestResults"&&(a.value="chart",l.value=!0,ve(()=>{C.value&&C.value.generateRandomChart("line")})),h.params&&h.params.materialCode){const _=j.value.find(I=>I.code===h.params.materialCode);_&&(U.value=_,["analyzeMaterial","generateInspectionPlan","predictQualityTrend"].includes(h.action)&&(a.value="insights"))}}function fe(){L.value=!0}function ce(h){console.log("AI分析结果加载完成:",h)}function ue(h){console.log("AI分析操作触发:",h),h.type==="risk"?h.action.type==="applyStrategy"?Z.success("已应用风险分析推荐的检验策略"):h.action.type==="exportReport"&&Z.success("风险分析报告已导出"):h.type==="trend"||h.type==="anomaly"||h.type}function ye(h){console.error("AI分析错误:",h),Z.error("AI分析出现错误，请稍后重试")}$e(()=>{l.value=!0;const h=sessionStorage.getItem("iqe_shared_data");if(h){const _=JSON.parse(h);_.referringModule&&Z.info(`您从${_.referringModule}页面跳转而来，相关数据已加载`)}}),De(p,h=>{v.value&&v.value.addMessage("system",`场景已切换到"${me(h)}"，推荐操作已更新`,"text")});function me(h){switch(h){case"factory":return"库存场景";case"lab":return"实验室场景";case"online":return"产线场景";case"supplier":return"供应商质量助手";default:return"通用场景"}}function ie(h){const _=V(null);ve(()=>{if(!_.value)return;const I=h.toLowerCase();I.includes("不良率")||I.includes("趋势")?_.value.generateChart({type:"line",title:"物料不良率趋势分析",data:{labels:["1月","2月","3月","4月","5月"],datasets:[{label:"电池盖 (37301062)",data:[2.5,3.2,5.1,4.8,6.7],borderColor:"#409EFF"},{label:"保护膜 (38501375)",data:[1.8,2.5,3,5.2,8],borderColor:"#F56C6C"}]},options:{yAxisTitle:"不良率 (%)",threshold:5}}):I.includes("缺陷")||I.includes("类型")?_.value.generateChart({type:"pie",title:"缺陷类型分布",data:{labels:["外观","功能","尺寸","其他"],datasets:[{data:[45,25,20,10],backgroundColor:["#409EFF","#F56C6C","#E6A23C","#67C23A"]}]}}):I.includes("供应商")||I.includes("评估")?_.value.generateChart({type:"bar",title:"供应商质量评估",data:{labels:["金盾","易湛","其他供应商"],datasets:[{label:"质量得分",data:[78,65,85],backgroundColor:["#409EFF","#F56C6C","#67C23A"]}]},options:{yAxisTitle:"得分 (0-100)",threshold:70}}):_.value.generateChart({type:"line",title:"IQE质量综合趋势",data:{labels:["1月","2月","3月","4月","5月"],datasets:[{label:"不良率",data:[3.2,3.5,4.1,4.8,5.2],borderColor:"#F56C6C",yAxisID:"y"},{label:"返工率",data:[1.5,1.8,2,2.2,2.5],borderColor:"#E6A23C",yAxisID:"y"},{label:"客诉率",data:[.5,.4,.6,.8,.7],borderColor:"#67C23A",yAxisID:"y1"}]},options:{yAxisTitle:"百分比 (%)",y2AxisTitle:"每千台",threshold:5}})})}return(h,_)=>{const I=d("el-radio-button"),ee=d("el-radio-group"),te=d("el-tag"),G=d("el-button"),E=d("el-empty"),J=d("el-tab-pane"),de=d("el-icon"),he=d("el-card"),Me=d("el-tabs"),Ve=d("el-input"),Se=d("el-form-item"),xe=d("el-option"),Pe=d("el-select"),Ee=d("el-form"),we=d("el-table-column"),Qe=d("el-table"),Be=d("el-dialog");return b(),M("div",Ks,[_[25]||(_[25]=t("h2",{class:"page-title"},"IQE智能助手",-1)),t("div",Zs,[t("div",Xs,[t("div",Ys,[e(ee,{modelValue:p.value,"onUpdate:modelValue":_[0]||(_[0]=X=>p.value=X),size:"large"},{default:n(()=>[e(I,{label:"general"},{default:n(()=>_[10]||(_[10]=[k("通用助手")])),_:1,__:[10]}),e(I,{label:"factory"},{default:n(()=>_[11]||(_[11]=[k("库存场景")])),_:1,__:[11]}),e(I,{label:"lab"},{default:n(()=>_[12]||(_[12]=[k("实验室场景")])),_:1,__:[12]}),e(I,{label:"online"},{default:n(()=>_[13]||(_[13]=[k("产线场景")])),_:1,__:[13]}),e(I,{label:"supplier"},{default:n(()=>_[14]||(_[14]=[k("供应商质量助手")])),_:1,__:[14]})]),_:1},8,["modelValue"])]),t("div",Js,[(b(!0),M(ne,null,re(i[p.value],(X,Ce)=>(b(),ae(te,{key:Ce,onClick:je=>N(X),class:"quick-question-tag",type:Ce%4===0?"":Ce%4===1?"success":Ce%4===2?"warning":"danger",effect:"plain"},{default:n(()=>[k(D(X),1)]),_:2},1032,["onClick","type"]))),128))]),e(Ln,{ref_key:"chatRef",ref:v,class:"chat-window","welcome-message":f(p.value),"context-memory":!0,"max-context-messages":10,onSendMessage:A,onSpeechStart:le,onSpeechEnd:x,onImageUpload:Y},null,8,["welcome-message"])]),t("div",eo,[e(Me,{modelValue:a.value,"onUpdate:modelValue":_[4]||(_[4]=X=>a.value=X),class:"feature-tabs"},{default:n(()=>[e(J,{label:"AI分析",name:"insights"},{default:n(()=>[U.value?(b(),M("div",to,[t("div",no,[t("div",ao,[t("h3",null,D(U.value.name)+" ("+D(U.value.code)+")",1),t("div",so,[e(te,{size:"small"},{default:n(()=>[k(D(U.value.type),1)]),_:1}),e(te,{size:"small",type:"info"},{default:n(()=>[k("供应商: "+D(U.value.supplier),1)]),_:1}),e(te,{size:"small",type:q(U.value.riskLevel)},{default:n(()=>[k(" 风险等级: "+D(U.value.riskLevel),1)]),_:1},8,["type"])])]),e(G,{type:"primary",size:"small",onClick:fe},{default:n(()=>_[15]||(_[15]=[k(" 更换物料 ")])),_:1,__:[15]})]),e(Gs,{"material-code":U.value.code,"material-data":U.value,"auto-refresh":!1,onInsightLoaded:ce,onActionTriggered:ue,onError:ye},null,8,["material-code","material-data"])])):(b(),M("div",oo,[e(E,{description:"请选择物料进行AI分析"},{default:n(()=>[e(G,{type:"primary",onClick:fe},{default:n(()=>_[16]||(_[16]=[k("选择物料")])),_:1,__:[16]})]),_:1})]))]),_:1}),e(J,{label:"推荐操作",name:"actions"},{default:n(()=>[t("div",lo,[_[17]||(_[17]=t("h3",null,"基于当前对话的推荐操作",-1)),!R.value&&$.value.length===0?(b(),ae(E,{key:0,description:"对话后将显示推荐操作"})):(b(),M("div",io,[(b(!0),M(ne,null,re($.value,(X,Ce)=>(b(),ae(he,{key:Ce,class:"action-card",shadow:"hover",onClick:je=>W(X)},{header:n(()=>[t("div",ro,[e(de,{class:ke(X.icon)},{default:n(()=>[(b(),ae(Ke(X.icon)))]),_:2},1032,["class"]),t("span",null,D(X.title),1)])]),default:n(()=>[t("div",co,D(X.description),1)]),_:2},1032,["onClick"]))),128))]))])]),_:1}),e(J,{label:"图表生成",name:"chart"},{default:n(()=>[_e(e(an,{ref_key:"chartGeneratorRef",ref:C,height:"400px",onChartUpdated:T},null,512),[[be,l.value]]),_e(e(E,{description:"请在对话中提及'图表'、'趋势'等关键词来激活图表功能"},{default:n(()=>[e(G,{onClick:_[1]||(_[1]=X=>l.value=!0)},{default:n(()=>_[18]||(_[18]=[k("打开图表生成器")])),_:1,__:[18]})]),_:1},512),[[be,!l.value]])]),_:1}),e(J,{label:"图像分析",name:"image"},{default:n(()=>[_e(e(Vt,{ref_key:"imageAnalysisRef",ref:g,onAnalysisComplete:F,onReportGenerated:O},null,512),[[be,w.value]]),_e(e(E,{description:"请在对话中提及'图像分析'或上传图片来激活该功能"},{default:n(()=>[e(G,{onClick:_[2]||(_[2]=X=>w.value=!0)},{default:n(()=>_[19]||(_[19]=[k("打开图像分析工具")])),_:1,__:[19]})]),_:1},512),[[be,!w.value]])]),_:1}),e(J,{label:"语音设置",name:"speech"},{default:n(()=>[_e(e(yt,{ref_key:"speechControlRef",ref:S,onSpeechStart:u,onSpeechEnd:P},null,512),[[be,r.value]]),_e(e(E,{description:"请在对话中提及'语音'或点击聊天窗口中的语音按钮来激活该功能"},{default:n(()=>[e(G,{onClick:_[3]||(_[3]=X=>r.value=!0)},{default:n(()=>_[20]||(_[20]=[k("打开语音设置")])),_:1,__:[20]})]),_:1},512),[[be,!r.value]])]),_:1})]),_:1},8,["modelValue"])])]),e(Be,{modelValue:L.value,"onUpdate:modelValue":_[9]||(_[9]=X=>L.value=X),title:"选择物料进行AI分析",width:"60%"},{footer:n(()=>[t("span",uo,[e(G,{onClick:_[8]||(_[8]=X=>L.value=!1)},{default:n(()=>_[23]||(_[23]=[k("取消")])),_:1,__:[23]}),e(G,{type:"primary",onClick:se,disabled:!U.value},{default:n(()=>_[24]||(_[24]=[k(" 确认选择 ")])),_:1,__:[24]},8,["disabled"])])]),default:n(()=>[e(Ee,{inline:!0,class:"material-search-form"},{default:n(()=>[e(Se,{label:"物料编码"},{default:n(()=>[e(Ve,{modelValue:z.code,"onUpdate:modelValue":_[5]||(_[5]=X=>z.code=X),placeholder:"输入物料编码",clearable:""},null,8,["modelValue"])]),_:1}),e(Se,{label:"物料名称"},{default:n(()=>[e(Ve,{modelValue:z.name,"onUpdate:modelValue":_[6]||(_[6]=X=>z.name=X),placeholder:"输入物料名称",clearable:""},null,8,["modelValue"])]),_:1}),e(Se,{label:"供应商"},{default:n(()=>[e(Pe,{modelValue:z.supplier,"onUpdate:modelValue":_[7]||(_[7]=X=>z.supplier=X),placeholder:"选择供应商",clearable:""},{default:n(()=>[e(xe,{label:"全部",value:""}),e(xe,{label:"金盾",value:"金盾"}),e(xe,{label:"易湛",value:"易湛"}),e(xe,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),e(Se,null,{default:n(()=>[e(G,{type:"primary",onClick:Q},{default:n(()=>_[21]||(_[21]=[k("搜索")])),_:1,__:[21]}),e(G,{onClick:H},{default:n(()=>_[22]||(_[22]=[k("重置")])),_:1,__:[22]})]),_:1})]),_:1}),e(Qe,{data:B.value,style:{width:"100%"},onRowClick:oe,"highlight-current-row":""},{default:n(()=>[e(we,{prop:"code",label:"物料编码",width:"150"}),e(we,{prop:"name",label:"物料名称",width:"200"}),e(we,{prop:"type",label:"类型",width:"120"}),e(we,{prop:"supplier",label:"供应商",width:"120"}),e(we,{prop:"lastInspection",label:"最近检验日期",width:"180"}),e(we,{prop:"riskLevel",label:"风险等级"},{default:n(X=>[e(te,{type:q(X.row.riskLevel)},{default:n(()=>[k(D(X.row.riskLevel),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}},ho=pe(mo,[["__scopeId","data-v-b3d7d051"]]);export{ho as default};
