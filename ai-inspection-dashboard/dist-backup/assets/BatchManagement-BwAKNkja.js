import{_ as Se,m as P,l as Ye}from"./index-BA_4wflW.js";import{r as g,c as qe,t as ze,e as V,f as e,j as s,g as l,ak as Ue,o as v,k as M,af as $e,a5 as Y,a6 as q,u as K,a7 as R,l as u,x as m,aa as Q,ad as Te,a3 as A}from"./element-plus-CvrI1lB2.js";import"./echarts-Cq7vAPzK.js";const Pe={class:"batch-management-container"},Re={class:"card-header"},Ae={class:"header-actions"},Fe={class:"filter-area"},Le={class:"table-actions"},Ie={class:"pagination-container"},je={class:"dialog-footer"},Ee={key:0,class:"traceability-container"},Ne={key:0,class:"activity-details"},Oe={__name:"BatchManagement",setup(Ge){const I=Ye(),z=[{id:1,name:"富士康科技集团"},{id:2,name:"京东方科技集团"},{id:3,name:"欧菲光科技集团"},{id:4,name:"立讯精密工业"},{id:5,name:"蓝思科技股份"}],F=g(!1),B=g(!1),L=g(!1),f=g(null),j=g([]),x=g(1),U=g(10),E=g(0),n=g({category:"",supplier:"",status:"",dateRange:[],keyword:"",sortBy:"createdDesc"}),d=g({material_code:"",material_name:"",category_id:"",supplier_id:"",quantity:100,production_date:"",notes:""}),W={material_code:[{required:!0,message:"请输入物料编码",trigger:"blur"},{min:3,max:20,message:"长度在 3 到 20 个字符",trigger:"blur"}],material_name:[{required:!0,message:"请输入物料名称",trigger:"blur"}],category_id:[{required:!0,message:"请选择物料类别",trigger:"change"}],supplier_id:[{required:!0,message:"请选择供应商",trigger:"change"}],quantity:[{required:!0,message:"请输入数量",trigger:"blur"}],production_date:[{required:!0,message:"请选择生产日期",trigger:"change"}]},X=g([{content:"批次创建",timestamp:"2023-06-01 09:30",type:"primary",color:"#0bbd87",size:"large"},{content:"入库检验",timestamp:"2023-06-02 11:20",type:"success",details:"抽检合格率 98.5%，检验人员: 张工"},{content:"质量抽检",timestamp:"2023-06-03 14:00",type:"warning",details:"发现2个小问题，已要求供应商改进"},{content:"生产投料",timestamp:"2023-06-10 08:15",type:"info"},{content:"用于产品组装",timestamp:"2023-06-15 13:45",type:"success"}]),Z=g([{product_id:"P2023061501",product_name:"iPhone 14 Pro Max 后盖组件",production_date:"2023-06-15",status:"completed"},{product_id:"P2023061502",product_name:"iPhone 14 Pro 后盖组件",production_date:"2023-06-15",status:"completed"},{product_id:"P2023061601",product_name:"iPhone 14 后盖组件",production_date:"2023-06-16",status:"in_progress"}]);function ee(){const o=[];for(let t=1;t<=100;t++){const r=Math.floor(Math.random()*P.length),i=Math.floor(Math.random()*z.length),p=P[r],h=z[i],c=new Date;c.setDate(c.getDate()-Math.floor(Math.random()*90));const y=c.toISOString().split("T")[0],b=Math.random()*.03,S=["pending","processing","passed","rejected","used"],$=S[Math.floor(Math.random()*S.length)];let k="low";b>.02?k="high":b>.01&&(k="medium"),o.push({id:t,batch_id:`B${String(2023e3+t).padStart(7,"0")}`,material_code:`M${String(1e3+r).padStart(4,"0")}${String(t).padStart(3,"0")}`,material_name:`${p.name}${t%3===0?"组件":t%3===1?"配件":"元件"}`,category_id:p.id,category_name:p.name,supplier_id:h.id,supplier_name:h.name,quantity:Math.floor(Math.random()*1e3)+100,created_date:y,production_date:y,defect_rate:b,status:$,risk_level:k,notes:`批次${t}测试数据`})}return o}const te=qe(()=>{let o=[...j.value];if(n.value.category&&(o=o.filter(r=>r.category_id===n.value.category)),n.value.supplier&&(o=o.filter(r=>r.supplier_id===n.value.supplier)),n.value.status&&(o=o.filter(r=>r.status===n.value.status)),n.value.dateRange&&n.value.dateRange.length===2){const r=new Date(n.value.dateRange[0]),i=new Date(n.value.dateRange[1]);o=o.filter(p=>{const h=new Date(p.created_date);return h>=r&&h<=i})}if(n.value.keyword){const r=n.value.keyword.toLowerCase();o=o.filter(i=>i.batch_id.toLowerCase().includes(r)||i.material_code.toLowerCase().includes(r)||i.material_name.toLowerCase().includes(r))}switch(n.value.sortBy){case"createdDesc":o.sort((r,i)=>new Date(i.created_date)-new Date(r.created_date));break;case"createdAsc":o.sort((r,i)=>new Date(r.created_date)-new Date(i.created_date));break;case"defectDesc":o.sort((r,i)=>i.defect_rate-r.defect_rate);break;case"defectAsc":o.sort((r,i)=>r.defect_rate-i.defect_rate);break}E.value=o.length;const t=(x.value-1)*U.value;return o.slice(t,t+U.value)});function ae(o){U.value=o}function le(o){x.value=o}function oe(){x.value=1}function ne(){n.value={category:"",supplier:"",status:"",dateRange:[],keyword:"",sortBy:"createdDesc"},x.value=1}function re({column:o,prop:t,order:r}){if(r)switch(t){case"created_date":n.value.sortBy=r==="ascending"?"createdAsc":"createdDesc";break;case"defect_rate":n.value.sortBy=r==="ascending"?"defectAsc":"defectDesc";break}}function se(o){return o>.02?"#F56C6C":o>.01?"#E6A23C":"#67C23A"}function N(o){switch(o){case"pending":return"info";case"processing":return"warning";case"passed":return"success";case"rejected":return"danger";case"used":return"primary";default:return"info"}}function O(o){switch(o){case"pending":return"待检验";case"processing":return"检验中";case"passed":return"已通过";case"rejected":return"已拒绝";case"used":return"已使用";default:return"未知"}}function ue(o){switch(o){case"high":return"danger";case"medium":return"warning";case"low":return"success";default:return"info"}}function de(o){switch(o){case"high":return"高风险";case"medium":return"中等风险";case"low":return"低风险";default:return"未知"}}function ie(o){switch(o){case"completed":return"success";case"in_progress":return"warning";case"planned":return"info";default:return"info"}}function ce(o){switch(o){case"completed":return"已完成";case"in_progress":return"生产中";case"planned":return"已计划";default:return"未知"}}function pe(o){I.push(`/batch/${o.batch_id}`)}function _e(o){Te.confirm("此操作将修改批次信息，是否继续？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{A({type:"success",message:`批次 ${o.batch_id} 的信息已更新`})}).catch(()=>{})}function me(o){f.value=o,L.value=!0}function fe(o){A({message:`查看产品: ${o.product_name}`,type:"info"})}function ge(){A({message:"新批次添加成功",type:"success"}),B.value=!1,d.value={material_code:"",material_name:"",category_id:"",supplier_id:"",quantity:100,production_date:"",notes:""}}function ve(){A({message:"数据导出功能开发中",type:"info"})}function be(){I.go(-1)}return ze(()=>{F.value=!0,setTimeout(()=>{j.value=ee(),F.value=!1},500)}),(o,t)=>{const r=s("el-page-header"),i=s("el-icon-plus"),p=s("el-button"),h=s("el-icon-download"),c=s("el-option"),y=s("el-select"),b=s("el-col"),S=s("el-date-picker"),$=s("el-row"),k=s("el-input"),ye=s("el-icon-search"),_=s("el-table-column"),we=s("el-progress"),T=s("el-tag"),G=s("el-table"),ke=s("el-pagination"),Ve=s("el-card"),D=s("el-form-item"),he=s("el-input-number"),De=s("el-form"),H=s("el-dialog"),w=s("el-descriptions-item"),Ce=s("el-descriptions"),J=s("el-divider"),Me=s("el-timeline-item"),Be=s("el-timeline"),xe=Ue("loading");return v(),V("div",Pe,[e(r,{onBack:be,title:"返回",content:"批次管理"}),e(Ve,{class:"main-card"},{header:l(()=>[M("div",Re,[t[19]||(t[19]=M("h2",null,"物料批次管理",-1)),M("div",Ae,[e(p,{type:"primary",onClick:t[0]||(t[0]=a=>B.value=!0)},{default:l(()=>[e(i),t[17]||(t[17]=u(" 添加新批次 "))]),_:1,__:[17]}),e(p,{type:"success",onClick:ve},{default:l(()=>[e(h),t[18]||(t[18]=u(" 导出数据 "))]),_:1,__:[18]})])])]),default:l(()=>[M("div",Fe,[e($,{gutter:20},{default:l(()=>[e(b,{span:6},{default:l(()=>[e(y,{modelValue:n.value.category,"onUpdate:modelValue":t[1]||(t[1]=a=>n.value.category=a),placeholder:"物料类别",clearable:""},{default:l(()=>[(v(!0),V(Y,null,q(K(P),a=>(v(),R(c,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(b,{span:6},{default:l(()=>[e(y,{modelValue:n.value.supplier,"onUpdate:modelValue":t[2]||(t[2]=a=>n.value.supplier=a),placeholder:"供应商",clearable:""},{default:l(()=>[(v(),V(Y,null,q(z,a=>e(c,{key:a.id,label:a.name,value:a.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(b,{span:6},{default:l(()=>[e(y,{modelValue:n.value.status,"onUpdate:modelValue":t[3]||(t[3]=a=>n.value.status=a),placeholder:"批次状态",clearable:""},{default:l(()=>[e(c,{label:"待检验",value:"pending"}),e(c,{label:"检验中",value:"processing"}),e(c,{label:"已通过",value:"passed"}),e(c,{label:"已拒绝",value:"rejected"}),e(c,{label:"已使用",value:"used"})]),_:1},8,["modelValue"])]),_:1}),e(b,{span:6},{default:l(()=>[e(S,{modelValue:n.value.dateRange,"onUpdate:modelValue":t[4]||(t[4]=a=>n.value.dateRange=a),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1})]),_:1}),e($,{gutter:20,class:"filter-row"},{default:l(()=>[e(b,{span:8},{default:l(()=>[e(k,{modelValue:n.value.keyword,"onUpdate:modelValue":t[5]||(t[5]=a=>n.value.keyword=a),placeholder:"批次号/物料编码","prefix-icon":"el-icon-search"},null,8,["modelValue"])]),_:1}),e(b,{span:8},{default:l(()=>[e(y,{modelValue:n.value.sortBy,"onUpdate:modelValue":t[6]||(t[6]=a=>n.value.sortBy=a),placeholder:"排序方式"},{default:l(()=>[e(c,{label:"创建时间（新→旧）",value:"createdDesc"}),e(c,{label:"创建时间（旧→新）",value:"createdAsc"}),e(c,{label:"缺陷率（高→低）",value:"defectDesc"}),e(c,{label:"缺陷率（低→高）",value:"defectAsc"})]),_:1},8,["modelValue"])]),_:1}),e(b,{span:8,class:"filter-buttons"},{default:l(()=>[e(p,{type:"primary",onClick:oe},{default:l(()=>[e(ye),t[20]||(t[20]=u(" 搜索 "))]),_:1,__:[20]}),e(p,{onClick:ne},{default:l(()=>t[21]||(t[21]=[u(" 重置 ")])),_:1,__:[21]})]),_:1})]),_:1})]),$e((v(),R(G,{data:te.value,border:"",stripe:"",style:{width:"100%"},onSortChange:re},{default:l(()=>[e(_,{prop:"batch_id",label:"批次号",sortable:""}),e(_,{prop:"material_code",label:"物料编码"}),e(_,{prop:"material_name",label:"物料名称"}),e(_,{prop:"category_name",label:"物料类别"}),e(_,{prop:"supplier_name",label:"供应商"}),e(_,{prop:"quantity",label:"数量",sortable:""}),e(_,{prop:"created_date",label:"创建日期",sortable:""}),e(_,{label:"缺陷率",sortable:""},{default:l(a=>[e(we,{percentage:parseFloat((a.row.defect_rate*100).toFixed(2)),color:se(a.row.defect_rate),format:C=>C+"%"},null,8,["percentage","color","format"])]),_:1}),e(_,{label:"批次状态"},{default:l(a=>[e(T,{type:N(a.row.status)},{default:l(()=>[u(m(O(a.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(_,{label:"风险评级"},{default:l(a=>[e(T,{type:ue(a.row.risk_level),effect:"dark"},{default:l(()=>[u(m(de(a.row.risk_level)),1)]),_:2},1032,["type"])]),_:1}),e(_,{label:"操作",width:"220"},{default:l(a=>[M("div",Le,[e(p,{type:"primary",size:"small",onClick:C=>pe(a.row)},{default:l(()=>t[22]||(t[22]=[u(" 详情 ")])),_:2,__:[22]},1032,["onClick"]),e(p,{type:"warning",size:"small",onClick:C=>_e(a.row)},{default:l(()=>t[23]||(t[23]=[u(" 编辑 ")])),_:2,__:[23]},1032,["onClick"]),e(p,{type:"success",size:"small",onClick:C=>me(a.row)},{default:l(()=>t[24]||(t[24]=[u(" 追溯 ")])),_:2,__:[24]},1032,["onClick"])])]),_:1})]),_:1},8,["data"])),[[xe,F.value]]),M("div",Ie,[e(ke,{background:"",layout:"total, sizes, prev, pager, next, jumper",total:E.value,"page-size":U.value,"page-sizes":[10,20,50,100],"current-page":x.value,onSizeChange:ae,onCurrentChange:le},null,8,["total","page-size","current-page"])])]),_:1}),e(H,{modelValue:B.value,"onUpdate:modelValue":t[15]||(t[15]=a=>B.value=a),title:"添加新批次",width:"50%"},{footer:l(()=>[M("span",je,[e(p,{onClick:t[14]||(t[14]=a=>B.value=!1)},{default:l(()=>t[25]||(t[25]=[u("取消")])),_:1,__:[25]}),e(p,{type:"primary",onClick:ge},{default:l(()=>t[26]||(t[26]=[u("确认")])),_:1,__:[26]})])]),default:l(()=>[e(De,{ref_key:"batchForm",ref:d,model:d.value,rules:W,"label-width":"120px"},{default:l(()=>[e(D,{label:"物料编码",prop:"material_code"},{default:l(()=>[e(k,{modelValue:d.value.material_code,"onUpdate:modelValue":t[7]||(t[7]=a=>d.value.material_code=a)},null,8,["modelValue"])]),_:1}),e(D,{label:"物料名称",prop:"material_name"},{default:l(()=>[e(k,{modelValue:d.value.material_name,"onUpdate:modelValue":t[8]||(t[8]=a=>d.value.material_name=a)},null,8,["modelValue"])]),_:1}),e(D,{label:"物料类别",prop:"category_id"},{default:l(()=>[e(y,{modelValue:d.value.category_id,"onUpdate:modelValue":t[9]||(t[9]=a=>d.value.category_id=a),placeholder:"选择物料类别"},{default:l(()=>[(v(!0),V(Y,null,q(K(P),a=>(v(),R(c,{key:a.id,label:a.name,value:a.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(D,{label:"供应商",prop:"supplier_id"},{default:l(()=>[e(y,{modelValue:d.value.supplier_id,"onUpdate:modelValue":t[10]||(t[10]=a=>d.value.supplier_id=a),placeholder:"选择供应商"},{default:l(()=>[(v(),V(Y,null,q(z,a=>e(c,{key:a.id,label:a.name,value:a.id},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),e(D,{label:"数量",prop:"quantity"},{default:l(()=>[e(he,{modelValue:d.value.quantity,"onUpdate:modelValue":t[11]||(t[11]=a=>d.value.quantity=a),min:1,max:1e4},null,8,["modelValue"])]),_:1}),e(D,{label:"生产日期",prop:"production_date"},{default:l(()=>[e(S,{modelValue:d.value.production_date,"onUpdate:modelValue":t[12]||(t[12]=a=>d.value.production_date=a),type:"date",placeholder:"选择生产日期",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD"},null,8,["modelValue"])]),_:1}),e(D,{label:"批次备注",prop:"notes"},{default:l(()=>[e(k,{type:"textarea",modelValue:d.value.notes,"onUpdate:modelValue":t[13]||(t[13]=a=>d.value.notes=a),rows:"3",placeholder:"请输入批次的其他信息"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),e(H,{modelValue:L.value,"onUpdate:modelValue":t[16]||(t[16]=a=>L.value=a),title:"批次追溯",width:"70%"},{default:l(()=>[f.value?(v(),V("div",Ee,[e(Ce,{title:"批次基本信息",column:3,border:""},{default:l(()=>[e(w,{label:"批次号"},{default:l(()=>[u(m(f.value.batch_id),1)]),_:1}),e(w,{label:"物料编码"},{default:l(()=>[u(m(f.value.material_code),1)]),_:1}),e(w,{label:"物料名称"},{default:l(()=>[u(m(f.value.material_name),1)]),_:1}),e(w,{label:"物料类别"},{default:l(()=>[u(m(f.value.category_name),1)]),_:1}),e(w,{label:"供应商"},{default:l(()=>[u(m(f.value.supplier_name),1)]),_:1}),e(w,{label:"数量"},{default:l(()=>[u(m(f.value.quantity),1)]),_:1}),e(w,{label:"创建日期"},{default:l(()=>[u(m(f.value.created_date),1)]),_:1}),e(w,{label:"生产日期"},{default:l(()=>[u(m(f.value.production_date),1)]),_:1}),e(w,{label:"状态"},{default:l(()=>[e(T,{type:N(f.value.status)},{default:l(()=>[u(m(O(f.value.status)),1)]),_:1},8,["type"])]),_:1})]),_:1}),e(J,{"content-position":"center"},{default:l(()=>t[27]||(t[27]=[u("批次跟踪记录")])),_:1,__:[27]}),e(Be,null,{default:l(()=>[(v(!0),V(Y,null,q(X.value,(a,C)=>(v(),R(Me,{key:C,timestamp:a.timestamp,type:a.type,color:a.color,icon:a.icon,size:a.size},{default:l(()=>[u(m(a.content)+" ",1),a.details?(v(),V("div",Ne,m(a.details),1)):Q("",!0)]),_:2},1032,["timestamp","type","color","icon","size"]))),128))]),_:1}),e(J,{"content-position":"center"},{default:l(()=>t[28]||(t[28]=[u("关联产品信息")])),_:1,__:[28]}),e(G,{data:Z.value,border:"",style:{width:"100%"}},{default:l(()=>[e(_,{prop:"product_id",label:"产品ID"}),e(_,{prop:"product_name",label:"产品名称"}),e(_,{prop:"production_date",label:"生产日期"}),e(_,{prop:"status",label:"状态"},{default:l(a=>[e(T,{type:ie(a.row.status)},{default:l(()=>[u(m(ce(a.row.status)),1)]),_:2},1032,["type"])]),_:1}),e(_,{label:"操作",width:"150"},{default:l(a=>[e(p,{type:"primary",size:"small",onClick:C=>fe(a.row)},{default:l(()=>t[29]||(t[29]=[u(" 查看产品 ")])),_:2,__:[29]},1032,["onClick"])]),_:1})]),_:1},8,["data"])])):Q("",!0)]),_:1},8,["modelValue"])])}}},Qe=Se(Oe,[["__scopeId","data-v-445f78e1"]]);export{Qe as default};
