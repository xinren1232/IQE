import{_ as be,b as he,c as ye,d as we,e as xe,p as Ce,s as ke,h as Le,i as $e,q as Pe,k as Ae,a as Be,l as Me}from"./index-BA_4wflW.js";import{i as Ve}from"./install-_7eNnU3u.js";import{bd as Ee,cF as Z,Q as ze}from"./echarts-Cq7vAPzK.js";import{r as h,c as H,t as Te,v as Se,e as z,f as t,j as i,g as a,o as A,k as s,l as o,x as f,aa as J,a5 as De,a6 as Re,a7 as Fe,a3 as T}from"./element-plus-CvrI1lB2.js";const Ie={class:"realtime-monitoring-container"},Ue={class:"status-header"},Ne={class:"status-icon success"},Qe={class:"status-footer"},Oe={class:"trend-text success"},Ge={class:"status-header"},je={class:"status-icon warning"},qe={class:"status-footer"},We={class:"trend-text warning"},Ze={class:"status-header"},He={class:"status-icon danger"},Je={class:"status-footer"},Ke={class:"trend-text danger"},Xe={class:"status-header"},Ye={class:"status-icon info"},et={class:"status-footer"},tt={class:"trend-text success"},at={class:"chart-header"},st={class:"chart-controls"},lt={class:"chart-header"},nt={class:"chart-header"},ot={class:"chart-controls"},it={class:"chart-header"},rt={key:0,class:"alarm-detail"},dt={key:0,class:"alarm-suggestions"},ut={class:"dialog-footer"},ct={__name:"RealTimeMonitoring",setup(_t){Ee([he,ye,we,xe,Ce,ke,Le,$e,Pe,Ae,Ve,Be]);const K=Me(),p=h("pass_rate"),B=h("4h"),M=h("all"),S=h(null),D=h(null);let v=null,g=null,R=null;const y=h(!1),u=h(null),k=h([{line_id:"L001",name:"电子组件装配线1",product:"iPhone 14 Pro 后摄像头模组",batch_id:"B20230001",status:"normal",efficiency:92,alarms:[]},{line_id:"L002",name:"电子组件装配线2",product:"iPhone 14 Pro Max 后摄像头模组",batch_id:"B20230002",status:"normal",efficiency:95,alarms:[]},{line_id:"L003",name:"PCB生产线1",product:"iPhone 14 Pro 主板",batch_id:"B20230003",status:"warning",efficiency:78,alarms:[{id:"A001",timestamp:"2023-06-18 14:32:45",type:"效率下降",message:"PCB生产线1效率低于80%",status:"active",description:"设备L003-EQ12焊接效率下降，可能需要维护",suggestions:["检查设备L003-EQ12的焊接头是否需要清理","检查供料系统是否正常","如持续低效，安排设备维护"]}]},{line_id:"L004",name:"PCB生产线2",product:"iPhone 14 Pro Max 主板",batch_id:"B20230004",status:"normal",efficiency:91,alarms:[]},{line_id:"L005",name:"结构件加工线1",product:"iPhone 14 Pro 中框",batch_id:"B20230005",status:"warning",efficiency:85,alarms:[{id:"A002",timestamp:"2023-06-18 15:10:22",type:"质量波动",message:"结构件加工线1表面处理质量波动",status:"active",description:"表面处理工位检测到连续3件产品表面光洁度不达标",suggestions:["检查表面处理液配比是否正确","检查处理时间是否符合工艺要求","如持续异常，暂停生产并通知工艺部门"]}]},{line_id:"L006",name:"结构件加工线2",product:"iPhone 14 背壳",batch_id:"B20230006",status:"normal",efficiency:93,alarms:[]},{line_id:"L007",name:"显示模组生产线",product:"iPhone 14 Pro 显示屏",batch_id:"B20230007",status:"normal",efficiency:89,alarms:[]},{line_id:"L008",name:"摄像头模组线",product:"iPhone 14 前摄像头",batch_id:"B20230008",status:"normal",efficiency:94,alarms:[]},{line_id:"L009",name:"电池封装线",product:"iPhone 14 Pro 电池",batch_id:"B20230009",status:"normal",efficiency:96,alarms:[]},{line_id:"L010",name:"整机组装线1",product:"iPhone 14 Pro",batch_id:"B20230010",status:"normal",efficiency:88,alarms:[]},{line_id:"L011",name:"整机组装线2",product:"iPhone 14 Pro Max",batch_id:"B20230011",status:"error",efficiency:45,alarms:[{id:"A003",timestamp:"2023-06-18 13:05:17",type:"设备故障",message:"整机组装线2自动螺丝机故障",status:"active",description:"自动螺丝机L011-EQ05报错代码E-1234，已自动停机",suggestions:["立即联系设备维修部门","可以临时切换到备用设备","检查之前组装的产品是否受影响"]},{id:"A004",timestamp:"2023-06-18 13:07:32",type:"生产中断",message:"整机组装线2生产中断",status:"active",description:"由于设备故障，整条生产线已暂停",suggestions:["评估影响范围和修复时间","考虑调整生产计划","通知下游工序可能的延迟"]}]}]),X=H(()=>M.value==="all"?k.value:k.value.filter(l=>l.status===M.value)),N=H(()=>{const l=[];return k.value.forEach(e=>{e.alarms.forEach(c=>{c.status==="active"&&l.push({...c,line_id:e.line_id})})}),l});function Y(){const l=new Date,e=[];let c=1;switch(B.value){case"4h":c=4;break;case"24h":c=24;break}const x=c*12;for(let r=x;r>=0;r--){const _=new Date(l.getTime()-r*5*60*1e3);let d=0;switch(p.value){case"pass_rate":d=85+Math.random()*14,d+=Math.sin(r*.5)*2;break;case"defect_rate":d=.5+Math.random()*2.5,d+=Math.sin(r*.3)*.5;break;case"production_rate":d=80+Math.random()*40,d+=Math.sin(r*.2)*15;break}d=Math.max(0,d),p.value==="pass_rate"&&(d=Math.min(100,d)),e.push({time:_.toLocaleTimeString(),value:parseFloat(d.toFixed(2))})}return e}function L(){if(!S.value)return;v&&v.dispose(),v=Z(S.value);const l=Y();let e="",c=null;switch(p.value){case"pass_rate":e="检验合格率 (%)",c=100;break;case"defect_rate":e="缺陷检出率 (%)",c=5;break;case"production_rate":e="生产速率 (件/小时)",c=150;break}const x={title:{text:I(),left:"center"},tooltip:{trigger:"axis",formatter:function(r){const _=r[0];return`${_.axisValue}<br />${_.marker}${I()}: ${_.data.value}${U()}`}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},xAxis:{type:"category",boundaryGap:!1,data:l.map(r=>r.time)},yAxis:{type:"value",name:e,max:c,axisLabel:{formatter:function(r){return`${r}${U()}`}}},dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}],series:[{name:I(),type:"line",smooth:!0,symbol:"none",sampling:"average",itemStyle:{color:"#409EFF"},areaStyle:{color:new ze(0,0,0,1,[{offset:0,color:"rgba(64, 158, 255, 0.3)"},{offset:1,color:"rgba(64, 158, 255, 0.1)"}])},data:l.map(r=>({value:r.value})),markLine:{silent:!0,lineStyle:{color:"#E6A23C"},data:[{yAxis:Q(),label:{formatter:`目标值: ${Q()}${U()}`}}]}}]};v.setOption(x)}function F(){if(!D.value)return;g&&g.dispose(),g=Z(D.value);const l={normal:0,warning:0,error:0};k.value.forEach(c=>{l[c.status]++});const e={tooltip:{trigger:"item",formatter:"{b}: {c} ({d}%)"},legend:{orient:"vertical",left:10,top:"center",data:["正常","告警","异常"]},series:[{name:"产线状态",type:"pie",radius:["50%","70%"],avoidLabelOverlap:!1,label:{show:!1,position:"center"},emphasis:{label:{show:!0,fontSize:"18",fontWeight:"bold"}},labelLine:{show:!1},data:[{value:l.normal,name:"正常",itemStyle:{color:"#67C23A"}},{value:l.warning,name:"告警",itemStyle:{color:"#E6A23C"}},{value:l.error,name:"异常",itemStyle:{color:"#F56C6C"}}]}]};g.setOption(e)}function I(){switch(p.value){case"pass_rate":return"检验合格率";case"defect_rate":return"缺陷检出率";case"production_rate":return"生产速率";default:return""}}function U(){switch(p.value){case"pass_rate":return"%";case"defect_rate":return"%";case"production_rate":return"件/小时";default:return""}}function Q(){switch(p.value){case"pass_rate":return 95;case"defect_rate":return 1.5;case"production_rate":return 100;default:return 0}}function ee(l){switch(l){case"normal":return"success";case"warning":return"warning";case"error":return"danger";default:return"info"}}function te(l){switch(l){case"normal":return"正常";case"warning":return"告警";case"error":return"异常";default:return"未知"}}function O(l){switch(l){case"设备故障":return"danger";case"生产中断":return"danger";case"质量波动":return"warning";case"效率下降":return"warning";default:return"info"}}function ae(l){return l>=90?"#67C23A":l>=80?"#E6A23C":"#F56C6C"}function se(l){T({message:`查看产线 ${l.name} 的详细信息`,type:"info"})}function le(l){if(l.alarms.length===0){T({message:`产线 ${l.name} 没有活动告警`,type:"info"});return}u.value={...l.alarms[0],line_id:l.line_id},y.value=!0}function ne(l){u.value=l,y.value=!0}function G(l){l&&(T({message:`告警 ${l.id} 已处理`,type:"success"}),k.value.forEach(e=>{if(e.line_id===l.line_id){const c=e.alarms.findIndex(r=>r.id===l.id);c!==-1&&(e.alarms[c].status="resolved"),e.alarms.some(r=>r.status==="active")||(e.status="normal",e.efficiency=90+Math.floor(Math.random()*8))}}),y.value&&(y.value=!1),F())}function oe(){T({message:"数据已刷新",type:"success"}),L(),F()}function ie(){K.go(-1)}function j(){v&&v.resize(),g&&g.resize()}return watch(p,()=>{L()}),watch(B,()=>{L()}),Te(()=>{L(),F(),R=setInterval(()=>{L()},3e4),window.addEventListener("resize",j)}),Se(()=>{R&&clearInterval(R),window.removeEventListener("resize",j),v&&v.dispose(),g&&g.dispose()}),(l,e)=>{const c=i("el-page-header"),x=i("el-icon-circle-check"),r=i("el-icon-caret-top"),_=i("el-card"),d=i("el-col"),re=i("el-icon-warning"),de=i("el-icon-close-bold"),ue=i("el-icon-timer"),V=i("el-row"),C=i("el-option"),q=i("el-select"),ce=i("el-icon-refresh"),b=i("el-button"),E=i("el-radio-button"),_e=i("el-radio-group"),m=i("el-table-column"),$=i("el-tag"),me=i("el-progress"),W=i("el-table"),fe=i("el-badge"),w=i("el-descriptions-item"),pe=i("el-descriptions"),ve=i("el-alert"),ge=i("el-dialog");return A(),z("div",Ie,[t(c,{onBack:ie,title:"返回",content:"实时监控"}),t(V,{gutter:20,class:"status-cards"},{default:a(()=>[t(d,{xs:24,sm:12,md:8,lg:6},{default:a(()=>[t(_,{class:"status-card","body-style":{padding:"20px"}},{default:a(()=>[s("div",Ue,[s("div",Ne,[t(x)]),e[6]||(e[6]=s("div",{class:"status-info"},[s("div",{class:"status-title"},"正常运行产线"),s("div",{class:"status-value"},"8")],-1))]),s("div",Qe,[s("span",Oe,[t(r),e[7]||(e[7]=o(" 较昨日增加2条 "))])])]),_:1})]),_:1}),t(d,{xs:24,sm:12,md:8,lg:6},{default:a(()=>[t(_,{class:"status-card","body-style":{padding:"20px"}},{default:a(()=>[s("div",Ge,[s("div",je,[t(re)]),e[8]||(e[8]=s("div",{class:"status-info"},[s("div",{class:"status-title"},"告警产线"),s("div",{class:"status-value"},"2")],-1))]),s("div",qe,[s("span",We,[t(r),e[9]||(e[9]=o(" 较昨日增加1条 "))])])]),_:1})]),_:1}),t(d,{xs:24,sm:12,md:8,lg:6},{default:a(()=>[t(_,{class:"status-card","body-style":{padding:"20px"}},{default:a(()=>[s("div",Ze,[s("div",He,[t(de)]),e[10]||(e[10]=s("div",{class:"status-info"},[s("div",{class:"status-title"},"异常产线"),s("div",{class:"status-value"},"1")],-1))]),s("div",Je,[s("span",Ke,[t(r),e[11]||(e[11]=o(" 较昨日增加1条 "))])])]),_:1})]),_:1}),t(d,{xs:24,sm:12,md:8,lg:6},{default:a(()=>[t(_,{class:"status-card","body-style":{padding:"20px"}},{default:a(()=>[s("div",Xe,[s("div",Ye,[t(ue)]),e[12]||(e[12]=s("div",{class:"status-info"},[s("div",{class:"status-title"},"今日检验批次"),s("div",{class:"status-value"},"24")],-1))]),s("div",et,[s("span",tt,[t(r),e[13]||(e[13]=o(" 较昨日增加6批 "))])])]),_:1})]),_:1})]),_:1}),t(V,{gutter:20,class:"chart-row"},{default:a(()=>[t(d,{xs:24,lg:16},{default:a(()=>[t(_,{class:"chart-card"},{header:a(()=>[s("div",at,[e[14]||(e[14]=s("h3",null,"实时检验数据",-1)),s("div",st,[t(q,{modelValue:p.value,"onUpdate:modelValue":e[0]||(e[0]=n=>p.value=n),size:"small",style:{width:"150px"}},{default:a(()=>[t(C,{label:"检验合格率",value:"pass_rate"}),t(C,{label:"缺陷检出率",value:"defect_rate"}),t(C,{label:"生产速率",value:"production_rate"})]),_:1},8,["modelValue"]),t(q,{modelValue:B.value,"onUpdate:modelValue":e[1]||(e[1]=n=>B.value=n),size:"small",style:{width:"120px","margin-left":"10px"}},{default:a(()=>[t(C,{label:"最近1小时",value:"1h"}),t(C,{label:"最近4小时",value:"4h"}),t(C,{label:"最近24小时",value:"24h"})]),_:1},8,["modelValue"])])])]),default:a(()=>[s("div",{class:"realtime-chart",ref_key:"realtimeChartRef",ref:S},null,512)]),_:1})]),_:1}),t(d,{xs:24,lg:8},{default:a(()=>[t(_,{class:"chart-card"},{header:a(()=>[s("div",lt,[e[16]||(e[16]=s("h3",null,"当前各产线状态",-1)),t(b,{type:"primary",size:"small",onClick:oe},{default:a(()=>[t(ce),e[15]||(e[15]=o(" 刷新 "))]),_:1,__:[15]})])]),default:a(()=>[s("div",{class:"status-chart",ref_key:"statusChartRef",ref:D},null,512)]),_:1})]),_:1})]),_:1}),t(V,{gutter:20},{default:a(()=>[t(d,{span:24},{default:a(()=>[t(_,null,{header:a(()=>[s("div",nt,[e[21]||(e[21]=s("h3",null,"生产线实时监控",-1)),s("div",ot,[t(_e,{modelValue:M.value,"onUpdate:modelValue":e[2]||(e[2]=n=>M.value=n),size:"small"},{default:a(()=>[t(E,{label:"all"},{default:a(()=>e[17]||(e[17]=[o("全部")])),_:1,__:[17]}),t(E,{label:"normal"},{default:a(()=>e[18]||(e[18]=[o("正常")])),_:1,__:[18]}),t(E,{label:"warning"},{default:a(()=>e[19]||(e[19]=[o("告警")])),_:1,__:[19]}),t(E,{label:"error"},{default:a(()=>e[20]||(e[20]=[o("异常")])),_:1,__:[20]})]),_:1},8,["modelValue"])])])]),default:a(()=>[t(W,{data:X.value,border:"",stripe:"",style:{width:"100%"}},{default:a(()=>[t(m,{prop:"line_id",label:"产线ID",width:"120"}),t(m,{prop:"name",label:"产线名称"}),t(m,{prop:"product",label:"当前生产产品"}),t(m,{prop:"batch_id",label:"当前批次",width:"150"}),t(m,{label:"状态",width:"120"},{default:a(n=>[t($,{type:ee(n.row.status),effect:"dark"},{default:a(()=>[o(f(te(n.row.status)),1)]),_:2},1032,["type"])]),_:1}),t(m,{prop:"efficiency",label:"效率",width:"180"},{default:a(n=>[t(me,{percentage:n.row.efficiency,color:ae(n.row.efficiency)},null,8,["percentage","color"])]),_:1}),t(m,{label:"操作",width:"200"},{default:a(n=>[t(b,{type:"primary",size:"small",onClick:P=>se(n.row)},{default:a(()=>e[22]||(e[22]=[o(" 详情 ")])),_:2,__:[22]},1032,["onClick"]),t(b,{type:"warning",size:"small",onClick:P=>le(n.row),disabled:n.row.status==="normal"},{default:a(()=>e[23]||(e[23]=[o(" 告警 ")])),_:2,__:[23]},1032,["onClick","disabled"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1}),t(V,{gutter:20,class:"alarm-panel-row"},{default:a(()=>[t(d,{span:24},{default:a(()=>[t(_,null,{header:a(()=>[s("div",it,[e[25]||(e[25]=s("h3",null,"实时告警",-1)),t(fe,{value:N.value.length,max:99,class:"alarm-badge"},{default:a(()=>[t(b,{type:"danger",plain:"",size:"small"},{default:a(()=>e[24]||(e[24]=[o(" 处理告警 ")])),_:1,__:[24]})]),_:1},8,["value"])])]),default:a(()=>[t(W,{data:N.value,border:"",style:{width:"100%"}},{default:a(()=>[t(m,{prop:"timestamp",label:"时间",width:"180"}),t(m,{prop:"line_id",label:"产线",width:"120"}),t(m,{prop:"type",label:"告警类型",width:"150"},{default:a(n=>[t($,{type:O(n.row.type),effect:"dark"},{default:a(()=>[o(f(n.row.type),1)]),_:2},1032,["type"])]),_:1}),t(m,{prop:"message",label:"告警信息"}),t(m,{label:"状态",width:"120"},{default:a(n=>[t($,{type:n.row.status==="active"?"danger":"success"},{default:a(()=>[o(f(n.row.status==="active"?"活动":"已处理"),1)]),_:2},1032,["type"])]),_:1}),t(m,{label:"操作",width:"180"},{default:a(n=>[t(b,{type:"primary",size:"small",onClick:P=>G(n.row),disabled:n.row.status!=="active"},{default:a(()=>e[26]||(e[26]=[o(" 处理 ")])),_:2,__:[26]},1032,["onClick","disabled"]),t(b,{type:"info",size:"small",onClick:P=>ne(n.row)},{default:a(()=>e[27]||(e[27]=[o(" 详情 ")])),_:2,__:[27]},1032,["onClick"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1}),t(ge,{modelValue:y.value,"onUpdate:modelValue":e[5]||(e[5]=n=>y.value=n),title:"告警详情",width:"50%"},{footer:a(()=>[s("span",ut,[t(b,{onClick:e[3]||(e[3]=n=>y.value=!1)},{default:a(()=>e[29]||(e[29]=[o("关闭")])),_:1,__:[29]}),t(b,{type:"primary",onClick:e[4]||(e[4]=n=>G(u.value)),disabled:!u.value||u.value.status!=="active"},{default:a(()=>e[30]||(e[30]=[o(" 处理告警 ")])),_:1,__:[30]},8,["disabled"])])]),default:a(()=>[u.value?(A(),z("div",rt,[t(pe,{title:"告警基本信息",column:2,border:""},{default:a(()=>[t(w,{label:"告警ID"},{default:a(()=>[o(f(u.value.id),1)]),_:1}),t(w,{label:"产线"},{default:a(()=>[o(f(u.value.line_id),1)]),_:1}),t(w,{label:"时间"},{default:a(()=>[o(f(u.value.timestamp),1)]),_:1}),t(w,{label:"类型"},{default:a(()=>[t($,{type:O(u.value.type)},{default:a(()=>[o(f(u.value.type),1)]),_:1},8,["type"])]),_:1}),t(w,{label:"状态",span:2},{default:a(()=>[t($,{type:u.value.status==="active"?"danger":"success"},{default:a(()=>[o(f(u.value.status==="active"?"活动":"已处理"),1)]),_:1},8,["type"])]),_:1}),t(w,{label:"告警信息",span:2},{default:a(()=>[o(f(u.value.message),1)]),_:1}),t(w,{label:"详细描述",span:2},{default:a(()=>[o(f(u.value.description||"无详细描述"),1)]),_:1})]),_:1}),u.value.suggestions&&u.value.suggestions.length?(A(),z("div",dt,[e[28]||(e[28]=s("h4",null,"处理建议",-1)),(A(!0),z(De,null,Re(u.value.suggestions,(n,P)=>(A(),Fe(ve,{key:P,title:n,type:"info",closable:!1,"show-icon":"",style:{"margin-bottom":"10px"}},null,8,["title"]))),128))])):J("",!0)])):J("",!0)]),_:1},8,["modelValue"])])}}},gt=be(ct,[["__scopeId","data-v-33ab47be"]]);export{gt as default};
