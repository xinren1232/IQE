var nt=Object.defineProperty;var at=(u,e,n)=>e in u?nt(u,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):u[e]=n;var fe=(u,e,n)=>at(u,typeof e!="symbol"?e+"":e,n);import{b as he,r as U,t as Re,ae as st,a3 as W,j as g,e as T,o as S,k as d,aa as ee,f as a,g as r,l as b,x as L,c as Pe,a9 as qe,ac as ot,a5 as oe,a6 as ce,n as be,ab as it,v as We,w as xe,af as Ce,a8 as Qe,a7 as le,ag as Me,ah as lt,u as rt,M as ct,ai as dt}from"./element-plus-GKyTe0pu.js";import{_ as ve,i as ut,d as mt,c as pt,e as ft,p as ht,h as gt,a as yt,l as vt}from"./index-PiER-Nao.js";import{i as _t,a as wt}from"./index-BcmJDH2O.js";import{cF as Oe,bd as bt}from"./echarts-Cq7vAPzK.js";import"./install-__7xUayv.js";import"./installMarkPoint-CbaZpOSi.js";const kt={class:"speech-control"},$t={class:"speech-settings"},Dt={class:"speech-actions"},Ct={key:0,class:"speech-status"},Mt={key:0,class:"recording-indicator"},St={key:1,class:"transcript-container"},It={class:"transcript"},At={class:"transcript-actions"},xt={__name:"SpeechControl",emits:["speech-start","speech-end"],setup(u,{emit:e}){const n=e,t=he({recognition:!0,synthesis:!0,language:"zh-CN",rate:1,volume:.8,pitch:1}),o=U(!1),s=U("");let l=null;Re(()=>{c()}),st(()=>{l&&l.stop()});function c(){if(!("webkitSpeechRecognition"in window)&&!("SpeechRecognition"in window)){W.warning("您的浏览器不支持语音识别功能"),t.recognition=!1;return}const w=window.SpeechRecognition||window.webkitSpeechRecognition;l=new w,l.continuous=!0,l.interimResults=!0,l.lang=t.language,l.onresult=p=>{let D="",I="";for(let z=p.resultIndex;z<p.results.length;z++){const P=p.results[z];P.isFinal?I+=P[0].transcript:D+=P[0].transcript}I?s.value=I:D&&(s.value=D)},l.onend=()=>{o.value=!1,s.value&&n("speech-end",s.value)},l.onerror=p=>{console.error("语音识别错误:",p.error),o.value=!1,W.error(`语音识别错误: ${p.error}`)}}function i(){if(!(!l&&(c(),!l)))try{l.lang=t.language,l.start(),o.value=!0,s.value="",n("speech-start")}catch(w){console.error("开始录音失败:",w),W.error("开始录音失败")}}function m(){l&&o.value&&l.stop()}function v(){if(!t.synthesis){W.warning("语音合成功能未启用");return}if(!("speechSynthesis"in window)){W.warning("您的浏览器不支持语音合成功能"),t.synthesis=!1;return}const w=new SpeechSynthesisUtterance("IQE智能质检助手已准备就绪，有什么可以帮您？");w.lang=t.language,w.rate=t.rate,w.volume=t.volume,w.pitch=t.pitch,window.speechSynthesis.speak(w)}function y(){s.value&&(n("speech-end",s.value),s.value="")}function f(){s.value=""}return(w,p)=>{const D=g("el-switch"),I=g("el-form-item"),z=g("el-option"),P=g("el-select"),E=g("el-slider"),H=g("el-form"),j=g("el-icon-microphone"),O=g("el-icon"),Q=g("el-button"),x=g("el-icon-video-play"),V=g("el-icon-video-pause"),X=g("el-icon-position"),se=g("el-icon-delete");return S(),T("div",kt,[d("div",$t,[p[11]||(p[11]=d("h3",null,"语音设置",-1)),a(H,{model:t,"label-position":"top",size:"default"},{default:r(()=>[a(I,{label:"语音识别"},{default:r(()=>[a(D,{modelValue:t.recognition,"onUpdate:modelValue":p[0]||(p[0]=C=>t.recognition=C)},null,8,["modelValue"]),p[6]||(p[6]=d("span",{class:"setting-description"},"启用语音识别功能",-1))]),_:1,__:[6]}),a(I,{label:"语音合成"},{default:r(()=>[a(D,{modelValue:t.synthesis,"onUpdate:modelValue":p[1]||(p[1]=C=>t.synthesis=C)},null,8,["modelValue"]),p[7]||(p[7]=d("span",{class:"setting-description"},"启用语音合成功能（AI回复会以语音播放）",-1))]),_:1,__:[7]}),a(I,{label:"语音语言"},{default:r(()=>[a(P,{modelValue:t.language,"onUpdate:modelValue":p[2]||(p[2]=C=>t.language=C),style:{width:"100%"}},{default:r(()=>[a(z,{label:"中文 (普通话)",value:"zh-CN"}),a(z,{label:"英语 (美国)",value:"en-US"}),a(z,{label:"日语",value:"ja-JP"})]),_:1},8,["modelValue"])]),_:1}),a(I,{label:"语音速度"},{default:r(()=>[a(E,{modelValue:t.rate,"onUpdate:modelValue":p[3]||(p[3]=C=>t.rate=C),min:.5,max:2,step:.1,"format-tooltip":C=>`${C}x`},null,8,["modelValue","format-tooltip"])]),_:1}),a(I,{label:"语音音量"},{default:r(()=>[a(E,{modelValue:t.volume,"onUpdate:modelValue":p[4]||(p[4]=C=>t.volume=C),min:0,max:1,step:.1,"format-tooltip":C=>`${Math.round(C*100)}%`},null,8,["modelValue","format-tooltip"])]),_:1}),a(I,{label:"语音音调"},{default:r(()=>[a(E,{modelValue:t.pitch,"onUpdate:modelValue":p[5]||(p[5]=C=>t.pitch=C),min:.5,max:2,step:.1},null,8,["modelValue"])]),_:1})]),_:1},8,["model"]),d("div",Dt,[a(Q,{type:"primary",onClick:v,disabled:!t.synthesis},{default:r(()=>[a(O,null,{default:r(()=>[a(j)]),_:1}),p[8]||(p[8]=b(" 测试语音 "))]),_:1,__:[8]},8,["disabled"]),a(Q,{onClick:i,disabled:o.value||!t.recognition},{default:r(()=>[a(O,null,{default:r(()=>[a(x)]),_:1}),p[9]||(p[9]=b(" 开始录音 "))]),_:1,__:[9]},8,["disabled"]),a(Q,{onClick:m,disabled:!o.value},{default:r(()=>[a(O,null,{default:r(()=>[a(V)]),_:1}),p[10]||(p[10]=b(" 停止录音 "))]),_:1,__:[10]},8,["disabled"])])]),o.value||s.value?(S(),T("div",Ct,[o.value?(S(),T("div",Mt,p[12]||(p[12]=[d("div",{class:"recording-animation"},null,-1),d("span",null,"正在录音...",-1)]))):ee("",!0),s.value?(S(),T("div",St,[p[15]||(p[15]=d("h4",null,"识别结果:",-1)),d("div",It,L(s.value),1),d("div",At,[a(Q,{size:"small",onClick:y,disabled:!s.value},{default:r(()=>[a(O,null,{default:r(()=>[a(X)]),_:1}),p[13]||(p[13]=b(" 发送 "))]),_:1,__:[13]},8,["disabled"]),a(Q,{size:"small",onClick:f,disabled:!s.value},{default:r(()=>[a(O,null,{default:r(()=>[a(se)]),_:1}),p[14]||(p[14]=b(" 清除 "))]),_:1,__:[14]},8,["disabled"])])])):ee("",!0)])):ee("",!0),p[16]||(p[16]=d("div",{class:"speech-tips"},[d("h4",null,"语音助手使用技巧"),d("ul",null,[d("li",null,"在聊天窗口点击麦克风图标可以直接开始语音输入"),d("li",null,'说"查看图表"或"生成图表"可以快速生成数据可视化'),d("li",null,'说"分析物料 [物料编码]"可以快速获取物料质量分析'),d("li",null,'说"预测趋势"可以获取AI质量趋势预测')])],-1))])}}},Rt=ve(xt,[["__scopeId","data-v-6afd8097"]]),zt={class:"image-analysis"},Lt={key:1,class:"image-preview-container"},Tt={class:"image-toolbar"},Et={class:"image-controls"},Vt={class:"image-container"},Ut=["src"],Nt={key:1,class:"analyzing-indicator"},Ft={key:0,class:"analysis-results"},Pt={class:"defects-list"},qt={class:"defect-location"},Qt={class:"defect-probability"},Bt={class:"analysis-summary"},Ot={class:"summary-item"},jt={class:"summary-value"},Ht={class:"summary-item"},Wt={class:"analysis-actions"},Gt={__name:"ImageAnalysis",emits:["analysis-complete","report-generated"],setup(u,{expose:e,emit:n}){const t=n,o=U(null),s=U(null),l=U(null),c=U(""),i=U(""),m=U(100),v=U(100),y=U(100),f=U(!1),w=U(0),p=he({defects:[],overallQuality:"",confidenceScore:0}),D=Pe(()=>p.defects.length>0);function I(){o.value.click()}function z(M){const h=M.target.files;if(h&&h.length>0){const A=h[0];E(A)}}function P(M){M.preventDefault();const h=M.dataTransfer.files;if(h&&h.length>0){const A=h[0];A.type.startsWith("image/")?E(A):W.error("请上传图片文件")}}function E(M){if(!M.type.startsWith("image/")){W.error("请上传图片文件");return}const h=new FileReader;h.onload=A=>{c.value=A.target.result,i.value=A.target.result,m.value=100,v.value=100,y.value=100,p.defects=[],p.overallQuality="",p.confidenceScore=0},h.readAsDataURL(M)}function H(){console.log("图像已加载")}function j(){s.value&&(s.value.style.filter=`brightness(${m.value}%) contrast(${v.value}%)`)}function O(){s.value&&(s.value.style.transform=`scale(${y.value/100})`)}function Q(){c.value="",i.value="",p.defects=[],p.overallQuality="",p.confidenceScore=0,o.value.value=""}function x(){c.value=i.value,m.value=100,v.value=100,y.value=100}function V(){f.value=!0,w.value=0;const M=setInterval(()=>{w.value+=10,w.value>=100&&(clearInterval(M),m.value=110,v.value=120,j(),f.value=!1,W.success("图像增强完成"))},100)}function X(){if(!c.value){W.warning("请先上传图片");return}f.value=!0,w.value=0;const M=setInterval(()=>{w.value+=Math.floor(Math.random()*10)+1,w.value>=100&&(w.value=100,clearInterval(M),setTimeout(()=>{se(),C(),f.value=!1,t("analysis-complete",p)},500))},200)}function se(){p.defects=[];const M=Math.floor(Math.random()*3)+1,h=["划痕","凹陷","裂纹","变色","气泡","污点","错位"],A=["low","medium","high"];for(let q=0;q<M;q++){const K=s.value.naturalWidth,Y=s.value.naturalHeight,ae={type:h[Math.floor(Math.random()*h.length)],severity:A[Math.floor(Math.random()*A.length)],location:[Math.floor(Math.random()*K),Math.floor(Math.random()*Y)],size:Math.floor(Math.random()*30)+10,probability:Math.random()*.3+.7};p.defects.push(ae)}const F=p.defects.some(q=>q.severity==="high");p.overallQuality=F?"fail":"pass",p.confidenceScore=Math.random()*.2+.8}function C(){!l.value||p.defects.length===0||be(()=>{const M=s.value,h=l.value;h.width=M.naturalWidth,h.height=M.naturalHeight;const A=h.getContext("2d");A.clearRect(0,0,h.width,h.height),p.defects.forEach(F=>{const[q,K]=F.location,Y=F.size;let ae;switch(F.severity){case"high":ae="rgba(255, 0, 0, 0.7)";break;case"medium":ae="rgba(255, 165, 0, 0.7)";break;default:ae="rgba(255, 255, 0, 0.7)"}A.beginPath(),A.arc(q,K,Y/2,0,2*Math.PI),A.fillStyle=ae,A.fill(),A.lineWidth=2,A.strokeStyle="rgba(255, 255, 255, 0.8)",A.stroke(),A.font="14px Arial",A.fillStyle="white",A.textAlign="center",A.textBaseline="middle",A.fillText(F.type,q,K)})})}function _(M){switch(M){case"high":return"danger";case"medium":return"warning";default:return"info"}}function N(){if(!D.value){W.warning("请先分析图像");return}W.success("分析报告已生成"),t("report-generated",{timestamp:new Date().toISOString(),imageData:c.value,results:p})}return e({analyzeImage:X,enhanceImage:V}),(M,h)=>{const A=g("el-icon-upload"),F=g("el-icon"),q=g("el-icon-search"),K=g("el-button"),Y=g("el-icon-magic-stick"),ae=g("el-icon-refresh-right"),we=g("el-button-group"),re=g("el-slider"),pe=g("el-icon-delete"),ke=g("el-progress"),ge=g("el-tag");return S(),T("div",zt,[c.value?ee("",!0):(S(),T("div",{key:0,class:"upload-area",onClick:I,onDrop:P,onDragover:h[0]||(h[0]=qe(()=>{},["prevent"])),onDragenter:h[1]||(h[1]=qe(()=>{},["prevent"]))},[d("input",{ref_key:"fileInput",ref:o,type:"file",accept:"image/*",onChange:z,style:{display:"none"}},null,544),a(F,{class:"upload-icon"},{default:r(()=>[a(A)]),_:1}),h[5]||(h[5]=d("div",{class:"upload-text"},[d("span",null,"点击或拖拽上传图片"),d("p",null,"支持JPG、PNG格式")],-1))],32)),c.value?(S(),T("div",Lt,[d("div",Tt,[a(we,null,{default:r(()=>[a(K,{type:"primary",size:"small",onClick:X,loading:f.value},{default:r(()=>[a(F,null,{default:r(()=>[a(q)]),_:1}),h[6]||(h[6]=b(" 分析缺陷 "))]),_:1,__:[6]},8,["loading"]),a(K,{size:"small",onClick:V,disabled:f.value},{default:r(()=>[a(F,null,{default:r(()=>[a(Y)]),_:1}),h[7]||(h[7]=b(" 图像增强 "))]),_:1,__:[7]},8,["disabled"]),a(K,{size:"small",onClick:x,disabled:f.value},{default:r(()=>[a(F,null,{default:r(()=>[a(ae)]),_:1}),h[8]||(h[8]=b(" 重置 "))]),_:1,__:[8]},8,["disabled"])]),_:1}),d("div",Et,[h[9]||(h[9]=d("span",{class:"control-label"},"亮度:",-1)),a(re,{modelValue:m.value,"onUpdate:modelValue":h[2]||(h[2]=ie=>m.value=ie),min:0,max:200,step:5,onInput:j,disabled:f.value},null,8,["modelValue","disabled"]),h[10]||(h[10]=d("span",{class:"control-label"},"对比度:",-1)),a(re,{modelValue:v.value,"onUpdate:modelValue":h[3]||(h[3]=ie=>v.value=ie),min:0,max:200,step:5,onInput:j,disabled:f.value},null,8,["modelValue","disabled"]),h[11]||(h[11]=d("span",{class:"control-label"},"缩放:",-1)),a(re,{modelValue:y.value,"onUpdate:modelValue":h[4]||(h[4]=ie=>y.value=ie),min:10,max:200,step:10,onInput:O,disabled:f.value},null,8,["modelValue","disabled"])]),a(K,{type:"danger",size:"small",onClick:Q,disabled:f.value},{default:r(()=>[a(F,null,{default:r(()=>[a(pe)]),_:1}),h[12]||(h[12]=b(" 删除 "))]),_:1,__:[12]},8,["disabled"])]),d("div",Vt,[d("img",{ref_key:"imageRef",ref:s,src:c.value,style:ot({filter:`brightness(${m.value}%) contrast(${v.value}%)`,transform:`scale(${y.value/100})`}),onLoad:H,class:"preview-image"},null,44,Ut),D.value?(S(),T("canvas",{key:0,ref_key:"overlayCanvas",ref:l,class:"analysis-overlay"},null,512)):ee("",!0),f.value?(S(),T("div",Nt,[a(ke,{type:"circle",percentage:w.value,status:w.value===100?"success":""},null,8,["percentage","status"]),d("p",null,"正在分析图像..."+L(w.value)+"%",1)])):ee("",!0)]),D.value?(S(),T("div",Ft,[h[16]||(h[16]=d("h3",null,"分析结果",-1)),d("div",Pt,[(S(!0),T(oe,null,ce(p.defects,(ie,$)=>(S(),T("div",{key:$,class:"defect-item"},[a(ge,{type:_(ie.severity),effect:"dark"},{default:r(()=>[b(L(ie.type),1)]),_:2},1032,["type"]),d("span",qt,"位置: "+L(ie.location.join(", ")),1),d("span",Qt," 可信度: "+L((ie.probability*100).toFixed(0))+"% ",1)]))),128))]),d("div",Bt,[d("div",Ot,[h[13]||(h[13]=d("span",{class:"summary-label"},"检测缺陷数:",-1)),d("span",jt,L(p.defects.length),1)]),d("div",Ht,[h[14]||(h[14]=d("span",{class:"summary-label"},"整体评估:",-1)),a(ge,{type:p.overallQuality==="pass"?"success":"danger"},{default:r(()=>[b(L(p.overallQuality==="pass"?"合格":"不合格"),1)]),_:1},8,["type"])])]),d("div",Wt,[a(K,{type:"primary",onClick:N},{default:r(()=>h[15]||(h[15]=[b(" 生成分析报告 ")])),_:1,__:[15]})])])):ee("",!0)])):ee("",!0)])}}},Zt=ve(Gt,[["__scopeId","data-v-850bee73"]]),Kt={class:"chart-generator"},Jt={class:"chart-toolbar"},Xt={class:"chart-type-selector"},Yt={class:"chart-actions"},en={key:0,class:"data-panel"},tn={class:"panel-header"},nn={class:"dimensions-editor"},an={class:"dimension-list"},sn={class:"series-editor"},on={class:"series-header"},ln={class:"series-data"},rn={key:0,class:"dim-label"},cn={class:"chart-settings"},dn={class:"setting-item"},un={class:"setting-item"},mn={class:"setting-item"},pn={class:"setting-item"},fn={class:"setting-item"},hn={class:"setting-item"},gn={class:"setting-item"},yn={key:0,class:"chart-loading"},vn={__name:"ChartGenerator",props:{initialData:{type:Object,default:()=>({dimensions:[],series:[]})},initialType:{type:String,default:"line"},height:{type:String,default:"400px"},theme:{type:String,default:""}},emits:["chart-updated","data-changed"],setup(u,{expose:e,emit:n}){it(C=>({"048e0092":t.height}));const t=u,o=n,s=U(null),l=U(null),c=U(null),i=U(t.initialType),m=U(!1),v=U(!1),y=U("dimensions"),f=he({dimensions:[...t.initialData.dimensions||["类别A","类别B","类别C","类别D","类别E"]],series:[...t.initialData.series||[{name:"系列1",type:"line",color:"#5470c6",data:[120,200,150,80,70]},{name:"系列2",type:"bar",color:"#91cc75",data:[60,80,240,100,150]}]]}),w=he({title:"数据分析图表",subtitle:"",xAxisName:"",yAxisName:"",showLegend:!0,showDataLabels:!1,enableZoom:!1});Re(()=>{p(),window.addEventListener("resize",E)}),We(()=>{c.value&&c.value.dispose(),window.removeEventListener("resize",E)}),xe(i,C=>{I()});function p(){s.value&&(c.value&&c.value.dispose(),c.value=Oe(s.value,t.theme),I(),c.value.on("click",P))}function D(){const C={title:{text:w.title,subtext:w.subtitle},tooltip:{trigger:i.value==="pie"?"item":"axis",formatter:i.value==="pie"?"{a} <br/>{b}: {c} ({d}%)":void 0},legend:{show:w.showLegend,type:f.series.length>10?"scroll":"plain"},toolbox:{feature:{saveAsImage:{},dataZoom:w.enableZoom?{show:!0}:{show:!1},restore:{}}}};return i.value==="pie"?C.series=[{name:w.title,type:"pie",radius:"60%",center:["50%","50%"],data:f.dimensions.map((_,N)=>{var M,h;return{name:_,value:((M=f.series[0])==null?void 0:M.data[N])||0,itemStyle:{color:(h=f.series[0])==null?void 0:h.color}}}),emphasis:{itemStyle:{shadowBlur:10,shadowOffsetX:0,shadowColor:"rgba(0, 0, 0, 0.5)"}},label:{show:w.showDataLabels,formatter:"{b}: {c} ({d}%)"}}]:i.value==="radar"?(C.radar={indicator:f.dimensions.map((_,N)=>{const M=Math.max(...f.series.map(h=>h.data[N]||0))*1.2;return{name:_,max:M>0?M:100}})},C.series=[{type:"radar",data:f.series.map(_=>({name:_.name,value:_.data,itemStyle:{color:_.color},lineStyle:{color:_.color},areaStyle:{color:_.color,opacity:.3}}))}]):(C.xAxis={type:"category",name:w.xAxisName,data:f.dimensions,axisLabel:{rotate:f.dimensions.length>6?45:0}},C.yAxis={type:"value",name:w.yAxisName},C.series=f.series.map(_=>({name:_.name,type:i.value==="scatter"?"scatter":_.type||i.value,data:_.data,itemStyle:{color:_.color},label:{show:w.showDataLabels,position:"top"}}))),w.enableZoom&&!["pie","radar"].includes(i.value)&&(C.dataZoom=[{type:"inside",start:0,end:100},{type:"slider",start:0,end:100}]),C}function I(){c.value&&(m.value=!0,be(()=>{const C=D();c.value.setOption(C,!0),m.value=!1,o("chart-updated",{type:i.value,options:C})}))}function z(){I()}function P(C){console.log("图表点击事件:",C)}function E(){c.value&&c.value.resize()}function H(C){if(c.value)switch(C){case"png":const _=c.value.getDataURL({type:"png",pixelRatio:2,backgroundColor:"#fff"});j(_,"chart.png");break;case"svg":const N=c.value.getDataURL({type:"svg",pixelRatio:1,backgroundColor:"#fff"});j(N,"chart.svg");break;case"json":const M={type:i.value,data:f,options:w},h=JSON.stringify(M,null,2),A=new Blob([h],{type:"application/json"}),F=URL.createObjectURL(A);O(F,"chart-data.json");break}}function j(C,_){const N=document.createElement("a");N.href=C,N.download=_,document.body.appendChild(N),N.click(),document.body.removeChild(N)}function O(C,_){const N=document.createElement("a");N.href=C,N.download=_,document.body.appendChild(N),N.click(),document.body.removeChild(N),URL.revokeObjectURL(C)}function Q(){f.dimensions.push(`类别${f.dimensions.length+1}`),f.series.forEach(C=>{C.data.push(0)})}function x(C){if(f.dimensions.length<=2){W.warning("至少保留两个维度");return}f.dimensions.splice(C,1),f.series.forEach(_=>{_.data.splice(C,1)})}function V(){const C=["#5470c6","#91cc75","#fac858","#ee6666","#73c0de","#3ba272","#fc8452","#9a60b4","#ea7ccc"],_=C[f.series.length%C.length];f.series.push({name:`系列${f.series.length+1}`,type:i.value,color:_,data:new Array(f.dimensions.length).fill(0)})}function X(C){if(f.series.length<=1){W.warning("至少保留一个数据系列");return}f.series.splice(C,1)}function se(){I(),o("data-changed",{dimensions:f.dimensions,series:f.series}),W.success("数据已更新")}return e({refreshChart:z,generateChart:I,exportChart:H,getChartData(){return{type:i.value,dimensions:f.dimensions,series:f.series}}}),(C,_)=>{const N=g("el-radio-button"),M=g("el-radio-group"),h=g("el-icon-refresh"),A=g("el-icon"),F=g("el-button"),q=g("el-icon-document"),K=g("el-icon-arrow-down"),Y=g("el-dropdown-item"),ae=g("el-dropdown-menu"),we=g("el-dropdown"),re=g("el-input"),pe=g("el-icon-delete"),ke=g("el-icon-plus"),ge=g("el-tab-pane"),ie=g("el-color-picker"),$=g("el-option"),k=g("el-select"),R=g("el-input-number"),te=g("el-checkbox"),ne=g("el-tabs"),G=g("el-icon-loading");return S(),T("div",Kt,[d("div",Jt,[d("div",Xt,[_[15]||(_[15]=d("span",{class:"toolbar-label"},"图表类型：",-1)),a(M,{modelValue:i.value,"onUpdate:modelValue":_[0]||(_[0]=B=>i.value=B),size:"small",onChange:I},{default:r(()=>[a(N,{label:"line"},{default:r(()=>_[10]||(_[10]=[b("折线图")])),_:1,__:[10]}),a(N,{label:"bar"},{default:r(()=>_[11]||(_[11]=[b("柱状图")])),_:1,__:[11]}),a(N,{label:"pie"},{default:r(()=>_[12]||(_[12]=[b("饼图")])),_:1,__:[12]}),a(N,{label:"scatter"},{default:r(()=>_[13]||(_[13]=[b("散点图")])),_:1,__:[13]}),a(N,{label:"radar"},{default:r(()=>_[14]||(_[14]=[b("雷达图")])),_:1,__:[14]})]),_:1},8,["modelValue"])]),d("div",Yt,[a(F,{size:"small",onClick:z},{default:r(()=>[a(A,null,{default:r(()=>[a(h)]),_:1})]),_:1}),a(F,{size:"small",onClick:_[1]||(_[1]=B=>v.value=!v.value)},{default:r(()=>[a(A,null,{default:r(()=>[a(q)]),_:1}),_[16]||(_[16]=b(" 编辑数据 "))]),_:1,__:[16]}),a(we,{onCommand:H},{dropdown:r(()=>[a(ae,null,{default:r(()=>[a(Y,{command:"png"},{default:r(()=>_[18]||(_[18]=[b("PNG图片")])),_:1,__:[18]}),a(Y,{command:"svg"},{default:r(()=>_[19]||(_[19]=[b("SVG图片")])),_:1,__:[19]}),a(Y,{command:"json"},{default:r(()=>_[20]||(_[20]=[b("JSON数据")])),_:1,__:[20]})]),_:1})]),default:r(()=>[a(F,{size:"small"},{default:r(()=>[_[17]||(_[17]=b(" 导出 ")),a(A,{class:"el-icon--right"},{default:r(()=>[a(K)]),_:1})]),_:1,__:[17]})]),_:1})])]),v.value?(S(),T("div",en,[d("div",tn,[_[22]||(_[22]=d("h3",null,"图表数据编辑",-1)),a(F,{size:"small",type:"primary",onClick:se},{default:r(()=>_[21]||(_[21]=[b(" 应用更改 ")])),_:1,__:[21]})]),a(ne,{modelValue:y.value,"onUpdate:modelValue":_[9]||(_[9]=B=>y.value=B)},{default:r(()=>[a(ge,{label:"维度数据",name:"dimensions"},{default:r(()=>[d("div",nn,[_[24]||(_[24]=d("p",{class:"edit-hint"},"维度数据（如时间、分类等）",-1)),d("div",an,[(S(!0),T(oe,null,ce(f.dimensions,(B,J)=>(S(),T("div",{key:`dim-${J}`,class:"dimension-item"},[a(re,{modelValue:f.dimensions[J],"onUpdate:modelValue":me=>f.dimensions[J]=me,size:"small",placeholder:"输入维度名称"},null,8,["modelValue","onUpdate:modelValue"]),a(F,{type:"danger",size:"small",icon:"el-icon-delete",onClick:me=>x(J),circle:"",plain:""},{default:r(()=>[a(A,null,{default:r(()=>[a(pe)]),_:1})]),_:2},1032,["onClick"])]))),128))]),a(F,{size:"small",onClick:Q,type:"primary",plain:""},{default:r(()=>[a(A,null,{default:r(()=>[a(ke)]),_:1}),_[23]||(_[23]=b(" 添加维度 "))]),_:1,__:[23]})])]),_:1}),a(ge,{label:"系列数据",name:"series"},{default:r(()=>[d("div",sn,[_[26]||(_[26]=d("p",{class:"edit-hint"},"系列数据（如各指标数值）",-1)),(S(!0),T(oe,null,ce(f.series,(B,J)=>(S(),T("div",{key:`series-${J}`,class:"series-container"},[d("div",on,[a(re,{modelValue:f.series[J].name,"onUpdate:modelValue":me=>f.series[J].name=me,size:"small",placeholder:"系列名称"},null,8,["modelValue","onUpdate:modelValue"]),a(ie,{modelValue:f.series[J].color,"onUpdate:modelValue":me=>f.series[J].color=me,size:"small"},null,8,["modelValue","onUpdate:modelValue"]),a(k,{modelValue:f.series[J].type,"onUpdate:modelValue":me=>f.series[J].type=me,size:"small",placeholder:"图表类型"},{default:r(()=>[a($,{label:"折线图",value:"line"}),a($,{label:"柱状图",value:"bar"}),a($,{label:"散点图",value:"scatter"})]),_:2},1032,["modelValue","onUpdate:modelValue"]),a(F,{type:"danger",size:"small",onClick:me=>X(J),circle:"",plain:""},{default:r(()=>[a(A,null,{default:r(()=>[a(pe)]),_:1})]),_:2},1032,["onClick"])]),d("div",ln,[(S(!0),T(oe,null,ce(B.data,(me,$e)=>(S(),T("div",{key:`value-${J}-${$e}`,class:"data-item"},[f.dimensions[$e]?(S(),T("span",rn,L(f.dimensions[$e])+": ",1)):ee("",!0),a(R,{modelValue:f.series[J].data[$e],"onUpdate:modelValue":Ne=>f.series[J].data[$e]=Ne,controls:!1,size:"small"},null,8,["modelValue","onUpdate:modelValue"])]))),128))])]))),128)),a(F,{size:"small",onClick:V,type:"primary",plain:""},{default:r(()=>[a(A,null,{default:r(()=>[a(ke)]),_:1}),_[25]||(_[25]=b(" 添加系列 "))]),_:1,__:[25]})])]),_:1}),a(ge,{label:"图表设置",name:"settings"},{default:r(()=>[d("div",cn,[d("div",dn,[_[27]||(_[27]=d("span",{class:"setting-label"},"标题：",-1)),a(re,{modelValue:w.title,"onUpdate:modelValue":_[2]||(_[2]=B=>w.title=B),size:"small",placeholder:"图表标题"},null,8,["modelValue"])]),d("div",un,[_[28]||(_[28]=d("span",{class:"setting-label"},"子标题：",-1)),a(re,{modelValue:w.subtitle,"onUpdate:modelValue":_[3]||(_[3]=B=>w.subtitle=B),size:"small",placeholder:"图表子标题"},null,8,["modelValue"])]),d("div",mn,[_[29]||(_[29]=d("span",{class:"setting-label"},"X轴标题：",-1)),a(re,{modelValue:w.xAxisName,"onUpdate:modelValue":_[4]||(_[4]=B=>w.xAxisName=B),size:"small",placeholder:"X轴标题"},null,8,["modelValue"])]),d("div",pn,[_[30]||(_[30]=d("span",{class:"setting-label"},"Y轴标题：",-1)),a(re,{modelValue:w.yAxisName,"onUpdate:modelValue":_[5]||(_[5]=B=>w.yAxisName=B),size:"small",placeholder:"Y轴标题"},null,8,["modelValue"])]),d("div",fn,[a(te,{modelValue:w.showLegend,"onUpdate:modelValue":_[6]||(_[6]=B=>w.showLegend=B)},{default:r(()=>_[31]||(_[31]=[b("显示图例")])),_:1,__:[31]},8,["modelValue"])]),d("div",hn,[a(te,{modelValue:w.showDataLabels,"onUpdate:modelValue":_[7]||(_[7]=B=>w.showDataLabels=B)},{default:r(()=>_[32]||(_[32]=[b("显示数据标签")])),_:1,__:[32]},8,["modelValue"])]),d("div",gn,[a(te,{modelValue:w.enableZoom,"onUpdate:modelValue":_[8]||(_[8]=B=>w.enableZoom=B)},{default:r(()=>_[33]||(_[33]=[b("启用缩放功能")])),_:1,__:[33]},8,["modelValue"])])])]),_:1})]),_:1},8,["modelValue"])])):ee("",!0),d("div",{class:"chart-container",ref_key:"chartContainer",ref:l},[d("div",{ref_key:"chartRef",ref:s,class:"chart"},null,512),m.value?(S(),T("div",yn,[a(A,{class:"loading-icon"},{default:r(()=>[a(G)]),_:1}),_[34]||(_[34]=d("span",null,"加载中...",-1))])):ee("",!0)],512)])}}},_n=ve(vn,[["__scopeId","data-v-2cffa5a8"]]),wn={class:"chat-window"},bn={key:0,class:"message-item system-message"},kn={class:"message-avatar"},$n={class:"message-content"},Dn={class:"message-bubble"},Cn=["innerHTML"],Mn={class:"message-time"},Sn={class:"message-avatar"},In={class:"message-content"},An={class:"message-bubble"},xn=["innerHTML"],Rn={key:1,class:"message-chart"},zn={key:0,class:"chart-title"},Ln=["id"],Tn={key:2,class:"message-image"},En={class:"image-error"},Vn={key:0,class:"image-caption"},Un={key:3,class:"message-file"},Nn={key:4,class:"message-loading"},Fn={key:5,class:"message-error"},Pn={class:"message-time"},qn={key:0,class:"message-actions"},Qn={class:"input-container"},Bn={class:"input-tools"},On={class:"input-actions"},jn={key:0,class:"voice-indicator"},Hn={class:"voice-wave"},Wn={__name:"ChatWindow",props:{welcomeMessage:{type:String,default:"您好，我是IQE智能助手，有什么可以帮您?"},userAvatar:{type:String,default:"/src/assets/user-avatar.png"},botAvatar:{type:String,default:"/src/assets/bot-avatar.png"},contextMemory:{type:Boolean,default:!0},maxContextMessages:{type:Number,default:10}},emits:["send-message","clear-chat","speech-start","speech-end","image-upload"],setup(u,{expose:e,emit:n}){const t=u,o=n,s=U([]),l=U(""),c=U(null),i=U(!1),m=U(!1),v=U(!1),y=U(!1),f=U(null),w=U(!1),p=U(null),D=he({});Re(()=>{(window.SpeechRecognition||window.webkitSpeechRecognition)&&(w.value=!0,I()),c.value&&c.value.addEventListener("scroll",j),H()}),We(()=>{c.value&&c.value.removeEventListener("scroll",j),Object.values(D).forEach(M=>{M.dispose()}),_()}),xe(s,()=>{be(()=>{O(),H()})},{deep:!0});function I(){try{const M=window.SpeechRecognition||window.webkitSpeechRecognition;p.value=new M,p.value.continuous=!0,p.value.interimResults=!0,p.value.lang="zh-CN",p.value.onresult=h=>{let A="";for(let F=h.resultIndex;F<h.results.length;F++)h.results[F].isFinal&&(A+=h.results[F][0].transcript);A&&(l.value+=A)},p.value.onend=()=>{i.value=!1},p.value.onerror=h=>{console.error("语音识别错误：",h.error),i.value=!1,W.error("语音识别出错")}}catch(M){console.error("设置语音识别失败：",M),w.value=!1}}function z(M){return new Date(M).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}function P(M){if(!M)return"";let h=M.replace(/\n/g,"<br>").replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>").replace(/\*(.*?)\*/g,"<em>$1</em>").replace(/\[([^\]]+)\]\(([^)]+)\)/g,'<a href="$2" target="_blank">$1</a>');return h=h.replace(/^# (.*?)$/gm,"<h1>$1</h1>").replace(/^## (.*?)$/gm,"<h2>$1</h2>").replace(/^### (.*?)$/gm,"<h3>$1</h3>"),h}async function E(){const M=l.value.trim();if(!M&&!v.value)return;const h={role:"user",type:"text",content:M,timestamp:Date.now()};s.value.push(h),l.value="";const A=s.value.length;s.value.push({role:"assistant",type:"loading",content:"",timestamp:Date.now()}),m.value=!0;try{const F=t.contextMemory?s.value.filter(K=>K.type!=="loading"&&K.type!=="error").slice(-(t.maxContextMessages*2)):[],q=await new Promise(K=>{o("send-message",M,F,K)});s.value.splice(A,1),q?typeof q=="string"?s.value.push({role:"assistant",type:"text",content:q,timestamp:Date.now()}):typeof q=="object"&&s.value.push({role:"assistant",type:q.type||"text",content:q.content,timestamp:Date.now(),...q.type==="chart"&&{chartData:q.chartData,chartTitle:q.title},...q.type==="image"&&{alt:q.alt,caption:q.caption},...q.type==="file"&&{fileName:q.fileName}}):s.value.push({role:"assistant",type:"error",content:"抱歉，我无法生成回复。",timestamp:Date.now()})}catch(F){console.error("发送消息错误：",F),s.value.splice(A,1),s.value.push({role:"assistant",type:"error",content:"发送消息时出错："+F.message,timestamp:Date.now()})}finally{m.value=!1,be(()=>{H()})}}function H(){be(()=>{s.value.forEach((M,h)=>{if(M.type==="chart"){const A=document.getElementById(`chart-${h}`);A&&(D[`chart-${h}`]&&D[`chart-${h}`].dispose(),D[`chart-${h}`]=Oe(A),M.chartData&&D[`chart-${h}`].setOption(M.chartData))}})})}function j(){if(!c.value)return;const{scrollTop:M,scrollHeight:h,clientHeight:A}=c.value,F=h-M-A<50;y.value=!F&&s.value.length>0}function O(){c.value&&(c.value.scrollTop=c.value.scrollHeight,y.value=!1)}function Q(M){if(!M)return;const h=document.createElement("div");h.innerHTML=M;const A=h.textContent||h.innerText||M;navigator.clipboard.writeText(A).then(()=>{W.success("内容已复制到剪贴板")}).catch(F=>{console.error("复制失败：",F),W.error("复制失败")})}function x(M){if(!M)return;const h=document.createElement("div");h.innerHTML=M;const A=h.textContent||h.innerText||M;o("speech-start",A)}function V(){f.value&&f.value.click()}async function X(M){const h=M.target.files[0];if(h){if(!h.type.startsWith("image/")){W.error("请上传图片文件");return}v.value=!0;try{const A=await new Promise(F=>{const q=new FileReader;q.onload=K=>F(K.target.result),q.onerror=()=>F(null),q.readAsDataURL(h)});A?(s.value.push({role:"user",type:"image",content:A,timestamp:Date.now()}),o("image-upload",{dataUrl:A,file:h})):W.error("图片读取失败")}catch(A){console.error("图片上传错误：",A),W.error("图片上传失败")}finally{v.value=!1,f.value&&(f.value.value="")}}}function se(){i.value?_():C()}function C(){p.value||I();try{p.value.start(),i.value=!0,o("speech-start")}catch(M){console.error("启动语音识别失败：",M),i.value=!1,W.error("启动语音识别失败")}}function _(){if(p.value)try{p.value.stop()}catch(M){console.error("停止语音识别失败：",M)}i.value=!1,o("speech-end")}function N(M,h){const A=document.createElement("a");A.href=M,A.download=h||"download",document.body.appendChild(A),A.click(),document.body.removeChild(A)}return e({messages:s,addMessage(M,h,A="text",F={}){s.value.push({role:M,type:A,content:h,timestamp:Date.now(),...F})},clearMessages(){s.value=[]},getMessages(){return s.value},startVoiceInput:C,stopVoiceInput:_}),(M,h)=>{const A=g("el-avatar"),F=g("el-icon-picture"),q=g("el-icon"),K=g("el-image"),Y=g("el-icon-document"),ae=g("el-button"),we=g("el-icon-warning"),re=g("el-icon-document-copy"),pe=g("el-tooltip"),ke=g("el-icon-headset"),ge=g("el-icon-caret-bottom"),ie=g("el-icon-picture-outline"),$=g("el-icon-microphone"),k=g("el-input");return S(),T("div",wn,[d("div",{class:"messages-container",ref_key:"messagesContainer",ref:c},[u.welcomeMessage?(S(),T("div",bn,[d("div",kn,[a(A,{size:40,src:u.botAvatar},null,8,["src"])]),d("div",$n,[d("div",Dn,[d("div",{class:"message-text",innerHTML:P(u.welcomeMessage)},null,8,Cn)]),d("div",Mn,L(z(Date.now())),1)])])):ee("",!0),(S(!0),T(oe,null,ce(s.value,(R,te)=>(S(),T("div",{key:te,class:Qe(["message-item",R.role==="user"?"user-message":"bot-message"])},[d("div",Sn,[a(A,{size:40,src:R.role==="user"?u.userAvatar:u.botAvatar},null,8,["src"])]),d("div",In,[d("div",An,[R.type==="text"?(S(),T("div",{key:0,class:"message-text",innerHTML:P(R.content)},null,8,xn)):R.type==="chart"?(S(),T("div",Rn,[R.chartTitle?(S(),T("div",zn,L(R.chartTitle),1)):ee("",!0),d("div",{id:`chart-${te}`,class:"chart-container",style:{height:"300px"}},null,8,Ln)])):R.type==="image"?(S(),T("div",Tn,[a(K,{src:R.content,"preview-src-list":[R.content],fit:"contain",alt:R.alt||"图片"},{error:r(()=>[d("div",En,[a(q,null,{default:r(()=>[a(F)]),_:1}),h[1]||(h[1]=d("span",null,"加载失败",-1))])]),_:2},1032,["src","preview-src-list","alt"]),R.caption?(S(),T("div",Vn,L(R.caption),1)):ee("",!0)])):R.type==="file"?(S(),T("div",Un,[a(ae,{type:"primary",size:"small",onClick:ne=>N(R.content,R.fileName)},{default:r(()=>[a(q,null,{default:r(()=>[a(Y)]),_:1}),b(" 下载"+L(R.fileName),1)]),_:2},1032,["onClick"])])):R.type==="loading"?(S(),T("div",Nn,h[2]||(h[2]=[d("div",{class:"loading-dots"},[d("div",{class:"dot dot1"}),d("div",{class:"dot dot2"}),d("div",{class:"dot dot3"})],-1)]))):R.type==="error"?(S(),T("div",Fn,[a(q,null,{default:r(()=>[a(we)]),_:1}),d("span",null,L(R.content),1)])):ee("",!0)]),d("div",Pn,L(z(R.timestamp)),1),R.role==="assistant"&&R.type!=="loading"?(S(),T("div",qn,[a(pe,{content:"复制内容",placement:"top"},{default:r(()=>[a(ae,{size:"small",circle:"",onClick:ne=>Q(R.content)},{default:r(()=>[a(q,null,{default:r(()=>[a(re)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024),R.type==="text"?(S(),le(pe,{key:0,content:"朗读内容",placement:"top"},{default:r(()=>[a(ae,{size:"small",circle:"",onClick:ne=>x(R.content)},{default:r(()=>[a(q,null,{default:r(()=>[a(ke)]),_:1})]),_:2},1032,["onClick"])]),_:2},1024)):ee("",!0)])):ee("",!0)])],2))),128)),Ce(d("div",{class:"new-message-indicator",onClick:O},[a(q,null,{default:r(()=>[a(ge)]),_:1}),h[3]||(h[3]=b(" 新消息 "))],512),[[Me,y.value]])],512),d("div",Qn,[d("div",Bn,[a(pe,{content:"上传图片",placement:"top"},{default:r(()=>[a(ae,{type:"text",onClick:V},{default:r(()=>[a(q,null,{default:r(()=>[a(ie)]),_:1})]),_:1})]),_:1}),w.value?(S(),le(pe,{key:0,content:"语音输入",placement:"top"},{default:r(()=>[a(ae,{type:"text",class:Qe({active:i.value}),onClick:se},{default:r(()=>[a(q,null,{default:r(()=>[a($)]),_:1})]),_:1},8,["class"])]),_:1})):ee("",!0),d("input",{ref_key:"fileInput",ref:f,type:"file",accept:"image/*",style:{display:"none"},onChange:X},null,544)]),a(k,{modelValue:l.value,"onUpdate:modelValue":h[0]||(h[0]=R=>l.value=R),type:"textarea",rows:2,resize:"none",placeholder:"输入您的问题...",onKeyup:lt(qe(E,["ctrl"]),["enter"])},null,8,["modelValue","onKeyup"]),d("div",On,[a(ae,{type:"primary",disabled:!l.value.trim()&&!v.value,loading:v.value||m.value,onClick:E},{default:r(()=>h[4]||(h[4]=[b(" 发送 ")])),_:1,__:[4]},8,["disabled","loading"])])]),i.value?(S(),T("div",jn,[d("div",Hn,[(S(),T(oe,null,ce(5,R=>d("div",{class:"wave-bar",key:R})),64))]),h[6]||(h[6]=d("span",null,"正在聆听...",-1)),a(ae,{size:"small",type:"danger",onClick:_},{default:r(()=>h[5]||(h[5]=[b(" 停止 ")])),_:1,__:[5]})])):ee("",!0)])}}},Gn=ve(Wn,[["__scopeId","data-v-6f6a439f"]]),Zn={class:"risk-analysis-card"},Kn={class:"risk-score-section"},Jn={class:"risk-meter"},Xn={class:"progress-content"},Yn={class:"score"},ea={class:"risk-level"},ta={class:"update-time"},na={class:"risk-factors-section"},aa={class:"recommended-strategy-section"},sa={class:"section-header"},oa={class:"strategy-item"},ia={class:"item-value"},la={class:"strategy-item"},ra={class:"item-value"},ca={class:"strategy-item"},da={class:"item-value"},ua={key:0,class:"additional-tests"},ma={class:"test-tags"},pa={class:"strategy-description"},fa={class:"actions-section"},ha={__name:"RiskAnalysisCard",props:{riskData:{type:Object,default:null}},emits:["action-triggered"],setup(u,{emit:e}){const n=u,t=e;function o(y){return y==null?"未知":`${(y*100).toFixed(2)}%`}function s(y){if(!y)return"未知";const f=new Date(y);return`${f.toLocaleDateString()} ${f.toLocaleTimeString()}`}function l(y,f){if(!y||f===void 0)return"未知";switch(y){case"up":return`上升 ${f}%`;case"down":return`下降 ${f}%`;case"stable":return"保持稳定";default:return"未知"}}function c(y){return y>=80?"#8B0000":y>=60?"#F56C6C":y>=40?"#E6A23C":"#67C23A"}function i(y){switch(y){case"critical":return"danger";case"high":return"error";case"medium":return"warning";case"low":return"success";default:return"info"}}function m(y){switch(y){case"up":return"danger";case"down":return"success";case"stable":return"info";default:return"info"}}function v(y){t("action-triggered",{type:y,data:n.riskData})}return(y,f)=>{const w=g("el-progress"),p=g("el-tag"),D=g("el-descriptions-item"),I=g("el-descriptions"),z=g("el-col"),P=g("el-row"),E=g("el-card"),H=g("el-button"),j=g("el-empty");return S(),T("div",Zn,[u.riskData?(S(),T(oe,{key:0},[d("div",Kn,[d("div",Jn,[a(w,{type:"dashboard",percentage:u.riskData.riskScore,color:c(u.riskData.riskScore),"stroke-width":15},{default:r(()=>[d("div",Xn,[d("span",Yn,L(u.riskData.riskScore),1),f[3]||(f[3]=d("span",{class:"label"},"风险分",-1))])]),_:1},8,["percentage","color"])]),d("div",ea,[a(p,{type:i(u.riskData.riskLevel.value),size:"large"},{default:r(()=>[b(L(u.riskData.riskLevel.label),1)]),_:1},8,["type"]),d("p",ta,"更新于: "+L(s(u.riskData.timestamp)),1)])]),d("div",na,[f[4]||(f[4]=d("h4",null,"风险因素分析",-1)),a(I,{column:2,border:""},{default:r(()=>[a(D,{label:"平均缺陷率"},{default:r(()=>[b(L(o(u.riskData.factors.avgDefectRate)),1)]),_:1}),a(D,{label:"供应商稳定性"},{default:r(()=>[b(L(o(u.riskData.factors.supplierStability)),1)]),_:1}),a(D,{label:"批次一致性"},{default:r(()=>[b(L(o(u.riskData.factors.batchConsistency)),1)]),_:1}),a(D,{label:"历史对比"},{default:r(()=>[a(p,{type:m(u.riskData.historicalComparison.trendDirection)},{default:r(()=>[b(L(l(u.riskData.historicalComparison.trendDirection,u.riskData.historicalComparison.changePercentage)),1)]),_:1},8,["type"])]),_:1})]),_:1})]),d("div",aa,[d("div",sa,[f[5]||(f[5]=d("h4",null,"建议检验策略",-1)),a(p,{type:"info"},{default:r(()=>[b("优先级: "+L(u.riskData.recommendedStrategy.priority),1)]),_:1})]),a(E,{shadow:"hover"},{default:r(()=>[a(P,{gutter:20},{default:r(()=>[a(z,{span:8},{default:r(()=>[d("div",oa,[f[6]||(f[6]=d("div",{class:"item-label"},"检验水平",-1)),d("div",ia,L(u.riskData.recommendedStrategy.inspectionLevel),1)])]),_:1}),a(z,{span:8},{default:r(()=>[d("div",la,[f[7]||(f[7]=d("div",{class:"item-label"},"抽样大小",-1)),d("div",ra,L(u.riskData.recommendedStrategy.sampleSize),1)])]),_:1}),a(z,{span:8},{default:r(()=>[d("div",ca,[f[8]||(f[8]=d("div",{class:"item-label"},"检验频率",-1)),d("div",da,L(u.riskData.recommendedStrategy.frequency),1)])]),_:1})]),_:1}),u.riskData.recommendedStrategy.additionalTests.length>0?(S(),T("div",ua,[f[9]||(f[9]=d("div",{class:"item-label"},"额外测试项目",-1)),d("div",ma,[(S(!0),T(oe,null,ce(u.riskData.recommendedStrategy.additionalTests,O=>(S(),le(p,{key:O,size:"small",class:"test-tag"},{default:r(()=>[b(L(O),1)]),_:2},1024))),128))])])):ee("",!0),d("div",pa,L(u.riskData.recommendedStrategy.description),1)]),_:1})]),d("div",fa,[a(H,{type:"primary",onClick:f[0]||(f[0]=O=>v("applyStrategy"))},{default:r(()=>f[10]||(f[10]=[b(" 应用策略 ")])),_:1,__:[10]}),a(H,{type:"success",onClick:f[1]||(f[1]=O=>v("exportReport"))},{default:r(()=>f[11]||(f[11]=[b(" 导出报告 ")])),_:1,__:[11]}),a(H,{onClick:f[2]||(f[2]=O=>v("explainAnalysis"))},{default:r(()=>f[12]||(f[12]=[b(" 解释分析 ")])),_:1,__:[12]})])],64)):(S(),le(j,{key:1,description:"暂无风险分析数据"}))])}}},ga=ve(ha,[["__scopeId","data-v-2587ea93"]]),ya={class:"trend-prediction-card"},va={class:"trend-overview"},_a={class:"trend-indicator"},wa={class:"confidence"},ba={class:"update-time"},ka={class:"trend-chart-container"},$a={class:"prediction-details"},Da={class:"actions-section"},Ca={__name:"TrendPredictionCard",props:{trendData:{type:Object,default:null}},emits:["action-triggered"],setup(u,{emit:e}){bt([ut,mt,pt,ft,ht,gt,_t,wt,yt]);const n=u,t=e,o=U(null);let s=null;function l(I){if(!I)return"未知";const z=new Date(I);return`${z.toLocaleDateString()} ${z.toLocaleTimeString()}`}function c(I){return I?new Date(I).toLocaleDateString():"未知"}function i(I){switch(I){case"up":return"danger";case"down":return"success";case"stable":return"info";default:return"info"}}function m(I){switch(I){case"up":return"上升趋势";case"down":return"下降趋势";case"stable":return"稳定趋势";default:return"未知趋势"}}function v(I){return I>=.8?"#67C23A":I>=.6?"#E6A23C":"#F56C6C"}function y(I,z,P){if(z===0)return"info";const E=P[z-1].value;return I>E?"danger":I<E?"success":"info"}function f(I,z,P){if(z===0)return"基准点";const E=P[z-1].value,H=I-E,j=(Math.abs(H)/E*100).toFixed(1);return H>0?`上升 ${j}%`:H<0?`下降 ${j}%`:"持平"}function w(){o.value&&(s=Oe(o.value),p(),window.addEventListener("resize",()=>{s&&s.resize()}))}function p(){if(!s||!n.trendData)return;const{prediction:I,trend:z}=n.trendData,P=I.map(Q=>c(Q.timestamp)),E=I.map(Q=>Q.value),H=I.map(Q=>Q.value*(1-(1-Q.confidence)/2)),j=I.map(Q=>Q.value*(1+(1-Q.confidence)/2)),O={title:{text:"质量趋势预测",left:"center"},tooltip:{trigger:"axis",formatter:function(Q){const x=Q[0].axisValue,V=Q[0].data.toFixed(2),X=Q[1].data.toFixed(2),se=Q[2].data.toFixed(2);return`
          <div style="font-weight: bold; margin-bottom: 5px;">${x}</div>
          <div>预测值: ${V}</div>
          <div>下限: ${X}</div>
          <div>上限: ${se}</div>
          <div>可信区间: ${X} - ${se}</div>
        `}},legend:{data:["预测值","可信区间"],bottom:0},grid:{left:"3%",right:"4%",bottom:"15%",top:"15%",containLabel:!0},xAxis:{type:"category",data:P,boundaryGap:!1},yAxis:{type:"value",name:"值",axisLabel:{formatter:"{value}"}},dataZoom:[{type:"inside",start:0,end:100},{start:0,end:100}],series:[{name:"预测值",type:"line",data:E,symbol:"circle",symbolSize:8,itemStyle:{color:z==="up"?"#F56C6C":z==="down"?"#67C23A":"#409EFF"},lineStyle:{width:3}},{name:"下限",type:"line",data:H,lineStyle:{opacity:0},stack:"confidence",symbol:"none"},{name:"上限",type:"line",data:j,lineStyle:{opacity:0},areaStyle:{color:"rgba(64, 158, 255, 0.2)"},stack:"confidence",symbol:"none"}]};s.setOption(O)}function D(I){t("action-triggered",{type:I,data:n.trendData})}return xe(()=>n.trendData,()=>{p()},{deep:!0}),Re(()=>{w()}),onUnmounted(()=>{s&&(s.dispose(),s=null),window.removeEventListener("resize",()=>{s&&s.resize()})}),(I,z)=>{const P=g("el-tag"),E=g("el-progress"),H=g("el-table-column"),j=g("el-table"),O=g("el-button"),Q=g("el-empty");return S(),T("div",ya,[u.trendData?(S(),T(oe,{key:0},[d("div",va,[d("div",_a,[a(P,{type:i(u.trendData.trend),size:"large"},{default:r(()=>[b(L(m(u.trendData.trend)),1)]),_:1},8,["type"]),d("div",wa,[z[3]||(z[3]=d("span",{class:"label"},"置信度:",-1)),a(E,{percentage:Math.round(u.trendData.confidence*100),format:x=>`${x}%`,color:v(u.trendData.confidence),"stroke-width":10},null,8,["percentage","format","color"])]),d("p",ba,"更新于: "+L(l(u.trendData.timestamp)),1)])]),d("div",ka,[d("div",{ref_key:"chartRef",ref:o,class:"trend-chart"},null,512)]),d("div",$a,[z[4]||(z[4]=d("h4",null,"预测详情",-1)),a(j,{data:u.trendData.prediction,style:{width:"100%"}},{default:r(()=>[a(H,{prop:"timestamp",label:"时间点",width:"180"},{default:r(x=>[b(L(c(x.row.timestamp)),1)]),_:1}),a(H,{prop:"value",label:"预测值",width:"120"},{default:r(x=>[b(L(x.row.value.toFixed(2)),1)]),_:1}),a(H,{prop:"confidence",label:"置信度",width:"120"},{default:r(x=>[a(E,{percentage:Math.round(x.row.confidence*100),color:v(x.row.confidence),"stroke-width":6},null,8,["percentage","color"])]),_:1}),a(H,{label:"趋势"},{default:r(x=>[a(P,{type:y(x.row.value,x.$index,u.trendData.prediction)},{default:r(()=>[b(L(f(x.row.value,x.$index,u.trendData.prediction)),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),d("div",Da,[a(O,{type:"primary",onClick:z[0]||(z[0]=x=>D("exportPrediction"))},{default:r(()=>z[5]||(z[5]=[b(" 导出预测 ")])),_:1,__:[5]}),a(O,{type:"success",onClick:z[1]||(z[1]=x=>D("createAlert"))},{default:r(()=>z[6]||(z[6]=[b(" 设置提醒 ")])),_:1,__:[6]}),a(O,{onClick:z[2]||(z[2]=x=>D("explainPrediction"))},{default:r(()=>z[7]||(z[7]=[b(" 解释预测 ")])),_:1,__:[7]})])],64)):(S(),le(Q,{key:1,description:"暂无趋势预测数据"}))])}}},Ma=ve(Ca,[["__scopeId","data-v-048686c2"]]),Sa={class:"anomaly-detection-card"},Ia={class:"anomaly-summary"},Aa={class:"anomaly-count"},xa={class:"updated-at"},Ra={class:"anomaly-list"},za={class:"anomaly-item-header"},La={class:"anomaly-title"},Ta={class:"anomaly-details"},Ea={key:0,class:"anomaly-metrics"},Va={class:"anomaly-actions"},Ua={class:"batch-actions"},Na={key:1,class:"no-anomalies"},Fa={__name:"AnomalyDetectionCard",props:{anomalyData:{type:Object,default:null}},emits:["action-triggered"],setup(u,{emit:e}){const n=u,t=e,o=U([0]);function s(p){if(!p)return"未知";const D=new Date(p);return`${D.toLocaleDateString()} ${D.toLocaleTimeString()}`}function l(p){return p==null?"未知":typeof p=="number"?p.toFixed(2):p.toString()}function c(p){if(p==null)return"未知";const D=(p*100).toFixed(2);return(p>=0?"+":"")+`${D}%`}function i(p){switch(p){case"critical":return"danger";case"high":return"error";case"medium":return"warning";case"low":return"info";default:return"info"}}function m(p){switch(p){case"critical":return"严重";case"high":return"高";case"medium":return"中";case"low":return"低";default:return"未知"}}function v(p){return p>=.8?"#67C23A":p>=.6?"#E6A23C":"#F56C6C"}function y(p){return Math.abs(p)<.05?"info":Math.abs(p)<.1?"warning":"danger"}function f(p,D){t("action-triggered",{type:p,anomaly:D,data:n.anomalyData})}function w(p){t("action-triggered",{type:p,data:n.anomalyData})}return(p,D)=>{const I=g("el-badge"),z=g("el-tag"),P=g("el-descriptions-item"),E=g("el-progress"),H=g("el-descriptions"),j=g("el-table-column"),O=g("el-table"),Q=g("el-button"),x=g("el-collapse-item"),V=g("el-collapse"),X=g("el-result"),se=g("el-empty");return S(),T("div",Sa,[u.anomalyData&&u.anomalyData.anomalies.length>0?(S(),T(oe,{key:0},[d("div",Ia,[d("div",Aa,[a(I,{value:u.anomalyData.anomalies.length,type:"warning",max:99},{default:r(()=>D[4]||(D[4]=[d("span",{class:"count-title"},"检测到的异常",-1)])),_:1,__:[4]},8,["value"])]),d("div",xa," 更新于: "+L(s(u.anomalyData.timestamp)),1)]),d("div",Ra,[a(V,{modelValue:o.value,"onUpdate:modelValue":D[0]||(D[0]=C=>o.value=C)},{default:r(()=>[(S(!0),T(oe,null,ce(u.anomalyData.anomalies,(C,_)=>(S(),le(x,{key:_,name:_},{title:r(()=>[d("div",za,[a(z,{type:i(C.severity),size:"small"},{default:r(()=>[b(L(m(C.severity)),1)]),_:2},1032,["type"]),d("span",La,L(C.name),1)])]),default:r(()=>[d("div",Ta,[a(H,{column:1,border:"",size:"small"},{default:r(()=>[a(P,{label:"异常类型"},{default:r(()=>[b(L(C.type),1)]),_:2},1024),a(P,{label:"异常描述"},{default:r(()=>[b(L(C.description),1)]),_:2},1024),a(P,{label:"发现时间"},{default:r(()=>[b(L(s(C.detectedAt)),1)]),_:2},1024),a(P,{label:"置信度"},{default:r(()=>[a(E,{percentage:Math.round(C.confidence*100),format:N=>`${N}%`,color:v(C.confidence),"stroke-width":10},null,8,["percentage","format","color"])]),_:2},1024)]),_:2},1024),C.metrics&&C.metrics.length>0?(S(),T("div",Ea,[D[5]||(D[5]=d("h5",null,"关联指标",-1)),a(O,{data:C.metrics,style:{width:"100%"},size:"small"},{default:r(()=>[a(j,{prop:"name",label:"指标名称"}),a(j,{prop:"value",label:"观察值"},{default:r(N=>[b(L(l(N.row.value)),1)]),_:1}),a(j,{prop:"expected",label:"预期值"},{default:r(N=>[b(L(l(N.row.expected)),1)]),_:1}),a(j,{prop:"deviation",label:"偏差"},{default:r(N=>[a(z,{type:y(N.row.deviation)},{default:r(()=>[b(L(c(N.row.deviation)),1)]),_:2},1032,["type"])]),_:1})]),_:2},1032,["data"])])):ee("",!0),d("div",Va,[a(Q,{type:"primary",size:"small",onClick:N=>f("investigate",C)},{default:r(()=>D[6]||(D[6]=[b(" 调查异常 ")])),_:2,__:[6]},1032,["onClick"]),a(Q,{type:"success",size:"small",onClick:N=>f("resolve",C)},{default:r(()=>D[7]||(D[7]=[b(" 标记已解决 ")])),_:2,__:[7]},1032,["onClick"])])])]),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])]),d("div",Ua,[a(Q,{type:"primary",onClick:D[1]||(D[1]=C=>w("exportAnomalies"))},{default:r(()=>D[8]||(D[8]=[b(" 导出异常报告 ")])),_:1,__:[8]}),a(Q,{onClick:D[2]||(D[2]=C=>w("configureDetection"))},{default:r(()=>D[9]||(D[9]=[b(" 配置检测规则 ")])),_:1,__:[9]})])],64)):u.anomalyData&&u.anomalyData.anomalies.length===0?(S(),T("div",Na,[a(X,{icon:"success",title:"未检测到异常","sub-title":"当前物料没有发现任何异常，系统将持续监控"},{extra:r(()=>[a(Q,{type:"primary",onClick:D[3]||(D[3]=C=>w("configureDetection"))},{default:r(()=>D[10]||(D[10]=[b(" 配置检测规则 ")])),_:1,__:[10]})]),_:1})])):(S(),le(se,{key:2,description:"暂无异常检测数据"}))])}}},Pa=ve(Fa,[["__scopeId","data-v-7e087b2b"]]),qa={class:"recommendation-card"},Qa={class:"recommendation-overview"},Ba={class:"overview-header"},Oa={class:"update-time"},ja={key:0,class:"context-info"},Ha={class:"recommendations-list"},Wa={class:"recommendation-item"},Ga={class:"recommendation-header"},Za={class:"recommendation-content"},Ka={class:"description"},Ja={class:"detail-item"},Xa={class:"value"},Ya={class:"detail-item"},es={class:"value"},ts={class:"detail-item"},ns={class:"value"},as={class:"key-checkpoints"},ss={class:"expected-outcome"},os={class:"recommendation-actions"},is={class:"global-actions"},ls={__name:"RecommendationCard",props:{recommendationData:{type:Object,default:null}},emits:["action-triggered"],setup(u,{emit:e}){const n=u,t=e;function o(i){if(!i)return"未知";const m=new Date(i);return`${m.toLocaleDateString()} ${m.toLocaleTimeString()}`}function s(i){return i>=.8?"success":i>=.6?"warning":"info"}function l(i,m){t("action-triggered",{type:i,recommendation:m,data:n.recommendationData})}function c(i){t("action-triggered",{type:i,data:n.recommendationData})}return(i,m)=>{const v=g("el-alert"),y=g("el-tag"),f=g("el-divider"),w=g("el-col"),p=g("el-row"),D=g("el-button"),I=g("el-tab-pane"),z=g("el-tabs"),P=g("el-empty");return S(),T("div",qa,[u.recommendationData&&u.recommendationData.recommendations.length>0?(S(),T(oe,{key:0},[d("div",Qa,[d("div",Ba,[m[2]||(m[2]=d("h4",null,"检验策略推荐",-1)),d("p",Oa,"更新于: "+L(o(u.recommendationData.timestamp)),1)]),u.recommendationData.context?(S(),T("div",ja,[a(v,{type:"info",closable:!1,"show-icon":""},{title:r(()=>[b(" AI推荐依据: "+L(u.recommendationData.context.reason),1)]),default:r(()=>[d("p",null,L(u.recommendationData.context.description),1)]),_:1})])):ee("",!0)]),d("div",Ha,[a(z,{type:"border-card"},{default:r(()=>[(S(!0),T(oe,null,ce(u.recommendationData.recommendations,(E,H)=>(S(),le(I,{key:H,label:`策略 ${H+1}`},{default:r(()=>[d("div",Wa,[d("div",Ga,[d("h5",null,L(E.name),1),a(y,{type:s(E.confidence)},{default:r(()=>[b(" 置信度: "+L(Math.round(E.confidence*100))+"% ",1)]),_:2},1032,["type"])]),d("div",Za,[d("p",Ka,L(E.description),1),a(f,{"content-position":"left"},{default:r(()=>m[3]||(m[3]=[b("策略详情")])),_:1,__:[3]}),a(p,{gutter:20},{default:r(()=>[a(w,{span:8},{default:r(()=>[d("div",Ja,[m[4]||(m[4]=d("span",{class:"label"},"检验水平:",-1)),d("span",Xa,L(E.details.inspectionLevel),1)])]),_:2},1024),a(w,{span:8},{default:r(()=>[d("div",Ya,[m[5]||(m[5]=d("span",{class:"label"},"抽样方案:",-1)),d("span",es,L(E.details.samplingPlan),1)])]),_:2},1024),a(w,{span:8},{default:r(()=>[d("div",ts,[m[6]||(m[6]=d("span",{class:"label"},"检验频率:",-1)),d("span",ns,L(E.details.frequency),1)])]),_:2},1024)]),_:2},1024),d("div",as,[m[7]||(m[7]=d("p",{class:"sub-title"},"关键检查点:",-1)),(S(!0),T(oe,null,ce(E.details.keyCheckpoints,(j,O)=>(S(),le(y,{key:O,class:"checkpoint-tag"},{default:r(()=>[b(L(j),1)]),_:2},1024))),128))]),d("div",ss,[m[8]||(m[8]=d("p",{class:"sub-title"},"预期效果:",-1)),d("ul",null,[(S(!0),T(oe,null,ce(E.details.expectedOutcomes,(j,O)=>(S(),T("li",{key:O},L(j),1))),128))])])]),d("div",os,[a(D,{type:"primary",onClick:j=>l("apply",E)},{default:r(()=>m[9]||(m[9]=[b(" 应用此策略 ")])),_:2,__:[9]},1032,["onClick"]),a(D,{type:"success",onClick:j=>l("customize",E)},{default:r(()=>m[10]||(m[10]=[b(" 自定义修改 ")])),_:2,__:[10]},1032,["onClick"]),a(D,{onClick:j=>l("explain",E)},{default:r(()=>m[11]||(m[11]=[b(" 解释推荐 ")])),_:2,__:[11]},1032,["onClick"])])])]),_:2},1032,["label"]))),128))]),_:1})]),d("div",is,[a(D,{type:"primary",onClick:m[0]||(m[0]=E=>c("exportRecommendations"))},{default:r(()=>m[12]||(m[12]=[b(" 导出所有推荐 ")])),_:1,__:[12]}),a(D,{onClick:m[1]||(m[1]=E=>c("historyRecommendations"))},{default:r(()=>m[13]||(m[13]=[b(" 查看历史推荐 ")])),_:1,__:[13]})])],64)):(S(),le(P,{key:1,description:"暂无推荐策略数据"}))])}}},rs=ve(ls,[["__scopeId","data-v-a42fd9c3"]]);class cs extends Error{constructor(e,n){super(e),this.name="AIEngineError",this.command=n,this.timestamp=new Date}}class Be{static get(e){const n=this.cache.get(e);return n?Date.now()-n.timestamp>this.TTL?(this.cache.delete(e),null):n.data:null}static set(e,n){this.cache.set(e,{data:n,timestamp:Date.now()})}static generateKey(e,n){return`${e}:${JSON.stringify(n)}`}static async computeWithCache(e,n,t){const o=this.generateKey(e,n),s=this.get(o);if(s)return console.log(`[AICache] Hit for ${e}`),s;console.log(`[AICache] Miss for ${e}`);const l=await t(n);return this.set(o,l),l}}fe(Be,"cache",new Map),fe(Be,"TTL",30*60*1e3);class ue{static async execute(e,n){const t=Date.now();this.metrics.requestCount++;try{this.preProcess(e,n);const o=await this.processCommand(e,n),s=this.postProcess(o);return this.metrics.successCount++,this.metrics.lastResponseTime=Date.now()-t,this.metrics.totalResponseTime+=this.metrics.lastResponseTime,s}catch(o){throw this.metrics.errorCount++,console.error(`AI引擎执行错误: ${o.message}`),new cs(o.message,e)}}static preProcess(e,n){if(!this.getCommandMap()[e])throw new Error(`未知AI命令: ${e}`);if(!n)throw new Error(`命令${e}缺少必要参数`);console.log(`[AIEngine] 执行命令: ${e}`,n)}static async processCommand(e,n){const o=this.getCommandMap()[e];return Be.computeWithCache(e,n,async()=>o(n))}static postProcess(e){return{...e,meta:{timestamp:new Date,version:"1.0",engine:"IQE-AI-Engine"}}}static getCommandMap(){return{predict:this.runPrediction,detect:this.runAnomalyDetection,recommend:this.generateRecommendations,analyze:this.performAnalysis,explain:this.explainDecision}}static registerModel(e,n){this.models.set(e,n),console.log(`[AIEngine] 注册模型: ${e}`)}static getModel(e){const n=this.models.get(e);if(!n)throw new Error(`模型不存在: ${e}`);return n}static getMetrics(){const{requestCount:e,successCount:n,errorCount:t,totalResponseTime:o}=this.metrics;return{requestCount:e,successCount:n,errorCount:t,successRate:e>0?n/e*100:0,averageResponseTime:n>0?o/n:0,lastResponseTime:this.metrics.lastResponseTime}}static async runPrediction(e){const{type:n,data:t,options:o={}}=e;switch(n){case"quality":return this.predictQuality(t,o);case"defect":return this.predictDefects(t,o);case"trend":return this.predictTrend(t,o);default:throw new Error(`不支持的预测类型: ${n}`)}}static async runAnomalyDetection(e){const{data:n,algorithm:t="zscore",sensitivity:o=5,context:s={}}=e;if(!n||!Array.isArray(n)||n.length===0)throw new Error("异常检测需要有效的数据数组");let l=[];switch(t){case"zscore":l=this.detectAnomaliesWithZScore(n,o);break;case"iqr":l=this.detectAnomaliesWithIQR(n,o);break;case"isolation_forest":l=this.detectAnomaliesWithIsolationForest(n,o);break;default:throw new Error(`不支持的异常检测算法: ${t}`)}return this.enhanceAnomalies(l,s)}static async generateRecommendations(e){const{materialCode:n,context:t={},goal:o="balance"}=e;if(!n)throw new Error("生成推荐需要有效的物料编码");const s=await this.getMaterialData(n);let l=[];switch(o){case"quality":l=this.generateQualityRecommendations(s,t);break;case"cost":l=this.generateCostRecommendations(s,t);break;case"balance":l=this.generateBalancedRecommendations(s,t);break;case"risk":l=this.generateRiskRecommendations(s,t);break;default:throw new Error(`不支持的推荐目标: ${o}`)}return{materialCode:n,recommendations:l,context:{...t,generatedAt:new Date}}}static async performAnalysis(e){const{type:n,data:t,options:o={}}=e;switch(n){case"risk":return this.analyzeRisk(t,o);case"correlation":return this.analyzeCorrelation(t,o);case"impact":return this.analyzeImpact(t,o);default:throw new Error(`不支持的分析类型: ${n}`)}}static async explainDecision(e){const{decisionId:n,context:t={}}=e;if(!n)throw new Error("解释决策需要有效的决策ID");const o=await this.getDecisionData(n);return{decisionId:n,explanation:this.generateExplanation(o,t),factorImportance:this.calculateFactorImportance(o),reasoningChain:this.buildReasoningChain(o),context:{...t,explainedAt:new Date}}}static async getMaterialData(e){return{code:e,name:`物料${e}`}}static async getDecisionData(e){return{id:e,factors:[]}}static detectAnomaliesWithZScore(e,n){return[]}static detectAnomaliesWithIQR(e,n){return[]}static detectAnomaliesWithIsolationForest(e,n){return[]}static enhanceAnomalies(e,n){return e}static generateQualityRecommendations(e,n){return[]}static generateCostRecommendations(e,n){return[]}static generateBalancedRecommendations(e,n){return[]}static generateRiskRecommendations(e,n){return[]}static analyzeRisk(e,n){return{}}static analyzeCorrelation(e,n){return{}}static analyzeImpact(e,n){return{}}static generateExplanation(e,n){return""}static calculateFactorImportance(e){return[]}static buildReasoningChain(e){return[]}static predictQuality(e,n){return{}}static predictDefects(e,n){return{}}static predictTrend(e,n){return{}}}fe(ue,"models",new Map),fe(ue,"metrics",{requestCount:0,successCount:0,errorCount:0,totalResponseTime:0,lastResponseTime:0});class de extends Error{constructor(e,n){super(e),this.name="ModelRegistryError",this.modelName=n,this.timestamp=new Date}}class Ve{constructor(e={}){this.name=e.name||"unknown",this.version=e.version||"1.0.0",this.type=e.type||"unknown",this.description=e.description||"",this.author=e.author||"",this.createdAt=e.createdAt||new Date,this.updatedAt=e.updatedAt||new Date,this.tags=e.tags||[],this.parameters=e.parameters||{},this.metrics=e.metrics||{},this.dependencies=e.dependencies||[]}}class ye{static registerModel(e,n,t={}){try{if(!e||typeof e!="string")throw new Error("模型名称必须是非空字符串");if(!n)throw new Error("模型不能为空");const o=new Ve({name:e,...t,updatedAt:new Date});return this.models.set(e,n),this.metadata.set(e,o),t.isDefault&&t.type&&this.defaultModels.set(t.type,e),this.notifyListeners("register",e,o),console.log(`[ModelRegistry] 注册模型: ${e} (${o.version})`),!0}catch(o){throw new de(`注册模型失败: ${o.message}`,e)}}static getModel(e){try{if(!this.models.has(e))throw new Error(`模型不存在: ${e}`);return this.models.get(e)}catch(n){throw new de(`获取模型失败: ${n.message}`,e)}}static getModelMetadata(e){try{if(!this.metadata.has(e))throw new Error(`模型元数据不存在: ${e}`);return this.metadata.get(e)}catch(n){throw new de(`获取模型元数据失败: ${n.message}`,e)}}static getDefaultModel(e){try{if(!this.defaultModels.has(e))throw new Error(`没有类型为 ${e} 的默认模型`);const n=this.defaultModels.get(e);return this.getModel(n)}catch(n){throw new de(`获取默认模型失败: ${n.message}`,e)}}static setDefaultModel(e,n){try{if(!this.models.has(n))throw new Error(`模型不存在: ${n}`);this.defaultModels.set(e,n);const t=this.metadata.get(n);return t.isDefault=!0,this.metadata.set(n,t),this.notifyListeners("setDefault",n,{type:e}),console.log(`[ModelRegistry] 设置默认模型: ${n} (类型: ${e})`),!0}catch(t){throw new de(`设置默认模型失败: ${t.message}`,n)}}static updateModel(e,n,t={}){try{if(!this.models.has(e))throw new Error(`模型不存在: ${e}`);const o=this.metadata.get(e),s=new Ve({...o,...t,updatedAt:new Date});return this.models.set(e,n),this.metadata.set(e,s),this.notifyListeners("update",e,s),console.log(`[ModelRegistry] 更新模型: ${e} (${s.version})`),!0}catch(o){throw new de(`更新模型失败: ${o.message}`,e)}}static deleteModel(e){try{if(!this.models.has(e))throw new Error(`模型不存在: ${e}`);const n=this.metadata.get(e);return n.isDefault&&n.type&&this.defaultModels.delete(n.type),this.models.delete(e),this.metadata.delete(e),this.notifyListeners("delete",e,n),console.log(`[ModelRegistry] 删除模型: ${e}`),!0}catch(n){throw new de(`删除模型失败: ${n.message}`,e)}}static listModels(e={}){try{const{type:n,tag:t,author:o,version:s}=e,l=[];return this.metadata.forEach((c,i)=>{let m=!0;n&&c.type!==n&&(m=!1),t&&!c.tags.includes(t)&&(m=!1),o&&c.author!==o&&(m=!1),s&&c.version!==s&&(m=!1),m&&l.push({name:i,metadata:c})}),l}catch(n){throw new de(`列出模型失败: ${n.message}`)}}static listModelTypes(){try{const e=new Set;return this.metadata.forEach(n=>{n.type&&e.add(n.type)}),Array.from(e)}catch(e){throw new de(`列出模型类型失败: ${e.message}`)}}static addListener(e){return typeof e=="function"?(this.listeners.push(e),!0):!1}static removeListener(e){const n=this.listeners.indexOf(e);return n!==-1?(this.listeners.splice(n,1),!0):!1}static notifyListeners(e,n,t){this.listeners.forEach(o=>{try{o(e,n,t)}catch(s){console.error(`[ModelRegistry] 监听器错误: ${s.message}`)}})}static hasModel(e){return this.models.has(e)}static getModelCount(){return this.models.size}static getModelVersion(e){if(!this.metadata.has(e))throw new de(`模型元数据不存在: ${e}`,e);return this.metadata.get(e).version}static getModelMetrics(e){if(!this.metadata.has(e))throw new de(`模型元数据不存在: ${e}`,e);return this.metadata.get(e).metrics}static updateModelMetrics(e,n){try{if(!this.metadata.has(e))throw new Error(`模型元数据不存在: ${e}`);const t=this.metadata.get(e);return t.metrics={...t.metrics,...n,updatedAt:new Date},this.metadata.set(e,t),this.notifyListeners("updateMetrics",e,t.metrics),!0}catch(t){throw new de(`更新模型指标失败: ${t.message}`,e)}}static registerSimpleModel(e,n,t={}){const o={predict:n,type:"function"};return this.registerModel(e,o,{type:"function",...t})}static registerModels(e){const n=[];for(const{name:t,model:o,metadata:s}of e)try{const l=this.registerModel(t,o,s);n.push({name:t,success:l})}catch(l){n.push({name:t,success:!1,error:l.message})}return n}static exportRegistry(){const e={models:{},defaultModels:{}};return this.metadata.forEach((n,t)=>{e.models[t]=n}),this.defaultModels.forEach((n,t)=>{e.defaultModels[t]=n}),e}static importRegistry(e,n=!1){try{const{models:t,defaultModels:o}=e;for(const[s,l]of Object.entries(t))n&&this.models.has(s)?this.metadata.set(s,new Ve(l)):this.models.has(s)||(this.metadata.set(s,new Ve(l)),this.models.set(s,{type:"placeholder",name:s}));for(const[s,l]of Object.entries(o))this.models.has(l)&&this.defaultModels.set(s,l);return!0}catch(t){throw new de(`导入注册表失败: ${t.message}`)}}}fe(ye,"models",new Map),fe(ye,"metadata",new Map),fe(ye,"defaultModels",new Map),fe(ye,"listeners",[]);class ze extends Error{constructor(e,n){super(e),this.name="DataPreprocessorError",this.operation=n,this.timestamp=new Date}}class De{static cleanData(e,n={}){try{const{removeNulls:t=!0,removeDuplicates:o=!0,removeOutliers:s=!1,outlierMethod:l="zscore",outlierThreshold:c=3}=n;if(!e||!Array.isArray(e))throw new Error("输入数据必须是数组");let i=[...e];return t&&(i=this.removeNullValues(i)),o&&(i=this.removeDuplicateValues(i)),s&&(i=this.removeOutliers(i,l,c)),i}catch(t){throw new ze(`数据清洗失败: ${t.message}`,"cleanData")}}static transformData(e,n=[]){try{if(!e||!Array.isArray(e))throw new Error("输入数据必须是数组");if(!n||!Array.isArray(n)||n.length===0)return e;let t=[...e];for(const o of n){const{type:s,field:l,params:c={}}=o;switch(s){case"normalize":t=this.normalizeField(t,l,c);break;case"standardize":t=this.standardizeField(t,l,c);break;case"log":t=this.logTransform(t,l,c);break;case"onehot":t=this.oneHotEncode(t,l,c);break;case"discretize":t=this.discretize(t,l,c);break;case"custom":c.transformFn&&typeof c.transformFn=="function"&&(t=c.transformFn(t));break;default:console.warn(`未知的转换类型: ${s}`)}}return t}catch(t){throw new ze(`数据转换失败: ${t.message}`,"transformData")}}static engineerFeatures(e,n=[]){try{if(!e||!Array.isArray(e))throw new Error("输入数据必须是数组");if(!n||!Array.isArray(n)||n.length===0)return e;let t=[...e];for(const o of n){const{name:s,type:l,fields:c,params:i={}}=o;switch(l){case"ratio":t=this.createRatioFeature(t,s,c,i);break;case"aggregate":t=this.createAggregateFeature(t,s,c,i);break;case"window":t=this.createWindowFeature(t,s,c,i);break;case"polynomial":t=this.createPolynomialFeature(t,s,c,i);break;case"interaction":t=this.createInteractionFeature(t,s,c,i);break;case"custom":i.featureFn&&typeof i.featureFn=="function"&&(t=i.featureFn(t,s));break;default:console.warn(`未知的特征工程类型: ${l}`)}}return t}catch(t){throw new ze(`特征工程失败: ${t.message}`,"engineerFeatures")}}static splitData(e,n={}){try{const{testSize:t=.2,validationSize:o=0,stratifyField:s=null,shuffle:l=!0,seed:c=42}=n;if(!e||!Array.isArray(e)||e.length===0)throw new Error("输入数据必须是非空数组");if(t<0||t>1||o<0||o>1||t+o>=1)throw new Error("测试集和验证集的比例必须在0-1之间，且总和小于1");let i=[...e];if(l&&(i=this.shuffleArray(i,c)),s)return this.stratifiedSplit(i,s,t,o);const m=i.length,v=Math.round(m*t),y=Math.round(m*o),f=m-v-y,w=i.slice(0,f),p=i.slice(f,f+v),D=y>0?i.slice(f+v):[];return{train:w,test:p,validation:D}}catch(t){throw new ze(`数据拆分失败: ${t.message}`,"splitData")}}static sampleData(e,n={}){try{const{sampleSize:t,sampleRatio:o,replacement:s=!1,stratifyField:l=null,seed:c=42}=n;if(!e||!Array.isArray(e)||e.length===0)throw new Error("输入数据必须是非空数组");let i;if(t)i=t;else if(o)i=Math.round(e.length*o);else throw new Error("必须指定sampleSize或sampleRatio");if(i<=0||!s&&i>e.length)throw new Error("采样大小必须大于0且不大于数据长度（除非使用有放回采样）");return l?this.stratifiedSample(e,l,i,s,c):this.randomSample(e,i,s,c)}catch(t){throw new ze(`数据采样失败: ${t.message}`,"sampleData")}}static removeNullValues(e){return typeof e[0]=="object"?e.filter(n=>Object.values(n).every(t=>t!=null&&t!=="")):e.filter(n=>n!=null&&n!=="")}static removeDuplicateValues(e){if(typeof e[0]=="object"){const n=new Map;return e.forEach(t=>{const o=JSON.stringify(t);n.set(o,t)}),Array.from(n.values())}else return[...new Set(e)]}static removeOutliers(e,n,t){if(typeof e[0]!="number")return console.warn("离群值检测只支持数值数组"),e;switch(n){case"zscore":return this.removeOutliersZScore(e,t);case"iqr":return this.removeOutliersIQR(e,t);default:return console.warn(`未知的离群值检测方法: ${n}`),e}}static removeOutliersZScore(e,n){const t=e.reduce((s,l)=>s+l,0)/e.length,o=Math.sqrt(e.reduce((s,l)=>s+Math.pow(l-t,2),0)/e.length);return e.filter(s=>Math.abs((s-t)/o)<=n)}static removeOutliersIQR(e,n){const t=[...e].sort((y,f)=>y-f),o=Math.floor(t.length*.25),s=Math.floor(t.length*.75),l=t[o],c=t[s],i=c-l,m=l-n*i,v=c+n*i;return e.filter(y=>y>=m&&y<=v)}static normalizeField(e,n,t={}){const{min:o,max:s,newMin:l=0,newMax:c=1}=t;let i=o,m=s;if(i===void 0||m===void 0){const v=e.map(y=>y[n]);i=Math.min(...v),m=Math.max(...v)}return m===i?e.map(v=>{const y={...v};return y[n]=l,y}):e.map(v=>{const y={...v},f=v[n];return y[n]=l+(f-i)*(c-l)/(m-i),y})}static standardizeField(e,n,t={}){const{mean:o,stdDev:s}=t;let l=o,c=s;if(l===void 0||c===void 0){const i=e.map(m=>m[n]);l=i.reduce((m,v)=>m+v,0)/i.length,c=Math.sqrt(i.reduce((m,v)=>m+Math.pow(v-l,2),0)/i.length)}return c===0?e.map(i=>{const m={...i};return m[n]=0,m}):e.map(i=>{const m={...i};return m[n]=(i[n]-l)/c,m})}static logTransform(e,n,t={}){const{base:o=Math.E,offset:s=1}=t;return e.map(l=>{const c={...l},m=l[n]+s;return m<=0?c[n]=0:c[n]=Math.log(m)/Math.log(o),c})}static oneHotEncode(e,n,t={}){const{prefix:o=n}=t,s=[...new Set(e.map(l=>l[n]))];return e.map(l=>{const c={...l};return s.forEach(i=>{const m=`${o}_${i}`;c[m]=l[n]===i?1:0}),c})}static discretize(e,n,t={}){const{bins:o=5,labels:s=null,strategy:l="equal_width"}=t,c=e.map(v=>v[n]);let i;if(l==="equal_width")i=this.calculateEqualWidthBins(c,o);else if(l==="equal_frequency")i=this.calculateEqualFrequencyBins(c,o);else throw new Error(`未知的离散化策略: ${l}`);const m=s||Array.from({length:o},(v,y)=>y);return e.map(v=>{const y={...v},f=v[n];let w=0;for(let p=0;p<i.length-1;p++)if(f>=i[p]&&f<i[p+1]){w=p;break}return f===i[i.length-1]&&(w=o-1),y[`${n}_bin`]=m[w],y})}static calculateEqualWidthBins(e,n){const t=Math.min(...e),s=(Math.max(...e)-t)/n;return Array.from({length:n+1},(l,c)=>t+c*s)}static calculateEqualFrequencyBins(e,n){const t=[...e].sort((s,l)=>s-l),o=[t[0]];for(let s=1;s<=n;s++){const l=Math.floor(s*t.length/n)-1;o.push(t[l])}return o[n]=t[t.length-1],o}static createRatioFeature(e,n,t,o={}){const{epsilon:s=1e-10}=o;if(t.length!==2)throw new Error("比率特征需要两个字段");const[l,c]=t;return e.map(i=>{const m={...i},v=i[l],y=i[c];return m[n]=v/(y+s),m})}static createAggregateFeature(e,n,t,o={}){const{operation:s="sum"}=o;return e.map(l=>{const c={...l},i=t.map(m=>l[m]);switch(s){case"sum":c[n]=i.reduce((m,v)=>m+v,0);break;case"avg":c[n]=i.reduce((m,v)=>m+v,0)/i.length;break;case"min":c[n]=Math.min(...i);break;case"max":c[n]=Math.max(...i);break;case"product":c[n]=i.reduce((m,v)=>m*v,1);break;default:throw new Error(`未知的聚合操作: ${s}`)}return c})}static createWindowFeature(e,n,t,o={}){const{windowSize:s=3,operation:l="avg",groupBy:c=null,sortBy:i=null}=o;if(t.length!==1)throw new Error("窗口特征目前只支持一个字段");const m=t[0];if(c&&i){const v=new Map;e.forEach(f=>{const w=f[c];v.has(w)||v.set(w,[]),v.get(w).push(f)});const y=[];return v.forEach(f=>{const w=[...f].sort((D,I)=>D[i]-I[i]),p=this.applyWindowOperation(w,m,n,s,l);y.push(...p)}),y}return this.applyWindowOperation(e,m,n,s,l)}static applyWindowOperation(e,n,t,o,s){return e.map((l,c)=>{const i={...l},m=Math.max(0,c-o+1),y=e.slice(m,c+1).map(f=>f[n]);switch(s){case"avg":i[t]=y.reduce((p,D)=>p+D,0)/y.length;break;case"sum":i[t]=y.reduce((p,D)=>p+D,0);break;case"min":i[t]=Math.min(...y);break;case"max":i[t]=Math.max(...y);break;case"std":const f=y.reduce((p,D)=>p+D,0)/y.length,w=y.reduce((p,D)=>p+Math.pow(D-f,2),0)/y.length;i[t]=Math.sqrt(w);break;default:throw new Error(`未知的窗口操作: ${s}`)}return i})}static createPolynomialFeature(e,n,t,o={}){const{degree:s=2}=o;if(t.length!==1)throw new Error("多项式特征目前只支持一个字段");const l=t[0];return e.map(c=>{const i={...c},m=c[l];return i[n]=Math.pow(m,s),i})}static createInteractionFeature(e,n,t,o={}){if(t.length<2)throw new Error("交互特征需要至少两个字段");return e.map(s=>{const l={...s};return l[n]=t.reduce((c,i)=>c*s[i],1),l})}static shuffleArray(e,n){const t=[...e],o=s=>(n=(n*9301+49297)%233280,n/233280*s);for(let s=t.length-1;s>0;s--){const l=Math.floor(o(s+1));[t[s],t[l]]=[t[l],t[s]]}return t}static stratifiedSample(e,n,t,o,s){const l=new Map;e.forEach(m=>{const v=m[n];l.has(v)||l.set(v,[]),l.get(v).push(m)});const c=e.length,i=[];return l.forEach((m,v)=>{const y=m.length/c,f=Math.round(t*y),w=this.randomSample(m,f,o,s);i.push(...w)}),i}static stratifiedSplit(e,n,t,o){const s=new Map;e.forEach(m=>{const v=m[n];s.has(v)||s.set(v,[]),s.get(v).push(m)});const l=[],c=[],i=[];return s.forEach((m,v)=>{const y=m.length,f=Math.round(y*t),w=Math.round(y*o),p=y-f-w;l.push(...m.slice(0,p)),c.push(...m.slice(p,p+f)),i.push(...m.slice(p+f))}),{train:l,test:c,validation:i}}static randomSample(e,n,t,o){if(!t&&n>e.length)throw new Error("无放回采样的大小不能超过数据长度");const s=c=>(o=(o*9301+49297)%233280,o/233280*c),l=[];if(t)for(let c=0;c<n;c++){const i=Math.floor(s(e.length));l.push(e[i])}else{const c=Array.from({length:e.length},(i,m)=>m);for(let i=0;i<n;i++){const m=Math.floor(s(c.length)),v=c[m];c.splice(m,1),l.push(e[v])}}return l}}const Ue={LOW:{value:"low",label:"低风险",color:"#67C23A"},MEDIUM:{value:"medium",label:"中等风险",color:"#E6A23C"},HIGH:{value:"high",label:"高风险",color:"#F56C6C"},CRITICAL:{value:"critical",label:"严重风险",color:"#8B0000"}};class Le{static async assessRisk(e,n={}){try{const t=De.cleanData(e,{removeNulls:!0,removeDuplicates:!0}),o=await ue.execute("analyze",{type:"risk",data:t,options:n});return this.enhanceRiskAssessment(o,e)}catch(t){throw console.error("物料风险评估失败:",t),t}}static enhanceRiskAssessment(e,n){const t={...e},o=t.riskScore||0;return o>=80?t.riskLevel=Ue.CRITICAL:o>=60?t.riskLevel=Ue.HIGH:o>=40?t.riskLevel=Ue.MEDIUM:t.riskLevel=Ue.LOW,t.recommendedStrategy=this.generateRecommendedStrategy(t,n),t.historicalComparison=this.compareWithHistory(t,n),t}static generateRecommendedStrategy(e,n){const{riskLevel:t}=e;switch(t.value){case"critical":return{inspectionLevel:"全检",sampleSize:"100%",frequency:"每批次",additionalTests:["成分分析","物理性能","可靠性测试","加速老化测试"],priority:"最高",description:"该物料存在严重风险，建议进行全检并增加额外测试项目。"};case"high":return{inspectionLevel:"加严抽检",sampleSize:"AQL 0.65",frequency:"每批次",additionalTests:["成分分析","物理性能"],priority:"高",description:"该物料存在高风险，建议加严抽检并关注关键性能参数。"};case"medium":return{inspectionLevel:"正常抽检",sampleSize:"AQL 1.0",frequency:"每批次",additionalTests:[],priority:"中",description:"该物料风险适中，建议按正常抽检标准执行。"};case"low":return{inspectionLevel:"简化检验",sampleSize:"AQL 2.5",frequency:"抽批次",additionalTests:[],priority:"低",description:"该物料风险较低，可适当简化检验流程。"};default:return{inspectionLevel:"正常抽检",sampleSize:"AQL 1.0",frequency:"每批次",additionalTests:[],priority:"中",description:"按标准检验流程执行。"}}}static compareWithHistory(e,n){return{trendDirection:"up",changePercentage:15,previousScore:e.riskScore*.85,historicalAverage:e.riskScore*.9,significantChange:!0}}static async predictDefects(e,n={}){try{const t=De.cleanData(e,{removeNulls:!0,removeDuplicates:!0}),o=De.engineerFeatures(t,[{name:"process_stability",type:"ratio",fields:["std_deviation","mean_value"]},{name:"quality_trend",type:"window",fields:["defect_rate"],params:{windowSize:5,operation:"avg"}}]);return await ue.execute("predict",{type:"defect",data:o,options:n})}catch(t){throw console.error("物料缺陷预测失败:",t),t}}static async predictQualityTrend(e,n,t={}){try{const o=De.cleanData(e,{removeNulls:!0,removeDuplicates:!0});return await ue.execute("predict",{type:"trend",data:o,timeRange:n,options:t})}catch(o){throw console.error("物料质量趋势预测失败:",o),o}}static async analyzeBatchCorrelation(e,n={}){try{return await ue.execute("analyze",{type:"correlation",data:e,options:n})}catch(t){throw console.error("物料批次相关性分析失败:",t),t}}static async recommendInspectionStrategy(e,n={}){try{return await ue.execute("recommend",{materialCode:e,context:n,goal:"quality"})}catch(t){throw console.error("物料检验策略推荐失败:",t),t}}static async detectAnomalies(e,n={}){try{const{sensitivity:t=3,algorithm:o="zscore"}=n,s=De.cleanData(e,{removeNulls:!0,removeDuplicates:!0});return await ue.execute("detect",{data:s,algorithm:o,sensitivity:t,context:{materialData:e}})}catch(t){throw console.error("物料异常检测失败:",t),t}}static async assessSupplierRisk(e,n,t={}){try{const o=De.cleanData(e,{removeNulls:!0,removeDuplicates:!0}),s=De.cleanData(n,{removeNulls:!0,removeDuplicates:!0}),l=o.map(c=>{const i=s.filter(m=>m.supplierId===c.id);return{...c,materials:i}});return await ue.execute("analyze",{type:"risk",data:l,options:{...t,analysisType:"supplier"}})}catch(o){throw console.error("物料供应商风险评估失败:",o),o}}static async explainDecision(e,n={}){try{return await ue.execute("explain",{decisionId:e,context:n})}catch(t){throw console.error("物料决策解释失败:",t),t}}static initDefaultModels(){ye.registerSimpleModel("default-risk-assessment",this.defaultRiskAssessmentModel,{type:"risk-assessment",isDefault:!0,version:"1.0.0",description:"默认物料风险评估模型",author:"IQE-AI-Team"}),ye.registerSimpleModel("default-defect-prediction",this.defaultDefectPredictionModel,{type:"defect-prediction",isDefault:!0,version:"1.0.0",description:"默认物料缺陷预测模型",author:"IQE-AI-Team"}),ye.registerSimpleModel("default-trend-prediction",this.defaultTrendPredictionModel,{type:"trend-prediction",isDefault:!0,version:"1.0.0",description:"默认物料趋势预测模型",author:"IQE-AI-Team"}),console.log("[MaterialAIService] 默认模型初始化完成")}static defaultRiskAssessmentModel(e){const n=e.map(i=>i.defectRate||0),t=n.length>0?n.reduce((i,m)=>i+m,0)/n.length:0,s=1-new Set(e.map(i=>i.supplierId)).size/Math.max(e.length,1),l=this.calculateBatchConsistency(e);return{riskScore:Math.min(100,Math.max(0,t*100+(1-s)*30+(1-l)*40)),factors:{avgDefectRate:t,supplierStability:s,batchConsistency:l},details:{defectRateContribution:t*100,supplierStabilityContribution:(1-s)*30,batchConsistencyContribution:(1-l)*40}}}static defaultDefectPredictionModel(e){const n=e.map(c=>c.defectRate||0),t=n.length>0?n.reduce((c,i)=>c+i,0)/n.length:0,o=n.length>=3?(n[n.length-1]-n[0])/n.length:0;return{predictedDefectRate:Math.max(0,Math.min(1,t+o*2)),trend:o,defectTypes:[{type:"尺寸偏差",probability:.4},{type:"表面缺陷",probability:.3},{type:"材质不符",probability:.2},{type:"功能异常",probability:.1}],confidence:.75,predictionHorizon:"30天"}}static defaultTrendPredictionModel(e,n){const t=e.filter(v=>v.timestamp&&v.value!==void 0).sort((v,y)=>v.timestamp-y.timestamp);if(t.length<2)return{trend:"stable",prediction:[],confidence:0};const{slope:o,intercept:s}=this.calculateLinearRegression(t.map((v,y)=>y),t.map(v=>v.value));let l;o>.05?l="up":o<-.05?l="down":l="stable";const c=t[t.length-1].timestamp,i=(t[t.length-1].timestamp-t[0].timestamp)/Math.max(1,t.length-1),m=Array.from({length:5},(v,y)=>{const f=t.length+y,w=s+o*f;return{timestamp:c+(y+1)*i,value:w,confidence:Math.max(0,1-y*.1)}});return{trend:l,prediction:m,confidence:.8,model:{type:"linear",slope:o,intercept:s}}}static calculateBatchConsistency(e){if(e.length<2)return 1;const n=new Map;if(e.forEach(l=>{l.batchId&&(n.has(l.batchId)||n.set(l.batchId,[]),n.get(l.batchId).push(l))}),n.size<2)return 1;const t=Array.from(n.values()).map(l=>{const c=l.map(i=>i.value||0);return c.reduce((i,m)=>i+m,0)/c.length}),o=t.reduce((l,c)=>l+c,0)/t.length,s=t.reduce((l,c)=>l+Math.pow(c-o,2),0)/t.length;return Math.max(0,Math.min(1,1-Math.sqrt(s)/o))}static calculateLinearRegression(e,n){const t=e.length,o=e.reduce((v,y)=>v+y,0)/t,s=n.reduce((v,y)=>v+y,0)/t;let l=0,c=0;for(let v=0;v<t;v++)l+=(e[v]-o)*(n[v]-s),c+=Math.pow(e[v]-o,2);const i=c!==0?l/c:0,m=s-i*o;return{slope:i,intercept:m}}}function _e(u,e=800){return new Promise(n=>{setTimeout(()=>{n(u)},e)})}async function Ge(u){return _e({materialCode:u,materialName:u==="37301062"?"电池盖":u==="38501375"?"保护膜":"未知物料",supplierCode:u==="37301062"?"SUP001":u==="38501375"?"SUP002":"UNKNOWN",supplierName:u==="37301062"?"金盾":u==="38501375"?"易湛":"未知供应商",qualityHistory:[{date:"2025-01-15",defectRate:2.5,sampleSize:120,majorDefects:2,minorDefects:1},{date:"2025-02-15",defectRate:3.2,sampleSize:150,majorDefects:3,minorDefects:2},{date:"2025-03-15",defectRate:5.1,sampleSize:180,majorDefects:7,minorDefects:2},{date:"2025-04-15",defectRate:4.8,sampleSize:200,majorDefects:6,minorDefects:4},{date:"2025-05-15",defectRate:6.7,sampleSize:150,majorDefects:8,minorDefects:2}],mainDefectTypes:[{type:"外观",percentage:45},{type:"功能",percentage:25},{type:"尺寸",percentage:20},{type:"其他",percentage:10}],riskLevel:u==="37301062"?"medium":u==="38501375"?"high":"low",recommendations:[u==="37301062"?"增加开合次数测试至800次":"增加酒精耐磨测试强度","与供应商共同制定改进计划","临时增加来料抽检比例"]})}async function ds(u){const e=u==="SUP001",n=u==="SUP002";return _e({supplierCode:u,supplierName:e?"金盾":n?"易湛":"未知供应商",overallScore:e?78:n?65:85,qualityLevel:e?"B":n?"C":"A",performanceHistory:[{month:"2025-01",score:e?82:75},{month:"2025-02",score:e?79:72},{month:"2025-03",score:e?75:68},{month:"2025-04",score:e?77:64},{month:"2025-05",score:e?78:65}],categoryScores:{deliveryTime:e?85:78,qualityConsistency:e?75:62,responsiveness:e?80:70,costPerformance:e?82:75,innovation:e?70:60},recentIssues:e?[{date:"2025-05-26",issue:"电池盖耐久性不足",severity:"medium"},{date:"2025-04-28",issue:"按键卡顿",severity:"low"}]:n?[{date:"2025-05-25",issue:"保护膜酒精耐磨不合格",severity:"high"},{date:"2025-04-12",issue:"标签褪色",severity:"medium"}]:[],improvementAreas:e?["可靠性测试流程优化","模具维护计划改进"]:n?["材料选型全面评估","工艺稳定性提升","质量检验标准提高"]:["持续监控"]})}async function Ze(u,e=null){const n={materialCode:"37301062",materialName:"电池盖",testRecords:[{date:"2025-05-24",testType:"reliability",testName:"连续开合耐久性测试",standard:"500次无变形",result:"NG",actualValue:"100次后针变形",testLab:"南昌实验室",tester:"张工",remarks:"连续两批次出现相同问题"},{date:"2025-04-15",testType:"functional",testName:"卡扣强度测试",standard:"50N不脱落",result:"OK",actualValue:"67N",testLab:"深圳实验室",tester:"李工",remarks:"符合要求"}]},t={materialCode:"38501375",materialName:"保护膜",testRecords:[{date:"2025-05-26",testType:"chemical",testName:"酒精耐磨测试",standard:"500g×25次不掉漆",result:"NG",actualValue:"出现掉漆现象",testLab:"深圳实验室",tester:"王工",remarks:"批次#03,#04均不合格"},{date:"2025-04-20",testType:"adhesion",testName:"粘贴力测试",standard:"≥4.5N/25mm",result:"OK",actualValue:"4.8N/25mm",testLab:"南昌实验室",tester:"刘工",remarks:"符合要求"}]};let o={};return u==="37301062"?o=n:u==="38501375"?o=t:o={materialCode:u,materialName:"未知物料",testRecords:[]},e&&(o.testRecords=o.testRecords.filter(s=>s.testType===e)),_e(o)}async function Ke(u,e=null){const n={materialCode:u,materialName:u==="37301062"?"电池盖":u==="38501375"?"保护膜":"未知物料",usageRecords:[{date:"2025-05-26",lineId:"LINE001",lineName:"A区组装线",batchNumber:"B20250526001",quantity:5e3,defectRate:2.8,defectDetails:[{type:"安装不良",count:78,percentage:55.7},{type:"外观不良",count:32,percentage:22.9},{type:"功能不良",count:30,percentage:21.4}],reworkRate:1.5,reworkCost:4500,impactLevel:"medium"},{date:"2025-05-20",lineId:"LINE002",lineName:"B区组装线",batchNumber:"B20250520002",quantity:4500,defectRate:2.2,defectDetails:[{type:"安装不良",count:56,percentage:56.6},{type:"外观不良",count:24,percentage:24.2},{type:"功能不良",count:19,percentage:19.2}],reworkRate:1.2,reworkCost:3200,impactLevel:"low"}]};return e&&(n.usageRecords=n.usageRecords.filter(t=>t.lineId===e)),_e(n)}async function us(u){var n;const e={timestamp:new Date().toISOString(),materialCode:u.materialCode,materialName:u.materialName||"未知物料",currentStatus:{riskLevel:u.riskLevel||"medium",mainIssues:((n=u.mainDefectTypes)==null?void 0:n.map(t=>t.type))||["质量波动"],trendAnalysis:"近期质量呈下降趋势，需要重点关注"},suggestions:[{area:"来料检验",actions:["增加抽检比例至8%（标准2%）","针对历史问题点增加专项检测项目","使用图像识别技术进行外观自动检测"],priority:"high",expectedImpact:"可减少不良品进入生产线的概率约60%"},{area:"供应商管理",actions:["与供应商共同建立质量改进计划","增加供应商现场审核频率","要求提供更详细的出厂检验报告"],priority:"medium",expectedImpact:"从源头减少质量问题，长期效果显著"},{area:"设计优化",actions:["评估当前设计中的质量风险点","考虑替代材料或工艺","优化设计容差"],priority:"medium",expectedImpact:"从根本上解决设计相关的质量问题"}],implementationPlan:{shortTerm:"立即增加来料检验力度，与供应商沟通当前问题",midTerm:"实施供应商改进计划，评估替代供应商",longTerm:"优化设计和材料选型，建立预防性质量管理体系"}};return _e(e,1500)}async function ms(u,e=30){const n=new Date,t=[];let o,s,l;u==="37301062"?(o=6.5,s=-.08,l=.5):u==="38501375"?(o=8,s=.1,l=.8):(o=4,s=-.02,l=.3);for(let i=0;i<e;i++){const m=new Date(n);m.setDate(m.getDate()+i),u==="38501375"&&i>10&&(s=-.15);const v=(Math.random()-.5)*l;let y=o+s*i+v;y=Math.max(.5,y),t.push({date:m.toISOString().split("T")[0],defectRate:parseFloat(y.toFixed(2)),confidence:Math.max(30,95-i*1.5),factors:ps(u,i)})}const c={materialCode:u,materialName:u==="37301062"?"电池盖":u==="38501375"?"保护膜":"未知物料",predictionPeriod:`${e}天`,startDate:n.toISOString().split("T")[0],endDate:t[t.length-1].date,predictions:t,summary:{initialDefectRate:t[0].defectRate,finalDefectRate:t[t.length-1].defectRate,averageDefectRate:parseFloat((t.reduce((i,m)=>i+m.defectRate,0)/t.length).toFixed(2)),trend:t[0].defectRate>t[t.length-1].defectRate?"改善":"恶化",riskLevel:t[0].defectRate>5?"high":t[0].defectRate>3?"medium":"low",confidenceLevel:"medium"}};return _e(c,2e3)}function ps(u,e){const n=[];u==="37301062"?(e<10&&n.push({name:"模具调整",impact:"positive",weight:.4}),e>5&&e<20&&n.push({name:"工艺改进",impact:"positive",weight:.3}),e>15&&n.push({name:"原材料批次变化",impact:"negative",weight:.2})):u==="38501375"?(e<10&&n.push({name:"材料问题持续",impact:"negative",weight:.5}),e>10&&(n.push({name:"供应商更换材料",impact:"positive",weight:.6}),n.push({name:"工艺优化",impact:"positive",weight:.3}))):e%7===0&&n.push({name:"定期检查",impact:"positive",weight:.2});const t=["操作人员培训","设备维护","环境温度波动","检验标准调整","批次差异"];if(Math.random()>.7){const o=t[Math.floor(Math.random()*t.length)];n.push({name:o,impact:Math.random()>.5?"positive":"negative",weight:parseFloat((Math.random()*.3).toFixed(2))})}return n}async function fs(u){try{const[e,n,t]=await Promise.all([Ge(u),Ze(u),Ke(u)]),o={materialCode:u,materialName:e.materialName,timestamp:new Date().toISOString(),summary:{riskLevel:e.riskLevel,currentDefectRate:e.qualityHistory[e.qualityHistory.length-1].defectRate,trendAnalysis:hs(e.qualityHistory.map(s=>s.defectRate)),recentTestStatus:n.testRecords.length>0?n.testRecords[0].result:"N/A",productionImpact:t.usageRecords.length>0?t.usageRecords[0].impactLevel:"N/A"},qualityData:gs(e),labData:ys(n),productionData:vs(t),recommendations:_s(e,n,t)};return _e(o,1e3)}catch(e){throw console.error("集成分析失败:",e),e}}function hs(u){if(!u||u.length<2)return"数据不足";const e=u[0],o=(u[u.length-1]-e)/e*100;return o>10?"明显上升":o>5?"轻微上升":o<-10?"明显下降":o<-5?"轻微下降":"基本稳定"}function gs(u){return{riskLevel:u.riskLevel,qualityHistory:u.qualityHistory,mainDefectTypes:u.mainDefectTypes}}function ys(u){return{testRecords:u.testRecords.map(e=>({date:e.date,testName:e.testName,result:e.result,testLab:e.testLab}))}}function vs(u){return{usageRecords:u.usageRecords.map(e=>({date:e.date,lineName:e.lineName,defectRate:e.defectRate,impactLevel:e.impactLevel}))}}function _s(u,e,n){const t=[];u.riskLevel==="high"?t.push({area:"质量控制",action:"紧急增加来料抽检比例至100%",priority:"critical",rationale:"高风险物料，需要全检确保质量"}):u.riskLevel==="medium"&&t.push({area:"质量控制",action:"增加来料抽检比例至8%",priority:"high",rationale:"中等风险物料，需要加强检验"});const o=e.testRecords.filter(s=>s.result==="NG");return o.length>0&&t.push({area:"实验室检测",action:`增加${o[0].testName}的测试频率和强度`,priority:"high",rationale:"针对已发现的问题加强测试"}),n.usageRecords.length>0&&n.usageRecords.reduce((l,c)=>l+c.defectRate,0)/n.usageRecords.length>2.5&&t.push({area:"生产管控",action:"优化产线工艺参数和作业指导书",priority:"medium",rationale:"产线不良率较高，需要改进操作方法"}),t.push({area:"供应商管理",action:"与供应商共同制定质量改进计划",priority:u.riskLevel==="high"?"high":"medium",rationale:"从源头控制质量问题"}),t}async function ws(u){const{type:e,algorithm:n,sensitivity:t,dataSources:o,startDate:s,endDate:l}=u,c=ks(s,l),i=$s(c.length,e),m=Ds(i,n,t/10),v=Cs(m),y=m.map(I=>{const z=Math.random()>.7?"critical":Math.random()>.5?"major":"minor",P=z==="critical"?85+Math.random()*15:z==="major"?60+Math.random()*25:30+Math.random()*30;return{id:`anomaly-${Date.now()}-${I}`,date:c[I],type:z,severity:z==="critical"?"严重":z==="major"?"中等":"轻微",severityScore:Math.round(P),confidence:Math.round(70+Math.random()*25),description:Ms(e,n,i[I],o)}}),f=y.filter(I=>I.type==="critical").length,w=y.filter(I=>I.type==="major").length,p=y.filter(I=>I.type==="minor").length;let D="";return f>0&&(D+=`检测到${f}个严重异常，需要立即处理。`),w>0&&(D+=`${w}个中等异常需要关注。`),p>0&&(D+=`${p}个轻微异常建议监控。`),y.length===0&&(D="未检测到异常，质量状态良好。"),_e({timeline:c,values:i,anomalyIndices:m,anomalyRanges:v,anomalies:y,criticalCount:f,majorCount:w,minorCount:p,summary:D})}async function bs(u){const e={actionSteps:[{title:"立即通知相关人员",description:"将异常情况通知质量工程师和生产主管"},{title:"暂停相关批次",description:"暂停使用可能受影响的物料批次，进行隔离"},{title:"增加抽检比例",description:"对同供应商其他批次增加抽检频率和比例"},{title:"启动根因分析",description:"组织质量分析会议，确定问题根因"}],impactScore:3.5+Math.random()*1.5,impactDescription:"此异常可能导致产品功能不稳定，影响用户体验，建议在生产前解决。如继续使用有问题批次，可能导致返修率上升2-5个百分点。"};return _e(e)}function ks(u,e){const n=new Date(u),t=new Date(e),o=[],s=new Date(n);for(;s<=t;)o.push(s.toISOString().split("T")[0]),s.setDate(s.getDate()+1);return o}function $s(u,e){const n=[];for(let s=0;s<u;s++){let l=100+(Math.random()-.5)*10;l+=s*.2,l+=5*Math.sin(s/7*Math.PI),n.push(Math.round(l*10)/10)}if(e==="statistical")[Math.floor(u*.2),Math.floor(u*.5),Math.floor(u*.8)].forEach(l=>{n[l]=100+10*3*(Math.random()>.5?1:-1)});else if(e==="pattern"){const s=Math.floor(u*.6);for(let l=0;l<5;l++)s+l<u&&(n[s+l]=90-l*2)}else if(e==="contextual"){const s=Math.floor(u*.4);for(let l=0;l<3;l++)s+l<u&&Math.sin((s+l)/7*Math.PI)>.5&&(n[s+l]=100-10*2)}else if(e==="collective"){const s=Math.floor(u*.7),l=10*2;for(let c=s;c<u;c++)n[c]+=l}return n}function Ds(u,e,n){const t=[];if(e==="zscore"){const o=u.reduce((l,c)=>l+c,0)/u.length,s=Math.sqrt(u.reduce((l,c)=>l+Math.pow(c-o,2),0)/u.length);u.forEach((l,c)=>{Math.abs((l-o)/s)>2+n*3&&t.push(c)})}else if(e==="iqr"){const o=[...u].sort((f,w)=>f-w),s=Math.floor(o.length*.25),l=Math.floor(o.length*.75),c=o[s],i=o[l],m=i-c,v=c-m*(1.5+n),y=i+m*(1.5+n);u.forEach((f,w)=>{(f<v||f>y)&&t.push(w)})}else{const o=u.reduce((l,c)=>l+c,0)/u.length,s=Math.sqrt(u.reduce((l,c)=>l+Math.pow(c-o,2),0)/u.length);u.forEach((l,c)=>{const i=Math.abs(l-o);(i>s*(2+n)||i>s&&Math.random()<.2)&&t.push(c)})}return t}function Cs(u){if(u.length===0)return[];const e=[];let n=u[0],t=u[0];for(let o=1;o<u.length;o++){const s=u[o];s-t>1&&(e.push([n,t]),n=s),t=s}return e.push([n,u[u.length-1]]),e}function Ms(u,e,n,t){const o=[`${t.includes("iqc")?"IQC检测":""}${t.includes("lab")?"实验室测试":""} 数据出现异常波动`,`检测到${u==="statistical"?"统计":u==="pattern"?"模式":u==="contextual"?"上下文":"集体"}异常，测量值为 ${n}`,`使用${e==="zscore"?"Z-Score":e==="iqr"?"IQR":e}算法检测到数据异常`,`${t.includes("supplier")?"供应商":""}${t.includes("equipment")?"设备":""} 质量数据异常`,`检测到不符合历史模式的异常值 ${n}，建议进一步分析`];return o[Math.floor(Math.random()*o.length)]}async function Ss(u,e={}){let n=[];return u==="quality"?n=[{title:"质量趋势洞察",description:"近30天质量数据显示不良率呈上升趋势，主要集中在外观缺陷类别。",confidence:92,recommendation:"建议对外观检测标准进行培训，并与供应商沟通改进。",impactLevel:"medium"},{title:"批次相关性分析",description:"批次号以'B25'开头的物料不良率显著高于平均水平，可能存在系统性问题。",confidence:87,recommendation:"对'B25'批次进行专项抽检，并追溯生产记录。",impactLevel:"high"},{title:"季节性模式识别",description:"检测到每月第一周来料质量波动较大，与供应商月度生产计划变更相关。",confidence:78,recommendation:"调整月初验收标准，增加抽检比例。",impactLevel:"low"}]:u==="supplier"?n=[{title:"供应商绩效评估",description:"供应商'金盾'近3个月质量评分下降12%，主要问题在于交付及时性。",confidence:95,recommendation:"安排供应商质量会议，制定改进计划。",impactLevel:"medium"},{title:"供应商风险预警",description:"供应商'易湛'连续出现相同质量问题，且改进效果不明显。",confidence:89,recommendation:"考虑启动备选供应商评估，降低依赖风险。",impactLevel:"high"},{title:"供应链优化建议",description:"综合质量、成本和交付分析，建议增加'华辰'的订单比例。",confidence:82,recommendation:"与'华辰'商议扩大合作规模，签订长期协议。",impactLevel:"medium"}]:u==="process"&&(n=[{title:"工艺参数优化",description:"通过机器学习分析，发现温度控制在72±2℃时良品率最高。",confidence:91,recommendation:"调整工艺参数，缩小温度控制范围。",impactLevel:"high"},{title:"设备维护预测",description:"设备#3振动数据显示异常模式，预计在未来2周可能发生故障。",confidence:85,recommendation:"安排预防性维护，检查轴承和传动部件。",impactLevel:"high"},{title:"工序瓶颈分析",description:"检测到装配工序是当前产能瓶颈，人员技能差异导致效率波动。",confidence:88,recommendation:"优化人员配置，增加技能培训。",impactLevel:"medium"}]),e.confidence&&(n=n.filter(t=>t.confidence>=e.confidence)),e.impactLevel&&(n=n.filter(t=>t.impactLevel===e.impactLevel)),_e({insights:n,generatedAt:new Date().toISOString(),dataSourcesAnalyzed:u==="quality"?["IQC数据","实验室测试","产线检测"]:u==="supplier"?["供应商评估","来料检验","交付记录"]:["设备数据","工艺参数","产能数据"],aiModelUsed:u==="quality"?"QualityTrendAnalyzer v2.1":u==="supplier"?"SupplierRiskAssessment v1.8":"ProcessOptimization v3.0"})}const Fe={getMaterialQualityData:Ge,getSupplierQualityAssessment:ds,getLabTestData:Ze,getProductionLineData:Ke,generateQualityImprovementSuggestions:us,predictQualityTrend:ms,getIntegratedMaterialAnalysis:fs,detectAnomalies:ws,getAnomalyDetails:bs,getAiInsights:Ss,configure:u=>(console.log("配置AI连接器:",u),{success:!0}),testConnection:async()=>({success:!0})},He={cache:{enabled:!0,ttl:30*60*1e3},models:{autoRegister:!0,validateBeforeUse:!0},logging:{level:"info",enablePerformanceLogging:!0},api:{baseUrl:"/api/ai",timeout:3e4,retries:2}};class Ae{static async initialize(e={}){if(this.initialized){console.warn("[AIServiceInitializer] AI服务已经初始化，跳过");return}try{return console.log("[AIServiceInitializer] 开始初始化AI服务..."),this.config={...He,...e},await this.initializeConnector(),this.initializeModelRegistry(),this.initializeMaterialAIService(),this.registerEventListeners(),this.initialized=!0,console.log("[AIServiceInitializer] AI服务初始化完成"),!0}catch(n){throw console.error("[AIServiceInitializer] AI服务初始化失败:",n),n}}static async initializeConnector(){try{console.log("[AIServiceInitializer] 初始化AI连接器..."),Fe.configure({baseUrl:this.config.api.baseUrl,timeout:this.config.api.timeout,retries:this.config.api.retries});const e=await Fe.testConnection();return e.success||console.warn("[AIServiceInitializer] AI连接器连接测试失败，将使用本地模型"),e.success}catch(e){return console.warn("[AIServiceInitializer] AI连接器初始化失败，将使用本地模型:",e),!1}}static initializeModelRegistry(){return console.log("[AIServiceInitializer] 初始化模型注册表..."),ye.addListener((e,n,t)=>{console.log(`[ModelRegistry] 事件: ${e}, 模型: ${n}`)}),!0}static initializeMaterialAIService(){return console.log("[AIServiceInitializer] 初始化物料AI服务..."),Le.initDefaultModels(),!0}static registerEventListeners(){return console.log("[AIServiceInitializer] 注册事件监听器..."),this.config.logging.enablePerformanceLogging&&setInterval(()=>{const e=ue.getMetrics();console.log("[AIEngine] 性能指标:",e)},6e4),!0}static isInitialized(){return this.initialized}static getConfig(){return{...this.config}}static updateConfig(e){return this.initialized&&console.warn("[AIServiceInitializer] AI服务已初始化，配置更新可能不会完全生效"),this.config={...this.config,...e},this.config}static async reset(){if(this.initialized)try{return console.log("[AIServiceInitializer] 重置AI服务..."),ue.AIComputeCache.cache.clear(),this.initialized=!1,await this.initialize(this.config),console.log("[AIServiceInitializer] AI服务重置完成"),!0}catch(e){throw console.error("[AIServiceInitializer] AI服务重置失败:",e),e}}static async getStatus(){const e={initialized:this.initialized,connector:{available:!1,latency:null},models:{count:0,types:[]},cache:{size:0,enabled:this.config.cache.enabled}};try{const n=Date.now(),t=await Fe.testConnection(),o=Date.now()-n;e.connector={available:t.success,latency:o}}catch(n){e.connector={available:!1,latency:null,error:n.message}}return this.initialized&&(e.models={count:ye.getModelCount(),types:ye.listModelTypes()},e.cache={size:ue.AIComputeCache.cache.size,enabled:this.config.cache.enabled}),e}}fe(Ae,"config",{...He}),fe(Ae,"initialized",!1);const Is={class:"ai-insights-panel"},As={class:"panel-header"},xs={class:"status-indicator"},Rs={class:"tab-content"},zs={style:{padding:"15px"}},Ls={class:"tab-content"},Ts={style:{padding:"15px"}},Es={class:"tab-content"},Vs={style:{padding:"15px"}},Us={style:{"margin-top":"20px"}},Ns={class:"tab-content"},Fs={style:{padding:"15px"}},Ps={style:{"margin-top":"20px"}},qs={class:"dialog-footer"},Qs={__name:"AIInsightsPanel",props:{materialCode:{type:String,default:""},materialData:{type:Object,default:()=>({})},autoRefresh:{type:Boolean,default:!1},refreshInterval:{type:Number,default:6e4}},emits:["insight-loaded","action-triggered","error"],setup(u,{expose:e,emit:n}){const t=u,o=n,s=U("risk"),l=U(!1),c=he({connected:!1,latency:null,modelCount:0,modelTypes:[],cacheEnabled:!1,cacheSize:0}),i=he({risk:!0,trend:!0,anomaly:!0,recommendation:!0}),m=he({risk:null,trend:null,anomaly:null,recommendation:null});let v=null;Re(async()=>{try{await y(),await f(),t.materialCode&&await w(),t.autoRefresh&&O()}catch(x){console.error("AI面板初始化失败:",x),W.error("AI分析面板初始化失败，请稍后重试"),o("error",x)}});async function y(){return Ae.isInitialized()||await Ae.initialize(),Ae.isInitialized()}async function f(){try{const x=await Ae.getStatus();return c.connected=x.initialized&&x.connector.available,c.latency=x.connector.latency,c.modelCount=x.models.count,c.modelTypes=x.models.types,c.cacheEnabled=x.cache.enabled,c.cacheSize=x.cache.size,!0}catch(x){return console.error("获取AI状态失败:",x),!1}}async function w(){if(!t.materialCode){W.warning("请先选择物料");return}try{Object.keys(i).forEach(V=>i[V]=!0);const x=t.materialData||{materialCode:t.materialCode};return await Promise.all([p(x),D(x),I(x),z(x)]),o("insight-loaded",{materialCode:t.materialCode,insights:m}),!0}catch(x){return console.error("刷新分析结果失败:",x),W.error("加载分析结果失败，请稍后重试"),o("error",x),!1}}async function p(x){try{const V=await Le.assessRisk([x]);m.risk={materialCode:t.materialCode,riskScore:V.riskScore,riskLevel:V.riskLevel,factors:V.factors,recommendedStrategy:V.recommendedStrategy,historicalComparison:V.historicalComparison,timestamp:new Date}}catch(V){console.error("加载风险分析失败:",V),m.risk=null}finally{i.risk=!1}}async function D(x){try{const V=new Date,X=new Date;X.setDate(V.getDate()+30);const se={start:V.getTime(),end:X.getTime()},C=await Le.predictQualityTrend([x],se);m.trend={materialCode:t.materialCode,trend:C.trend,prediction:C.prediction,confidence:C.confidence,timestamp:new Date}}catch(V){console.error("加载趋势预测失败:",V),m.trend=null}finally{i.trend=!1}}async function I(x){try{const V=await Le.detectAnomalies([x]);m.anomaly={materialCode:t.materialCode,anomalies:V,timestamp:new Date}}catch(V){console.error("加载异常检测失败:",V),m.anomaly=null}finally{i.anomaly=!1}}async function z(x){try{const V=await Le.recommendInspectionStrategy(t.materialCode,{currentData:x});m.recommendation={materialCode:t.materialCode,recommendations:V.recommendations,context:V.context,timestamp:new Date}}catch(V){console.error("加载推荐决策失败:",V),m.recommendation=null}finally{i.recommendation=!1}}function P(x){o("action-triggered",{type:"risk",action:x,materialCode:t.materialCode,data:m.risk})}function E(x){o("action-triggered",{type:"trend",action:x,materialCode:t.materialCode,data:m.trend})}function H(x){o("action-triggered",{type:"anomaly",action:x,materialCode:t.materialCode,data:m.anomaly})}function j(x){o("action-triggered",{type:"recommendation",action:x,materialCode:t.materialCode,data:m.recommendation})}function O(){v&&clearInterval(v),v=setInterval(()=>{w()},t.refreshInterval)}function Q(){v&&(clearInterval(v),v=null)}return xe(()=>t.materialCode,x=>{x&&w()}),xe(()=>t.autoRefresh,x=>{x?O():Q()}),onUnmounted(()=>{Q()}),e({refreshInsights:w,refreshAIStatus:f,startAutoRefresh:O,stopAutoRefresh:Q}),(x,V)=>{const X=g("el-tag"),se=g("el-icon"),C=g("el-button"),_=g("el-tooltip"),N=g("el-skeleton-item"),M=g("el-skeleton"),h=g("el-tab-pane"),A=g("el-tabs"),F=g("el-descriptions-item"),q=g("el-descriptions"),K=g("el-dialog");return S(),T("div",Is,[d("div",As,[V[4]||(V[4]=d("h3",null,"IQE智能分析",-1)),d("div",xs,[a(X,{type:c.connected?"success":"danger",size:"small"},{default:r(()=>[b(L(c.connected?"AI引擎已连接":"AI引擎未连接"),1)]),_:1},8,["type"]),a(_,{content:"AI引擎详细信息",placement:"top"},{default:r(()=>[a(C,{type:"primary",size:"small",circle:"",onClick:V[0]||(V[0]=Y=>l.value=!0)},{default:r(()=>[a(se,null,{default:r(()=>[a(rt(ct))]),_:1})]),_:1})]),_:1})])]),a(A,{modelValue:s.value,"onUpdate:modelValue":V[1]||(V[1]=Y=>s.value=Y),class:"insight-tabs"},{default:r(()=>[a(h,{label:"风险分析",name:"risk"},{default:r(()=>[d("div",Rs,[a(M,{loading:i.risk,animated:""},{template:r(()=>[d("div",zs,[a(N,{variant:"text",style:{width:"100%"}}),a(N,{variant:"text",style:{width:"90%","margin-top":"15px"}}),a(N,{variant:"text",style:{width:"80%","margin-top":"15px"}}),a(N,{variant:"h3",style:{width:"50%","margin-top":"20px"}})])]),default:r(()=>[a(ga,{"risk-data":m.risk,onActionTriggered:P},null,8,["risk-data"])]),_:1},8,["loading"])])]),_:1}),a(h,{label:"趋势预测",name:"trend"},{default:r(()=>[d("div",Ls,[a(M,{loading:i.trend,animated:""},{template:r(()=>[d("div",Ts,[a(N,{variant:"h3",style:{width:"50%"}}),V[5]||(V[5]=d("div",{style:{height:"200px","margin-top":"20px",background:"#f5f7fa"}},null,-1)),a(N,{variant:"text",style:{width:"90%","margin-top":"15px"}})])]),default:r(()=>[a(Ma,{"trend-data":m.trend,onActionTriggered:E},null,8,["trend-data"])]),_:1},8,["loading"])])]),_:1}),a(h,{label:"异常检测",name:"anomaly"},{default:r(()=>[d("div",Es,[a(M,{loading:i.anomaly,animated:""},{template:r(()=>[d("div",Vs,[a(N,{variant:"h3",style:{width:"60%"}}),d("div",Us,[a(N,{variant:"text",style:{width:"100%"}}),a(N,{variant:"text",style:{width:"95%","margin-top":"15px"}})])])]),default:r(()=>[a(Pa,{"anomaly-data":m.anomaly,onActionTriggered:H},null,8,["anomaly-data"])]),_:1},8,["loading"])])]),_:1}),a(h,{label:"决策推荐",name:"recommendation"},{default:r(()=>[d("div",Ns,[a(M,{loading:i.recommendation,animated:""},{template:r(()=>[d("div",Fs,[a(N,{variant:"h3",style:{width:"70%"}}),d("div",Ps,[a(N,{variant:"text",style:{width:"100%"}}),a(N,{variant:"text",style:{width:"90%","margin-top":"15px"}})])])]),default:r(()=>[a(rs,{"recommendation-data":m.recommendation,onActionTriggered:j},null,8,["recommendation-data"])]),_:1},8,["loading"])])]),_:1})]),_:1},8,["modelValue"]),a(K,{modelValue:l.value,"onUpdate:modelValue":V[3]||(V[3]=Y=>l.value=Y),title:"AI引擎状态",width:"550px"},{default:r(()=>[a(q,{column:1,border:""},{default:r(()=>[a(F,{label:"连接状态"},{default:r(()=>[a(X,{type:c.connected?"success":"danger"},{default:r(()=>[b(L(c.connected?"已连接":"未连接"),1)]),_:1},8,["type"])]),_:1}),a(F,{label:"响应时间"},{default:r(()=>[b(L(c.latency?`${c.latency}ms`:"未知"),1)]),_:1}),a(F,{label:"已加载模型数"},{default:r(()=>[b(L(c.modelCount),1)]),_:1}),a(F,{label:"可用模型类型"},{default:r(()=>[(S(!0),T(oe,null,ce(c.modelTypes,Y=>(S(),le(X,{key:Y,style:{"margin-right":"5px"}},{default:r(()=>[b(L(Y),1)]),_:2},1024))),128))]),_:1}),a(F,{label:"缓存状态"},{default:r(()=>[b(L(c.cacheEnabled?"已启用":"已禁用")+" ("+L(c.cacheSize)+"项) ",1)]),_:1})]),_:1}),d("div",qs,[a(C,{onClick:f},{default:r(()=>V[6]||(V[6]=[b("刷新状态")])),_:1,__:[6]}),a(C,{onClick:V[2]||(V[2]=Y=>l.value=!1)},{default:r(()=>V[7]||(V[7]=[b("关闭")])),_:1,__:[7]})])]),_:1},8,["modelValue"])])}}},Bs=ve(Qs,[["__scopeId","data-v-583be591"]]),Os={class:"ai-assistant-container"},js={class:"assistant-layout"},Hs={class:"chat-section"},Ws={class:"scenario-cards"},Gs={class:"quick-questions"},Zs={class:"features-section"},Ks={key:0,class:"insight-panel-container"},Js={class:"material-info-header"},Xs={class:"material-details"},Ys={class:"material-tags"},eo={key:1,class:"no-material-selected"},to={class:"actions-container"},no={key:1,class:"action-cards"},ao={class:"action-header"},so={class:"action-content"},oo={class:"dialog-footer"},io={__name:"AiAssistant",setup(u){const e=vt(),n=U("general"),t=U("insights");he({nlp:!0,visualization:!0,vision:!0,predictive:!0,integration:!0}),U(1280),U(96.5),U(["电气参数","物理特性","可靠性","功能测试","外观检查"]),U([{date:"2025/05/26",project:"X6725B",projectPhase:"量产",componentType:"结构件",anomalyType:"可靠性",urgencyLevel:"返工生产",responsibleFactory:"南昌工厂",location:"IQC",materialCode:"37301062",materialName:"电池盖",description:"装卸100次后针变形（标准500次），不良率2/3",supplier:"金盾",responsibility:"来料",riskLevel:"B"},{date:"2025/05/25",project:"X6725B",projectPhase:"量产",componentType:"包材",anomalyType:"外观",urgencyLevel:"克服生产",responsibleFactory:"泰衡诺工厂",location:"产线",materialCode:"38501375",materialName:"保护膜",description:"酒精耐磨500g×25次掉漆油墨",supplier:"易湛",responsibility:"来料",riskLevel:"C"}]);const o=U([{testDate:"2025/05/26",testSource:"深圳实验室来料例行测试",project:"X6725",materialCode:"38501375",materialName:"保护膜（全包膜）",testItem:"酒精耐磨 500g × 25次掉漆油墨",result:"NG",badBatch:"#03, #04",defectRate:"2/2（100%）",supplier:"易湛",responsibility:"来料",recommendation:"整批物料标记为不合格，建议暂停上线使用",remarks:"与生产端返工记录匹配（见2025/05/26记录）"},{testDate:"2025/05/24",testSource:"南昌实验室来料检测",project:"X6725",materialCode:"37301062",materialName:"电池盖",testItem:"连续开合耐久性测试 500次",result:"NG",badBatch:"#A22, #A23",defectRate:"2/3（66.7%）",supplier:"金盾",responsibility:"来料",recommendation:"返工处理，增加抽检比例",remarks:"与上月同批次问题相似，建议供应商改进工艺"}]);U({criticalAlerts:2,pendingReviews:7,lastRefreshTime:new Date().toLocaleString()});const s=he({general:["分析最近一周的质量趋势","识别最常见的缺陷类型","哪些物料需要加强检验?","生成月度质量报告"],factory:["南昌工厂返工率趋势如何?","金盾供应商的材料合格率","分析电池盖变形原因","推荐结构件检验标准"],lab:["分析X6725B可靠性问题","易湛耐磨不良统计汇总","对比不同批次电池盖质量","生成测试偏差报告"],online:["预测下批次保护膜良率","物料#38501375缺陷趋势","C级风险物料清单","推荐产线质量改进方案"],supplier:["评估易湛供应商质量等级","金盾供应商质量趋势分析","供应商质量排名前5","供应商来料不良TOP5"]});function l($){switch($){case"factory":return'您好，我是IQE工厂质检助手。我可以帮助您分析物料异常数据，评估供应商质量，追踪返工记录，以及生成针对性的物料质量报告。最近"电池盖（料号37301062）"出现可靠性问题，您需要了解相关情况吗？';case"lab":return'您好，我是IQE实验室助手。我可以帮助您分析测试数据，比对检验批次，评估测试标准，以及生成测试报告。最近"保护膜（料号38501375）"酒精耐磨测试100%不良，我可以提供详细分析。';case"online":return"您好，我是IQE产线助手。我可以帮助您分析在线生产数据，识别缺陷模式，追踪批次质量，以及预测潜在风险。目前有2个C级质量风险需要关注，需要我列出详情吗？";case"supplier":return'您好，我是IQE供应商质量助手。我可以帮助您评估供应商质量表现，分析质量趋势，识别高风险供应商，以及生成供应商质量报告。目前"易湛"供应商被评为C级(高风险)，需要我提供详细分析吗？';default:return`您好，我是IQE智能助手，有什么可以帮您？

根据最新数据，我发现：
- 易湛供应商保护膜存在严重质量问题（100%不良率）
- 电池盖耐久性测试未达标准（66.7%不良率）
- 南昌工厂返工率上升5.2%

您想了解哪方面的详细信息？`}}const c=Pe(()=>{if(!I.value)return[];const $=[{icon:"el-icon-warning",title:"生成异常物料报告",description:"基于最近一周的异常记录，生成物料质量分析报告",action:"generateReport"},{icon:"el-icon-pie-chart",title:"检测结果分析",description:"对比近期实验室检测结果，识别潜在风险模式",action:"analyzeTestResults"}],k=I.value.toLowerCase();if(k.includes("保护膜")||k.includes("38501375"))return[{icon:"el-icon-document",title:"保护膜质量分析",description:"分析料号38501375的历史质量数据和测试结果",action:"analyzeMaterial",params:{materialCode:"38501375"}},{icon:"el-icon-warning",title:"供应商易湛评估",description:"查看易湛供应商最近6个月的质量表现和异常记录",action:"analyzeSupplier",params:{supplierCode:"SUP002"}},{icon:"el-icon-data-line",title:"生成检测方案",description:"为下批次保护膜生成强化检验方案",action:"generateInspectionPlan",params:{materialCode:"38501375",riskLevel:"high"}},{icon:"el-icon-trend-charts",title:"预测质量趋势",description:"使用AI模型预测未来30天内的质量趋势",action:"predictQualityTrend",params:{materialCode:"38501375",days:30}}];if(k.includes("电池盖")||k.includes("37301062"))return[{icon:"el-icon-document",title:"电池盖可靠性分析",description:"分析料号37301062的耐久性测试数据",action:"analyzeMaterial",params:{materialCode:"37301062"}},{icon:"el-icon-video-camera",title:"查看失效视频",description:"观看电池盖变形失效的测试记录视频",action:"viewFailureVideo",params:{materialCode:"37301062",testType:"reliability"}},{icon:"el-icon-s-cooperation",title:"工艺改进建议",description:"基于历史数据，推荐供应商金盾的工艺改进方向",action:"generateImprovementPlan",params:{materialCode:"37301062",supplierCode:"SUP001"}},{icon:"el-icon-connection",title:"集成数据分析",description:"整合实验室、生产线和质量数据进行全面分析",action:"integratedAnalysis",params:{materialCode:"37301062"}}];if(k.includes("供应商")||k.includes("评估")){const R=k.includes("易湛"),te=k.includes("金盾");return[{icon:"el-icon-user",title:`${R?"易湛":te?"金盾":"供应商"}质量评估`,description:`分析${R?"易湛":te?"金盾":"所有"}供应商的质量表现`,action:"analyzeSupplier",params:{supplierCode:R?"SUP002":te?"SUP001":"all"}},{icon:"el-icon-data-analysis",title:"供应商质量趋势",description:"分析供应商近6个月质量分数变化趋势",action:"analyzeSupplierTrend",params:{supplierCode:R?"SUP002":te?"SUP001":"all"}},{icon:"el-icon-document-checked",title:"供应商审核计划",description:"生成供应商质量审核计划",action:"generateAuditPlan",params:{supplierCode:R?"SUP002":te?"SUP001":"all",priority:R?"high":te?"medium":"normal"}}]}if(k.includes("预测")||k.includes("趋势"))return D.value=!0,t.value="prediction",[{icon:"el-icon-trend-charts",title:"质量趋势预测",description:"使用AI预测未来30天的质量趋势",action:"predictQualityTrend",params:{days:30}},{icon:"el-icon-warning",title:"风险物料预警",description:"识别未来可能出现质量问题的高风险物料",action:"predictRiskMaterials"},{icon:"el-icon-document",title:"生成预测报告",description:"生成详细的AI预测分析报告",action:"generatePredictionReport"}];switch(n.value){case"factory":return[...$,{icon:"el-icon-reading",title:"返工流程优化",description:"分析返工生产流程并提供优化建议",action:"optimizeReworkProcess"},{icon:"el-icon-receiving",title:"来料质检计划",description:"生成针对高风险供应商的强化IQC计划",action:"generateInspectionPlan",params:{target:"incoming"}}];case"lab":return[...$,{icon:"el-icon-coordinate",title:"测试标准调整",description:"根据近期不良趋势，推荐测试标准调整",action:"optimizeTestStandards"},{icon:"el-icon-finished",title:"批次质量预测",description:"基于历史数据预测即将到货批次的质量风险",action:"predictBatchQuality"}];case"online":return[...$,{icon:"el-icon-alarm-clock",title:"质量预警配置",description:"设置基于AI的实时质量异常预警规则",action:"configureQualityAlerts"},{icon:"el-icon-set-up",title:"产线参数优化",description:"根据质量数据推荐生产线参数调整",action:"optimizeProductionParams"}];case"supplier":return[...$,{icon:"el-icon-user",title:"供应商评级",description:"生成供应商质量等级评估报告",action:"rateSuppliers"},{icon:"el-icon-document-checked",title:"供应商质量改进计划",description:"为高风险供应商生成质量改进计划",action:"generateSupplierImprovementPlan"}];default:return $}}),i=U(null),m=U(null),v=U(null),y=U(null),f=U(!1),w=U(!1),p=U(!1),D=U(!1),I=U(""),z=U(!1),P=U(null),E=he({code:"",name:"",supplier:""}),H=U([{code:"37301062",name:"电池盖",type:"结构件",supplier:"金盾",lastInspection:"2025/05/24",riskLevel:"B",defectRate:.25,factoryData:{},labData:{}},{code:"38501375",name:"保护膜",type:"包材",supplier:"易湛",lastInspection:"2025/05/26",riskLevel:"C",defectRate:.65,factoryData:{},labData:{}},{code:"37402185",name:"屏幕组件",type:"电子元件",supplier:"盛达",lastInspection:"2025/05/22",riskLevel:"A",defectRate:.05,factoryData:{},labData:{}}]),j=Pe(()=>H.value.filter($=>{const k=!E.code||$.code.includes(E.code),R=!E.name||$.name.includes(E.name),te=!E.supplier||$.supplier===E.supplier;return k&&R&&te}));function O($){switch($){case"A":return"success";case"B":return"warning";case"C":return"danger";default:return"info"}}function Q(){console.log("搜索物料，当前条件:",E)}function x(){E.code="",E.name="",E.supplier=""}function V($){P.value=$}function X(){P.value&&(z.value=!1,t.value="insights",W.success(`已选择物料: ${P.value.name} (${P.value.code})`))}function se($){m.value&&m.value.speakText($)}function C($){I.value=$,i.value&&(i.value.addUserMessage($),i.value.addBotMessage(`已收到您的语音消息: "${$}"`))}function _(){i.value&&i.value.startSpeechRecognition()}function N(){i.value&&i.value.stopSpeechRecognition()}async function M($,k,R){I.value=$;const te=h($);if(te){R({type:"text",content:`正在为您导航至${te.name}页面，请稍候...`}),setTimeout(()=>{e.push(te.path)},1e3);return}($.toLowerCase().includes("图表")||$.toLowerCase().includes("趋势")||$.toLowerCase().includes("统计"))&&(p.value=!0,t.value="chart",setTimeout(()=>{i.value&&i.value.addBotMessage("正在生成相关数据图表..."),ie($)},1e3)),($.toLowerCase().includes("图像")||$.toLowerCase().includes("照片")||$.toLowerCase().includes("视觉"))&&(w.value=!0,t.value="image"),($.toLowerCase().includes("预测")||$.toLowerCase().includes("分析趋势")||$.toLowerCase().includes("预估"))&&(D.value=!0,t.value="prediction"),setTimeout(()=>{let ne="";const G=$.toLowerCase();if(G.includes("保护膜")||G.includes("38501375")){w.value=!0,t.value="image";const B=o.value.find(J=>J.materialCode==="38501375");ne={type:"text",content:`## 料号38501375保护膜分析结果

**检测日期**: ${B.testDate}
**检测项目**: ${B.testItem}
**批次**: ${B.badBatch}
**不良率**: ${B.defectRate}

**问题分析**:
保护膜出现严重耐磨性不足问题，酒精测试下100%批次出现掉漆现象。根据历史记录，该供应商"易湛"在过去3个月内有2次类似异常记录。

**建议措施**:
1. 立即暂停该批次物料使用
2. 对供应商发出质量预警
3. 要求供应商提供整改方案
4. 在图片分析面板中可查看材料缺陷详情`}}else if(G.includes("电池盖")||G.includes("37301062"))p.value=!0,t.value="chart",ne={type:"text",content:`## 料号37301062电池盖分析结果

**异常描述**: 装卸100次后针变形（标准500次），不良率66.7%
**发生位置**: 南昌工厂IQC
**供应商**: 金盾

**趋势分析**:
该问题与上月同批次相似，显示供应商工艺存在稳定性问题。右侧图表面板展示了该物料近6个月的质量趋势，可见5月份开始异常率明显上升。

**根本原因分析**:
1. 模具磨损导致精度下降
2. 原材料批次变更未经充分验证
3. 供应商生产参数偏移

**建议对策**:
1. 要求供应商调整模具参数
2. 增加来料抽检比例至8%
3. 对库存批次进行100%复检`};else if(G.includes("分析")&&(G.includes("质量")||G.includes("趋势")))p.value=!0,t.value="chart",ne={type:"text",content:`## IQE质量趋势分析

根据过去30天的检验数据分析：

### 主要发现
1. **来料质量问题**占异常总数的68%，较上月增加12%
2. **结构件类**材料不良率最高，达8.5%
3. **南昌工厂**返工率最高，达4.2%
4. **易湛**和**金盾**两家供应商贡献了56%的质量异常

### 风险预警
- C级风险物料：保护膜(38501375)，建议100%检验
- B级风险物料：电池盖(37301062)，建议提升抽检比例

您可以在右侧图表面板中查看详细的趋势变化。`};else if(G.includes("供应商")&&(G.includes("易湛")||G.includes("金盾"))){p.value=!0,t.value="chart";const B=G.includes("易湛")?"易湛":"金盾";ne={type:"text",content:`## ${B}供应商质量分析报告

**供应商等级**: ${B==="易湛"?"C级(高风险)":"B级(中风险)"}
**近3个月合格率**: ${B==="易湛"?"86.4%":"91.2%"}
**主要问题类型**: ${B==="易湛"?"外观不良、耐磨性不足":"结构强度不足、尺寸偏差"}

**异常批次记录**:
${B==="易湛"?`- 2025/05/25: 保护膜(38501375)掉漆
- 2025/04/12: 标签(38402156)褪色
- 2025/03/22: 包装盒(38904532)异味`:`- 2025/05/26: 电池盖(37301062)变形
- 2025/04/28: 按键(37208631)卡顿
- 2025/03/05: 卡托(37108952)断裂`}

**改进建议**:
1. ${B==="易湛"?"要求提供油墨供应商变更说明":"建议调整模具参数和注塑温度"}
2. ${B==="易湛"?"增加UV老化测试项目":"增加疲劳测试循环次数"}
3. 安排质量工程师现场辅导

右侧图表展示了该供应商过去6个月的质量趋势。`}}else G.includes("生成")&&G.includes("检测方案")?ne={type:"text",content:`## 智能检验方案

基于历史数据和当前质量状态，我为您生成了优化检验方案：

### 高风险物料检验方案
- **保护膜(38501375)**:
  - IQC抽检比例: 100%
  - 重点检测项: 酒精耐磨测试(500g×50次)，UV老化测试(48h)
  - 检验频率: 每批次
  - 特别要求: 供应商提供出厂检验报告，增加老化测试

### 中风险物料检验方案
- **电池盖(37301062)**:
  - IQC抽检比例: 8% (标准2%)
  - 重点检测项: 连续开合测试(标准提升至800次)
  - 检验频率: 每批次
  - 特别要求: 供应商提供原材料检验证明

### 一般物料检验方案
- 维持标准检验流程，抽检比例2%
- 重点关注新批次物料

**有效期**: 2025/06/01 - 2025/07/01`}:G.includes("图表")||G.includes("chart")?(p.value=!0,t.value="chart",ne={type:"text",content:'我已为您准备了图表生成工具，您可以在右侧面板中创建和编辑图表来分析质量数据趋势。建议您关注"来料质量趋势"和"供应商不良率对比"两个关键指标。'}):G.includes("图片")||G.includes("图像分析")?(w.value=!0,t.value="image",ne={type:"text",content:"我已为您打开图像分析工具，您可以上传物料图片进行缺陷检测。系统支持分析结构件表面缺陷、印刷品质量问题和组装偏差等多种缺陷类型。"}):G.includes("语音")||G.includes("朗读")?(f.value=!0,t.value="speech",ne={type:"text",content:"语音控制面板已打开，您可以调整语音设置或使用语音输入。语音识别已针对IQE常用术语进行优化，支持识别物料代码、供应商名称和质量术语。"}):ne={type:"text",content:`您好，我是IQE智能助手。我注意到您询问的是"${$}"，以下是我可以协助的内容：

1. **物料质量分析**：查询并分析特定物料代码的质量历史和当前状态
2. **供应商评估**：评估供应商质量表现并生成风险评级
3. **异常分析**：分析质量异常原因并提供处理建议
4. **检验方案**：生成基于风险的智能检验方案

您可以尝试询问特定材料(如"分析电池盖质量问题")、供应商(如"评估易湛供应商")或生成特定报告(如"生成检测方案")。`};R(ne)},1e3)}function h($){const k=$.toLowerCase();return k.includes("实验室")&&k.includes("数据")||k.includes("检测结果")||k.includes("lab view")||k.includes("测试结果")?{name:"实验室检测分析",path:"/lab-view"}:k.includes("监控")||k.includes("仪表板")||k.includes("dashboard")||k.includes("总览")?{name:"质量监控仪表板",path:"/monitoring-dashboard"}:null}function A($){console.log("图表已更新",$)}function F($){console.log("分析完成",$),i.value&&i.value.addMessage("system",`系统检测到${$.defects.length}个缺陷，整体质量评估: ${$.overallQuality==="pass"?"合格":"不合格"}`,"text")}function q($){console.log("报告已生成",$),W.success("分析报告已生成"),i.value&&i.value.addMessage("system",`质量分析报告已生成 (${new Date().toLocaleString()})`,"text")}function K($){w.value=!0,t.value="image",W.success("图片已上传，可以在右侧面板进行分析")}function Y($){i.value&&(I.value=$,be(()=>{i.value&&(i.value.addMessage("user",$,"text"),setTimeout(()=>{const k=i.value.messages.length;i.value.addMessage("assistant","","loading"),setTimeout(()=>{i.value.messages.splice(k,1),M($,[],R=>{typeof R=="string"?i.value.addMessage("assistant",R,"text"):i.value.addMessage("assistant",R.content,R.type||"text",{...R.type==="chart"&&{chartData:R.chartData,chartTitle:R.title},...R.type==="image"&&{alt:R.alt,caption:R.caption}})})},1500)},100))}))}async function ae($){if($.action==="analyzeMaterial"||$.action==="generateInspectionPlan"){we();return}if(console.log(`执行操作: ${$.title}`,$),W.success(`正在${$.title}，请稍候...`),$.action==="generateReport"?(t.value="chart",p.value=!0,be(()=>{y.value&&y.value.generateRandomChart("bar")})):$.action==="analyzeTestResults"&&(t.value="chart",p.value=!0,be(()=>{y.value&&y.value.generateRandomChart("line")})),$.params&&$.params.materialCode){const k=H.value.find(R=>R.code===$.params.materialCode);k&&(P.value=k,["analyzeMaterial","generateInspectionPlan","predictQualityTrend"].includes($.action)&&(t.value="insights"))}}function we(){z.value=!0}function re($){console.log("AI分析结果加载完成:",$)}function pe($){console.log("AI分析操作触发:",$),$.type==="risk"?$.action.type==="applyStrategy"?W.success("已应用风险分析推荐的检验策略"):$.action.type==="exportReport"&&W.success("风险分析报告已导出"):$.type==="trend"||$.type==="anomaly"||$.type}function ke($){console.error("AI分析错误:",$),W.error("AI分析出现错误，请稍后重试")}Re(()=>{p.value=!0;const $=sessionStorage.getItem("iqe_shared_data");if($){const k=JSON.parse($);k.referringModule&&W.info(`您从${k.referringModule}页面跳转而来，相关数据已加载`)}}),xe(n,$=>{i.value&&i.value.addMessage("system",`场景已切换到"${ge($)}"，推荐操作已更新`,"text")});function ge($){switch($){case"factory":return"库存场景";case"lab":return"实验室场景";case"online":return"产线场景";case"supplier":return"供应商质量助手";default:return"通用场景"}}function ie($){const k=U(null);be(()=>{if(!k.value)return;const R=$.toLowerCase();R.includes("不良率")||R.includes("趋势")?k.value.generateChart({type:"line",title:"物料不良率趋势分析",data:{labels:["1月","2月","3月","4月","5月"],datasets:[{label:"电池盖 (37301062)",data:[2.5,3.2,5.1,4.8,6.7],borderColor:"#409EFF"},{label:"保护膜 (38501375)",data:[1.8,2.5,3,5.2,8],borderColor:"#F56C6C"}]},options:{yAxisTitle:"不良率 (%)",threshold:5}}):R.includes("缺陷")||R.includes("类型")?k.value.generateChart({type:"pie",title:"缺陷类型分布",data:{labels:["外观","功能","尺寸","其他"],datasets:[{data:[45,25,20,10],backgroundColor:["#409EFF","#F56C6C","#E6A23C","#67C23A"]}]}}):R.includes("供应商")||R.includes("评估")?k.value.generateChart({type:"bar",title:"供应商质量评估",data:{labels:["金盾","易湛","其他供应商"],datasets:[{label:"质量得分",data:[78,65,85],backgroundColor:["#409EFF","#F56C6C","#67C23A"]}]},options:{yAxisTitle:"得分 (0-100)",threshold:70}}):k.value.generateChart({type:"line",title:"IQE质量综合趋势",data:{labels:["1月","2月","3月","4月","5月"],datasets:[{label:"不良率",data:[3.2,3.5,4.1,4.8,5.2],borderColor:"#F56C6C",yAxisID:"y"},{label:"返工率",data:[1.5,1.8,2,2.2,2.5],borderColor:"#E6A23C",yAxisID:"y"},{label:"客诉率",data:[.5,.4,.6,.8,.7],borderColor:"#67C23A",yAxisID:"y1"}]},options:{yAxisTitle:"百分比 (%)",y2AxisTitle:"每千台",threshold:5}})})}return($,k)=>{const R=g("el-radio-button"),te=g("el-radio-group"),ne=g("el-tag"),G=g("el-button"),B=g("el-empty"),J=g("el-tab-pane"),me=g("el-icon"),$e=g("el-card"),Ne=g("el-tabs"),je=g("el-input"),Te=g("el-form-item"),Ee=g("el-option"),Je=g("el-select"),Xe=g("el-form"),Se=g("el-table-column"),Ye=g("el-table"),et=g("el-dialog");return S(),T("div",Os,[k[25]||(k[25]=d("h2",{class:"page-title"},"IQE智能助手",-1)),d("div",js,[d("div",Hs,[d("div",Ws,[a(te,{modelValue:n.value,"onUpdate:modelValue":k[0]||(k[0]=Z=>n.value=Z),size:"large"},{default:r(()=>[a(R,{label:"general"},{default:r(()=>k[10]||(k[10]=[b("通用助手")])),_:1,__:[10]}),a(R,{label:"factory"},{default:r(()=>k[11]||(k[11]=[b("库存场景")])),_:1,__:[11]}),a(R,{label:"lab"},{default:r(()=>k[12]||(k[12]=[b("实验室场景")])),_:1,__:[12]}),a(R,{label:"online"},{default:r(()=>k[13]||(k[13]=[b("产线场景")])),_:1,__:[13]}),a(R,{label:"supplier"},{default:r(()=>k[14]||(k[14]=[b("供应商质量助手")])),_:1,__:[14]})]),_:1},8,["modelValue"])]),d("div",Gs,[(S(!0),T(oe,null,ce(s[n.value],(Z,Ie)=>(S(),le(ne,{key:Ie,onClick:tt=>Y(Z),class:"quick-question-tag",type:Ie%4===0?"":Ie%4===1?"success":Ie%4===2?"warning":"danger",effect:"plain"},{default:r(()=>[b(L(Z),1)]),_:2},1032,["onClick","type"]))),128))]),a(Gn,{ref_key:"chatRef",ref:i,class:"chat-window","welcome-message":l(n.value),"context-memory":!0,"max-context-messages":10,onSendMessage:M,onSpeechStart:se,onSpeechEnd:C,onImageUpload:K},null,8,["welcome-message"])]),d("div",Zs,[a(Ne,{modelValue:t.value,"onUpdate:modelValue":k[4]||(k[4]=Z=>t.value=Z),class:"feature-tabs"},{default:r(()=>[a(J,{label:"AI分析",name:"insights"},{default:r(()=>[P.value?(S(),T("div",Ks,[d("div",Js,[d("div",Xs,[d("h3",null,L(P.value.name)+" ("+L(P.value.code)+")",1),d("div",Ys,[a(ne,{size:"small"},{default:r(()=>[b(L(P.value.type),1)]),_:1}),a(ne,{size:"small",type:"info"},{default:r(()=>[b("供应商: "+L(P.value.supplier),1)]),_:1}),a(ne,{size:"small",type:O(P.value.riskLevel)},{default:r(()=>[b(" 风险等级: "+L(P.value.riskLevel),1)]),_:1},8,["type"])])]),a(G,{type:"primary",size:"small",onClick:we},{default:r(()=>k[15]||(k[15]=[b(" 更换物料 ")])),_:1,__:[15]})]),a(Bs,{"material-code":P.value.code,"material-data":P.value,"auto-refresh":!1,onInsightLoaded:re,onActionTriggered:pe,onError:ke},null,8,["material-code","material-data"])])):(S(),T("div",eo,[a(B,{description:"请选择物料进行AI分析"},{default:r(()=>[a(G,{type:"primary",onClick:we},{default:r(()=>k[16]||(k[16]=[b("选择物料")])),_:1,__:[16]})]),_:1})]))]),_:1}),a(J,{label:"推荐操作",name:"actions"},{default:r(()=>[d("div",to,[k[17]||(k[17]=d("h3",null,"基于当前对话的推荐操作",-1)),!I.value&&c.value.length===0?(S(),le(B,{key:0,description:"对话后将显示推荐操作"})):(S(),T("div",no,[(S(!0),T(oe,null,ce(c.value,(Z,Ie)=>(S(),le($e,{key:Ie,class:"action-card",shadow:"hover",onClick:tt=>ae(Z)},{header:r(()=>[d("div",ao,[a(me,{class:Qe(Z.icon)},{default:r(()=>[(S(),le(dt(Z.icon)))]),_:2},1032,["class"]),d("span",null,L(Z.title),1)])]),default:r(()=>[d("div",so,L(Z.description),1)]),_:2},1032,["onClick"]))),128))]))])]),_:1}),a(J,{label:"图表生成",name:"chart"},{default:r(()=>[Ce(a(_n,{ref_key:"chartGeneratorRef",ref:y,height:"400px",onChartUpdated:A},null,512),[[Me,p.value]]),Ce(a(B,{description:"请在对话中提及'图表'、'趋势'等关键词来激活图表功能"},{default:r(()=>[a(G,{onClick:k[1]||(k[1]=Z=>p.value=!0)},{default:r(()=>k[18]||(k[18]=[b("打开图表生成器")])),_:1,__:[18]})]),_:1},512),[[Me,!p.value]])]),_:1}),a(J,{label:"图像分析",name:"image"},{default:r(()=>[Ce(a(Zt,{ref_key:"imageAnalysisRef",ref:v,onAnalysisComplete:F,onReportGenerated:q},null,512),[[Me,w.value]]),Ce(a(B,{description:"请在对话中提及'图像分析'或上传图片来激活该功能"},{default:r(()=>[a(G,{onClick:k[2]||(k[2]=Z=>w.value=!0)},{default:r(()=>k[19]||(k[19]=[b("打开图像分析工具")])),_:1,__:[19]})]),_:1},512),[[Me,!w.value]])]),_:1}),a(J,{label:"语音设置",name:"speech"},{default:r(()=>[Ce(a(Rt,{ref_key:"speechControlRef",ref:m,onSpeechStart:_,onSpeechEnd:N},null,512),[[Me,f.value]]),Ce(a(B,{description:"请在对话中提及'语音'或点击聊天窗口中的语音按钮来激活该功能"},{default:r(()=>[a(G,{onClick:k[3]||(k[3]=Z=>f.value=!0)},{default:r(()=>k[20]||(k[20]=[b("打开语音设置")])),_:1,__:[20]})]),_:1},512),[[Me,!f.value]])]),_:1})]),_:1},8,["modelValue"])])]),a(et,{modelValue:z.value,"onUpdate:modelValue":k[9]||(k[9]=Z=>z.value=Z),title:"选择物料进行AI分析",width:"60%"},{footer:r(()=>[d("span",oo,[a(G,{onClick:k[8]||(k[8]=Z=>z.value=!1)},{default:r(()=>k[23]||(k[23]=[b("取消")])),_:1,__:[23]}),a(G,{type:"primary",onClick:X,disabled:!P.value},{default:r(()=>k[24]||(k[24]=[b(" 确认选择 ")])),_:1,__:[24]},8,["disabled"])])]),default:r(()=>[a(Xe,{inline:!0,class:"material-search-form"},{default:r(()=>[a(Te,{label:"物料编码"},{default:r(()=>[a(je,{modelValue:E.code,"onUpdate:modelValue":k[5]||(k[5]=Z=>E.code=Z),placeholder:"输入物料编码",clearable:""},null,8,["modelValue"])]),_:1}),a(Te,{label:"物料名称"},{default:r(()=>[a(je,{modelValue:E.name,"onUpdate:modelValue":k[6]||(k[6]=Z=>E.name=Z),placeholder:"输入物料名称",clearable:""},null,8,["modelValue"])]),_:1}),a(Te,{label:"供应商"},{default:r(()=>[a(Je,{modelValue:E.supplier,"onUpdate:modelValue":k[7]||(k[7]=Z=>E.supplier=Z),placeholder:"选择供应商",clearable:""},{default:r(()=>[a(Ee,{label:"全部",value:""}),a(Ee,{label:"金盾",value:"金盾"}),a(Ee,{label:"易湛",value:"易湛"}),a(Ee,{label:"其他",value:"其他"})]),_:1},8,["modelValue"])]),_:1}),a(Te,null,{default:r(()=>[a(G,{type:"primary",onClick:Q},{default:r(()=>k[21]||(k[21]=[b("搜索")])),_:1,__:[21]}),a(G,{onClick:x},{default:r(()=>k[22]||(k[22]=[b("重置")])),_:1,__:[22]})]),_:1})]),_:1}),a(Ye,{data:j.value,style:{width:"100%"},onRowClick:V,"highlight-current-row":""},{default:r(()=>[a(Se,{prop:"code",label:"物料编码",width:"150"}),a(Se,{prop:"name",label:"物料名称",width:"200"}),a(Se,{prop:"type",label:"类型",width:"120"}),a(Se,{prop:"supplier",label:"供应商",width:"120"}),a(Se,{prop:"lastInspection",label:"最近检验日期",width:"180"}),a(Se,{prop:"riskLevel",label:"风险等级"},{default:r(Z=>[a(ne,{type:O(Z.row.riskLevel)},{default:r(()=>[b(L(Z.row.riskLevel),1)]),_:2},1032,["type"])]),_:1})]),_:1},8,["data"])]),_:1},8,["modelValue"])])}}},ho=ve(io,[["__scopeId","data-v-b3d7d051"]]);export{ho as default};
