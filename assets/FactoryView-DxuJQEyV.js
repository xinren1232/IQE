import{r as v,c as x,t as be,n as we,e as U,k as o,f as e,g as l,j as i,o as L,a5 as ye,a6 as Ce,u as xe,a7 as ke,l as c,x as r,a8 as H,a9 as J,aa as De}from"./element-plus-GKyTe0pu.js";import{_ as ze,f as Q,m as Y,g as Ve}from"./index-PiER-Nao.js";import"./index-BcmJDH2O.js";import{cF as Se}from"./echarts-Cq7vAPzK.js";import"./install-__7xUayv.js";import"./installMarkPoint-CbaZpOSi.js";const Me={class:"factory-container"},Re={class:"page-header"},Fe={class:"toolbar"},Le={class:"statistics-cards"},$e={class:"stat-content"},Be={class:"stat-icon"},Ne={class:"stat-info"},Ie={class:"stat-value"},Ue={class:"stat-content"},Ee={class:"stat-icon"},qe={class:"stat-info"},Oe={class:"stat-value"},je={class:"stat-rate"},Ae={class:"stat-content"},Pe={class:"stat-icon"},Te={class:"stat-info"},He={class:"stat-value"},Je={class:"stat-content"},Qe={class:"stat-icon"},Ye={class:"stat-info"},Ge={class:"stat-value"},Ke={class:"card-header"},We={class:"pagination-wrapper"},Xe={key:0,class:"material-detail"},Ze={__name:"FactoryView",setup(et){const m=v([...Q]),S=v(""),M=v(""),R=v(""),k=v(1),D=v(10),g=v(""),$=v(""),B=v(!1),u=v(null),N=v(null);let y=null;const I=x(()=>{let a=m.value;if(S.value){const t=S.value.toLowerCase();a=a.filter(_=>_.material_code.toLowerCase().includes(t)||_.material_name.toLowerCase().includes(t)||_.supplier.toLowerCase().includes(t))}if(M.value&&(a=a.filter(t=>t.category_id===M.value)),R.value)switch(R.value){case"low":a=a.filter(t=>t.defect_rate<1);break;case"medium":a=a.filter(t=>t.defect_rate>=1&&t.defect_rate<=3);break;case"high":a=a.filter(t=>t.defect_rate>3);break}return g.value&&(a=[...a].sort((t,_)=>$.value==="ascending"?t[g.value]>_[g.value]?1:-1:t[g.value]<_[g.value]?1:-1)),a}),G=x(()=>{const a=(k.value-1)*D.value,t=a+D.value;return I.value.slice(a,t)}),K=x(()=>m.value.reduce((a,t)=>a+t.quantity,0)),W=x(()=>m.value.length===0?0:(m.value.reduce((t,_)=>t+_.defect_rate,0)/m.value.length).toFixed(2)),E=x(()=>m.value.filter(a=>a.defect_rate>3).length),X=x(()=>m.value.length?(E.value/m.value.length*100).toFixed(1):0);function Z(){m.value=[...Q],A()}function ee(a){a.prop?(g.value=a.prop,$.value=a.order):(g.value="",$.value="")}function te(a){D.value=a,k.value=1}function ae(a){k.value=a}function le(a){q(a)}function q(a){u.value={...a,history:ie(a)},B.value=!0}function oe(a){console.log("检验物料:",a.material_code)}function ne(){console.log("批量检验")}function se(){console.log("导出数据")}function O(a){return Ve(a)}function j(a){return a>3?"high-defect":a>1?"medium-defect":"low-defect"}function re({row:a}){return a.defect_rate>3?"high-risk-row":a.defect_rate>1?"medium-risk-row":""}function F(a){if(!a)return"";const t=new Date(a);return`${t.getFullYear()}-${String(t.getMonth()+1).padStart(2,"0")}-${String(t.getDate()).padStart(2,"0")}`}function ie(a){const t=Math.floor(Math.random()*3)+1,_=[],f=new Date;for(let b=0;b<t;b++){const s=new Date(f);s.setDate(f.getDate()-(b+1)*30);const h=Math.floor(Math.random()*100)+20,w=Math.floor(h*(a.defect_rate/100));_.push({date:s.toISOString(),inspector:["张工","李工","王工"][Math.floor(Math.random()*3)],sample_size:h,defect_count:w,defect_rate:(w/h*100).toFixed(2),result:w/h*100<3?"合格":"不合格",notes:""})}return _}function A(){if(!N.value)return;const a={};Y.forEach(s=>{a[s.id]={name:s.name,count:0,totalDefectRate:0}}),m.value.forEach(s=>{a[s.category_id]&&(a[s.category_id].count++,a[s.category_id].totalDefectRate+=s.defect_rate)});const t=[],_=[],f=[];Object.values(a).forEach(s=>{s.count>0&&(t.push(s.name),_.push((s.totalDefectRate/s.count).toFixed(2)),f.push(s.count))}),y&&y.dispose(),y=Se(N.value);const b={tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:function(s){const h=s[0],w=s[1];return`${h.name}<br/>
                平均缺陷率: ${h.value}%<br/>
                物料数量: ${w.value}`}},grid:{left:"3%",right:"4%",bottom:"3%",containLabel:!0},legend:{data:["平均缺陷率","物料数量"]},xAxis:[{type:"category",data:t,axisLabel:{rotate:30,interval:0}}],yAxis:[{type:"value",name:"缺陷率(%)",position:"left",axisLine:{show:!0,lineStyle:{color:"#ff7675"}},axisLabel:{formatter:"{value}%"}},{type:"value",name:"数量",position:"right",axisLine:{show:!0,lineStyle:{color:"#74b9ff"}}}],series:[{name:"平均缺陷率",type:"bar",data:_,itemStyle:{color:"#ff7675"}},{name:"物料数量",type:"bar",yAxisIndex:1,data:f,itemStyle:{color:"#74b9ff"}}]};y.setOption(b)}return be(()=>{we(()=>{A(),window.addEventListener("resize",()=>{y&&y.resize()})})}),(a,t)=>{const _=i("el-icon-search"),f=i("el-icon"),b=i("el-input"),s=i("el-option"),h=i("el-select"),w=i("el-icon-refresh"),z=i("el-button"),ce=i("el-icon-data-line"),C=i("el-card"),V=i("el-col"),de=i("el-icon-warning"),ue=i("el-icon-goods"),_e=i("el-icon-odometer"),P=i("el-row"),fe=i("el-button-group"),d=i("el-table-column"),T=i("el-table"),pe=i("el-pagination"),p=i("el-descriptions-item"),ve=i("el-descriptions"),me=i("el-tag"),he=i("el-dialog");return L(),U("div",Me,[o("div",Re,[t[7]||(t[7]=o("h2",{class:"page-title"},"库存物料管理",-1)),o("div",Fe,[e(b,{modelValue:S.value,"onUpdate:modelValue":t[0]||(t[0]=n=>S.value=n),placeholder:"搜索物料编码或名称",clearable:"",class:"search-input"},{prefix:l(()=>[e(f,null,{default:l(()=>[e(_)]),_:1})]),_:1},8,["modelValue"]),e(h,{modelValue:M.value,"onUpdate:modelValue":t[1]||(t[1]=n=>M.value=n),placeholder:"物料分类",clearable:"",class:"filter-select"},{default:l(()=>[(L(!0),U(ye,null,Ce(xe(Y),n=>(L(),ke(s,{key:n.id,label:n.name,value:n.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),e(h,{modelValue:R.value,"onUpdate:modelValue":t[2]||(t[2]=n=>R.value=n),placeholder:"缺陷率",clearable:"",class:"filter-select"},{default:l(()=>[e(s,{label:"全部",value:""}),e(s,{label:"低风险 (0-1%)",value:"low"}),e(s,{label:"中风险 (1-3%)",value:"medium"}),e(s,{label:"高风险 (>3%)",value:"high"})]),_:1},8,["modelValue"]),e(z,{type:"primary",onClick:Z},{default:l(()=>[e(f,null,{default:l(()=>[e(w)]),_:1}),t[6]||(t[6]=c(" 刷新 "))]),_:1,__:[6]})])]),o("div",Le,[e(P,{gutter:20},{default:l(()=>[e(V,{xs:24,sm:12,md:6},{default:l(()=>[e(C,{class:"stat-card",shadow:"hover"},{default:l(()=>[o("div",$e,[o("div",Be,[e(f,null,{default:l(()=>[e(ce)]),_:1})]),o("div",Ne,[t[8]||(t[8]=o("div",{class:"stat-title"},"总物料数",-1)),o("div",Ie,r(I.value.length),1)])])]),_:1})]),_:1}),e(V,{xs:24,sm:12,md:6},{default:l(()=>[e(C,{class:"stat-card warning",shadow:"hover"},{default:l(()=>[o("div",Ue,[o("div",Ee,[e(f,null,{default:l(()=>[e(de)]),_:1})]),o("div",qe,[t[9]||(t[9]=o("div",{class:"stat-title"},"高风险物料",-1)),o("div",Oe,r(E.value),1),o("div",je,r(X.value)+"%",1)])])]),_:1})]),_:1}),e(V,{xs:24,sm:12,md:6},{default:l(()=>[e(C,{class:"stat-card",shadow:"hover"},{default:l(()=>[o("div",Ae,[o("div",Pe,[e(f,null,{default:l(()=>[e(ue)]),_:1})]),o("div",Te,[t[10]||(t[10]=o("div",{class:"stat-title"},"总库存数",-1)),o("div",He,r(K.value),1)])])]),_:1})]),_:1}),e(V,{xs:24,sm:12,md:6},{default:l(()=>[e(C,{class:"stat-card",shadow:"hover"},{default:l(()=>[o("div",Je,[o("div",Qe,[e(f,null,{default:l(()=>[e(_e)]),_:1})]),o("div",Ye,[t[11]||(t[11]=o("div",{class:"stat-title"},"平均缺陷率",-1)),o("div",Ge,r(W.value)+"%",1)])])]),_:1})]),_:1})]),_:1})]),e(P,{gutter:20},{default:l(()=>[e(V,{span:24},{default:l(()=>[e(C,{class:"chart-card"},{header:l(()=>t[12]||(t[12]=[o("div",{class:"card-header"},[o("h3",null,"物料分类缺陷分布")],-1)])),default:l(()=>[o("div",{class:"chart-wrapper",ref_key:"categoryChartRef",ref:N},null,512)]),_:1})]),_:1})]),_:1}),e(C,{class:"table-card"},{header:l(()=>[o("div",Ke,[t[15]||(t[15]=o("h3",null,"物料库存清单",-1)),e(fe,null,{default:l(()=>[e(z,{size:"small",onClick:se},{default:l(()=>t[13]||(t[13]=[c("导出数据")])),_:1,__:[13]}),e(z,{size:"small",type:"success",onClick:ne},{default:l(()=>t[14]||(t[14]=[c("批量检验")])),_:1,__:[14]})]),_:1})])]),default:l(()=>[e(T,{data:G.value,style:{width:"100%"},border:"",stripe:"","highlight-current-row":"",onSortChange:ee,onRowClick:le,"row-class-name":re},{default:l(()=>[e(d,{type:"selection",width:"55"}),e(d,{prop:"material_code",label:"物料编码",sortable:"",width:"140"}),e(d,{prop:"material_name",label:"物料名称",width:"180"}),e(d,{label:"物料分类",width:"180"},{default:l(n=>[c(r(O(n.row.category_id)),1)]),_:1}),e(d,{prop:"supplier",label:"供应商"}),e(d,{prop:"batch_number",label:"批次号",width:"120"}),e(d,{prop:"quantity",label:"库存数量",sortable:"",width:"100",align:"right"}),e(d,{prop:"defect_rate",label:"缺陷率",sortable:"",width:"100",align:"right"},{default:l(n=>[o("span",{class:H(j(n.row.defect_rate))},r(n.row.defect_rate)+"%",3)]),_:1}),e(d,{prop:"last_inspection",label:"最后检验",sortable:"",width:"120"},{default:l(n=>[c(r(F(n.row.last_inspection)),1)]),_:1}),e(d,{label:"操作",width:"150",fixed:"right"},{default:l(n=>[e(z,{type:"primary",link:"",size:"small",onClick:J(ge=>q(n.row),["stop"])},{default:l(()=>t[16]||(t[16]=[c("详情")])),_:2,__:[16]},1032,["onClick"]),e(z,{type:"success",link:"",size:"small",onClick:J(ge=>oe(n.row),["stop"])},{default:l(()=>t[17]||(t[17]=[c("检验")])),_:2,__:[17]},1032,["onClick"])]),_:1})]),_:1},8,["data"]),o("div",We,[e(pe,{"current-page":k.value,"onUpdate:currentPage":t[3]||(t[3]=n=>k.value=n),"page-size":D.value,"onUpdate:pageSize":t[4]||(t[4]=n=>D.value=n),"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",total:I.value.length,onSizeChange:te,onCurrentChange:ae},null,8,["current-page","page-size","total"])])]),_:1}),e(he,{modelValue:B.value,"onUpdate:modelValue":t[5]||(t[5]=n=>B.value=n),title:"物料详细信息",width:"70%","append-to-body":""},{default:l(()=>[u.value?(L(),U("div",Xe,[e(ve,{column:2,border:""},{default:l(()=>[e(p,{label:"物料编码"},{default:l(()=>[c(r(u.value.material_code),1)]),_:1}),e(p,{label:"物料名称"},{default:l(()=>[c(r(u.value.material_name),1)]),_:1}),e(p,{label:"物料分类"},{default:l(()=>[c(r(O(u.value.category_id)),1)]),_:1}),e(p,{label:"供应商"},{default:l(()=>[c(r(u.value.supplier),1)]),_:1}),e(p,{label:"批次号"},{default:l(()=>[c(r(u.value.batch_number),1)]),_:1}),e(p,{label:"库存数量"},{default:l(()=>[c(r(u.value.quantity),1)]),_:1}),e(p,{label:"缺陷率"},{default:l(()=>[o("span",{class:H(j(u.value.defect_rate))},r(u.value.defect_rate)+"%",3)]),_:1}),e(p,{label:"最后检验日期"},{default:l(()=>[c(r(F(u.value.last_inspection)),1)]),_:1}),e(p,{label:"入库日期"},{default:l(()=>[c(r(F(u.value.entry_date)),1)]),_:1}),e(p,{label:"存放位置"},{default:l(()=>[c(r(u.value.location),1)]),_:1}),e(p,{label:"检验周期",span:2},{default:l(()=>[c(r(u.value.inspection_cycle)+" 天",1)]),_:1}),e(p,{label:"附加说明",span:2},{default:l(()=>[c(r(u.value.notes||"无"),1)]),_:1})]),_:1}),t[18]||(t[18]=o("h4",{class:"section-title"},"历史检验记录",-1)),e(T,{data:u.value.history||[],style:{width:"100%"},border:"",size:"small"},{default:l(()=>[e(d,{prop:"date",label:"检验日期",width:"120"},{default:l(n=>[c(r(F(n.row.date)),1)]),_:1}),e(d,{prop:"inspector",label:"检验员",width:"100"}),e(d,{prop:"sample_size",label:"样本数",width:"80",align:"center"}),e(d,{prop:"defect_count",label:"缺陷数",width:"80",align:"center"}),e(d,{prop:"defect_rate",label:"缺陷率",width:"80",align:"center"},{default:l(n=>[c(r(n.row.defect_rate)+"%",1)]),_:1}),e(d,{prop:"result",label:"结论",width:"100"},{default:l(n=>[e(me,{type:n.row.result==="合格"?"success":"danger"},{default:l(()=>[c(r(n.row.result),1)]),_:2},1032,["type"])]),_:1}),e(d,{prop:"notes",label:"备注"})]),_:1},8,["data"])])):De("",!0)]),_:1},8,["modelValue"])])}}},rt=ze(Ze,[["__scopeId","data-v-2ac02ae1"]]);export{rt as default};
